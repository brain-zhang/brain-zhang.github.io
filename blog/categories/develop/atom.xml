<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Develop | Living a Simple Life is a Happy Life]]></title>
  <link href="https://happy123.me/blog/categories/develop/atom.xml" rel="self"/>
  <link href="https://happy123.me/"/>
  <updated>2019-09-02T09:49:08+08:00</updated>
  <id>https://happy123.me/</id>
  <author>
    <name><![CDATA[brain-zhang]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[å´æ©è¾¾æœºå™¨å­¦ä¹ ç¬”è®°-1]]></title>
    <link href="https://happy123.me/blog/2019/09/01/wu-en-da-ji-qi-xue-xi-bi-ji/"/>
    <updated>2019-09-01T15:59:41+08:00</updated>
    <id>https://happy123.me/blog/2019/09/01/wu-en-da-ji-qi-xue-xi-bi-ji</id>
    <content type="html"><![CDATA[<p>è¿™ä¸ªç³»åˆ—æ•™ç¨‹å¤§åé¼é¼ï¼Œä¹‹å‰æˆ‘éƒ½æ˜¯ç”¨åˆ°å•¥å°±çè¯•ä¸€é€šï¼›æœ€è¿‘èŠ±äº†ä¸¤ä¸ªå‘¨ï¼Œè®¤è®¤çœŸçœŸæŠŠè¿™äº›åŸºç¡€çŸ¥è¯†é‡æ–°å­¦äº†ä¸€éï¼›åšä¸ªç¬”è®°ï¼›</p>

<p>è‹è€æ³‰äºŒåä¸ƒå§‹å‘æ„¤ï¼Œæˆ‘è¿™æ¯”ä»–è¿˜è½åï¼›ä¸è¿‡æ±‚çŸ¥çš„æ—…é€”ï¼Œä¸Šè·¯æ°¸è¿œä¸å«Œæ™šï¼Œæˆ‘ä¸€ç›´åœ¨è·¯ä¸Šï¼›</p>

<!-- more -->

<h2 id="supervised-learning">1-ç›‘ç£å­¦ä¹ ï¼ˆSupervised Learning)</h2>

<p>æ ¹æ®è®­ç»ƒæ•°æ®æ˜¯å¦æ‹¥æœ‰æ ‡è®°ä¿¡æ¯ï¼Œå­¦ä¹ ä»»åŠ¡å¯å¤§è‡´è¢«åˆ†ä¸ºä¸¤ç±»ï¼š</p>

<ul>
  <li>
    <p>ç›‘ç£å­¦ä¹ ï¼ˆSupervised Learningï¼‰ç›‘ç£å­¦ä¹ çš„ä»£è¡¨æ˜¯å›å½’å’Œåˆ†ç±»ã€‚</p>

    <ul>
      <li>å›å½’:é¢„æµ‹è¿ç»­å€¼çš„æ¨¡å‹: å·²çŸ¥æˆ¿å­å¤§å°å’Œæˆ¿ä»·æ•°æ®é›†ï¼Œé¢„æµ‹æŸä¸€æˆ¿å­çš„ä»·æ ¼</li>
      <li>åˆ†ç±»:é¢„æµ‹ç¦»æ•£å€¼çš„æ¨¡å‹: å·²çŸ¥è‚¿ç˜¤æ€§è´¨å’Œå¤§å°æ•°æ®é›†ï¼Œé¢„æµ‹è‚¿ç˜¤æ˜¯å¦è‰¯æ€§</li>
    </ul>
  </li>
  <li>
    <p>æ— ç›‘ç£å­¦ä¹ ï¼ˆUnsupervised Learningï¼‰ æ— ç›‘ç£å­¦ä¹ çš„ä»£è¡¨æ˜¯èšç±»ã€‚</p>
  </li>
</ul>

<h2 id="section">2-å•å˜é‡çº¿æ€§å›å½’</h2>

<h4 id="section-1">æ¨¡å‹è¡¨ç¤º</h4>

<script type="math/tex; mode=display">
h_{\theta}(x) = \theta_{0} + \theta_{1}x
</script>

<h4 id="section-2">ä»£ä»·å‡½æ•°</h4>

<p>æ±‚ä¸¤ä¸ªå€¼ï¼Œä½¿æ¨¡å‹æœ€ä¸ºåŒ¹é…å½“å‰æ•°æ®é›†ï¼›æ±‚è§£åŒ¹é…åº¦çš„è¿‡ç¨‹æç‚¼å‡ºä»£ä»·å‡½æ•°ï¼›ä»£ä»·å‡½æ•°å€¼è¶Šå°ï¼ŒåŒ¹é…åº¦è¶Šé«˜</p>

<script type="math/tex; mode=display">
J(\theta_{0}, \theta_{1}) = \frac{1}{2m}\sum_{i=1}^m(h_{\theta}(x^{(i)})-y^{(i)})^{2}
</script>

<p>å½“ğœƒ1=0æ—¶ï¼Œä»£ä»·å‡½æ•°ä¸ºä¸€æŠ›ç‰©çº¿ï¼›
å½“ğœƒ0ï¼Œğœƒ1éƒ½ä¸ä¸º0æ—¶ï¼Œä»£ä»·å‡½æ•°ä¸ºä¸€ä¸‰ç»´æ›²é¢ï¼›</p>

<h4 id="section-3">è‡ªåŠ¨æ±‚è§£ä»£ä»·å‡½æ•°</h4>

<p>æˆ‘ä»¬æˆ‘ä»¬æœ‰å‡½æ•°  ğ½(ğœƒ0,ğœƒ1) , å¯ä»¥ä¸æ–­çš„è°ƒæ•´  ğœƒ0  å’Œ  ğœƒ1 , æ¥ä½¿å¾—  ğ½(ğœƒ0,ğœƒ1)  , ç›´åˆ°  ğ½(ğœƒ0,ğœƒ1)  è¾¾åˆ°æœ€å°å€¼ä¸ºæ­¢</p>

<p>æ¢¯åº¦ä¸‹é™æ˜¯ä¸€ä¸ªç”¨æ¥æ±‚å‡½æ•°æœ€å°å€¼çš„ç®—æ³•ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ¢¯åº¦ä¸‹é™ç®—æ³•æ¥æ±‚å‡ºä»£ä»·å‡½æ•° ğ½(ğœƒ0,ğœƒ1) çš„æœ€å°å€¼ã€‚</p>

<p>æ¢¯åº¦ä¸‹é™èƒŒåçš„æ€æƒ³æ˜¯ï¼šå¼€å§‹æ—¶æˆ‘ä»¬éšæœºé€‰æ‹©ä¸€ä¸ªå‚æ•°çš„ç»„åˆ (ğœƒ0,ğœƒ1,â€¦â€¦,ğœƒğ‘›)  ï¼Œè®¡ç®—ä»£ä»·å‡½æ•°ï¼Œç„¶åæˆ‘ä»¬å¯»æ‰¾ä¸‹ä¸€ä¸ªèƒ½è®©ä»£ä»·å‡½æ•°å€¼ä¸‹é™æœ€å¤šçš„å‚æ•°ç»„åˆã€‚æˆ‘ä»¬æŒç»­è¿™ä¹ˆåšç›´åˆ°æŠµè¾¾ä¸€ä¸ªå±€éƒ¨æœ€å°å€¼ï¼ˆlocal minimumï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬å¹¶æ²¡æœ‰å°è¯•å®Œæ‰€æœ‰çš„å‚æ•°ç»„åˆï¼Œæ‰€ä»¥ä¸èƒ½ç¡®å®šæˆ‘ä»¬å¾—åˆ°çš„å±€éƒ¨æœ€å°å€¼æ˜¯å¦ä¾¿æ˜¯å…¨å±€æœ€å°å€¼ï¼ˆglobal minimumï¼‰ï¼Œé€‰æ‹©ä¸åŒçš„åˆå§‹å‚æ•°ç»„åˆï¼Œå¯èƒ½ä¼šæ‰¾åˆ°ä¸åŒçš„å±€éƒ¨æœ€å°å€¼ã€‚</p>

<p>å¸…æ°”çš„æ¢¯åº¦ä¸‹é™ç®—æ³•å…¬å¼:</p>

<script type="math/tex; mode=display">
\theta_{j} := \theta_{j} - \alpha\frac{\partial}{\partial{\theta_{j}}}J(\theta)
</script>

<p>å¯¹ ğœƒ èµ‹å€¼ï¼Œä½¿å¾—  ğ½(ğœƒ) æŒ‰æ¢¯åº¦ä¸‹é™æœ€å¿«æ–¹å‘è¿›è¡Œï¼Œä¸€ç›´è¿­ä»£ä¸‹å»ï¼Œæœ€ç»ˆå¾—åˆ°å±€éƒ¨æœ€å°å€¼ã€‚å…¶ä¸­ ğ›¼ æ˜¯å­¦ä¹ ç‡ï¼ˆlearning rateï¼‰ï¼Œå®ƒå†³å®šäº†æˆ‘ä»¬æ²¿ç€èƒ½è®©ä»£ä»·å‡½æ•°ä¸‹é™ç¨‹åº¦æœ€å¤§çš„æ–¹å‘å‘ä¸‹è¿ˆå‡ºçš„æ­¥å­æœ‰å¤šå¤§ã€‚</p>

<ul>
  <li>å¦‚æœ ğ›¼ å¤ªå°äº†ï¼Œå³æˆ‘çš„å­¦ä¹ é€Ÿç‡å¤ªå°ï¼Œå¯èƒ½ä¼šå¾ˆæ…¢ï¼Œå› ä¸ºå®ƒä¼šä¸€ç‚¹ç‚¹æŒªåŠ¨ï¼Œå®ƒä¼šéœ€è¦å¾ˆå¤šæ­¥æ‰èƒ½åˆ°è¾¾å…¨å±€æœ€ä½ç‚¹ã€‚</li>
  <li>å¦‚æœ ğ›¼ å¤ªå¤§ï¼Œé‚£ä¹ˆæ¢¯åº¦ä¸‹é™æ³•å¯èƒ½ä¼šè¶Šè¿‡æœ€ä½ç‚¹ï¼Œä¸‹ä¸€æ¬¡è¿­ä»£åˆç§»åŠ¨äº†ä¸€å¤§æ­¥ï¼Œè¶Šè¿‡ä¸€æ¬¡ï¼Œåˆè¶Šè¿‡ä¸€æ¬¡ï¼Œä¸€æ¬¡æ¬¡è¶Šè¿‡æœ€ä½ç‚¹ï¼Œç›´åˆ°ä½ å‘ç°å®é™…ä¸Šç¦»æœ€ä½ç‚¹è¶Šæ¥è¶Šè¿œï¼Œæœ€ç»ˆä¼šå¯¼è‡´æ— æ³•æ”¶æ•›ï¼Œç”šè‡³å‘æ•£ã€‚</li>
</ul>

<h2 id="section-4">3-çŸ©é˜µå’Œå‘é‡</h2>

<h4 id="x2">ä¸€ä¸ª2X2çŸ©é˜µ</h4>

<p>```
import numpy as np
a=np.array([[1, 2], [3, 4]])</p>

<p>```</p>

<h4 id="section-5">å‘é‡æ˜¯åˆ—æ•°ä¸º1çš„ç‰¹æ®ŠçŸ©é˜µ:</h4>

<p>```
b = np.array(np.zeros((3,1)))</p>

<p>```</p>

<h4 id="section-6">çŸ©é˜µçš„åŠ æ³•</h4>

<p>è¡Œåˆ—æ•°ç›¸ç­‰çš„æ‰å¯ä»¥åšåŠ æ³•ï¼Œä¸¤ä¸ªçŸ©é˜µç›¸åŠ å°±æ˜¯è¡Œåˆ—å¯¹åº”çš„å…ƒç´ ç›¸åŠ ã€‚</p>

<p>```
import numpy as np
a = np.mat([[1,0],[2,5],[3,1]])
b = np.mat([[4,0.5],[2,5],[0,1]])
print (â€œa: \nâ€,a, â€œ\nb: \nâ€,b)
print (â€œa+b: \nâ€,a+b)  # a + bï¼ŒçŸ©é˜µç›¸åŠ </p>

<p>```</p>

<h4 id="section-7">çŸ©é˜µçš„æ ‡é‡ä¹˜æ³•</h4>

<p>çŸ©é˜µå’Œæ ‡é‡çš„ä¹˜æ³•ä¹Ÿå¾ˆç®€å•,å°±æ˜¯çŸ©é˜µçš„æ¯ä¸ªå…ƒç´ éƒ½ä¸æ ‡é‡ç›¸ä¹˜ã€‚</p>

<p>```
print (â€œa: \nâ€,a)
print (â€œ3<em>a: \nâ€,3</em> a)  #çŸ©é˜µæ ‡é‡ä¹˜æ³•</p>

<p>```</p>

<h4 id="section-8">å‘é‡ä¹˜æ³•</h4>
<p>mÃ—n çš„çŸ©é˜µä¹˜ä»¥ nÃ—1 çš„å‘é‡ï¼Œå¾—åˆ°çš„æ˜¯ mÃ—1 çš„å‘é‡</p>

<p>```
import numpy as np
a = np.mat([[-1,2],[2,3]])
c = np.mat([[3],[4]])
ac = a * c</p>

<p>```</p>

<h4 id="section-9">çŸ©é˜µä¹˜æ³•çš„æ€§è´¨</h4>
<ul>
  <li>çŸ©é˜µçš„ä¹˜æ³•ä¸æ»¡è¶³äº¤æ¢å¾‹ï¼š ğ´Ã—ğµâ‰ ğµÃ—ğ´</li>
  <li>çŸ©é˜µçš„ä¹˜æ³•æ»¡è¶³ç»“åˆå¾‹ã€‚å³ï¼š ğ´Ã—ï¼ˆğµÃ—ğ¶ï¼‰=ï¼ˆğ´Ã—ğµï¼‰Ã—ğ¶</li>
  <li>åœ¨çŸ©é˜µçš„ä¹˜æ³•ä¸­ï¼Œæœ‰ä¸€ç§çŸ©é˜µèµ·ç€ç‰¹æ®Šçš„ä½œç”¨ï¼Œå¦‚åŒæ•°çš„ä¹˜æ³•ä¸­çš„ 1,æˆ‘ä»¬ç§°è¿™ç§çŸ©é˜µä¸ºå•ä½çŸ©é˜µï¼å®ƒæ˜¯ä¸ªæ–¹é˜µï¼Œä¸€èˆ¬ç”¨ I æˆ–è€… E è¡¨ç¤ºï¼Œæœ¬è®²ä¹‰éƒ½ç”¨ I ä»£è¡¨å•ä½çŸ©é˜µï¼Œä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’çš„å¯¹è§’çº¿ï¼ˆç§°ä¸ºä¸»å¯¹è§’çº¿ï¼‰ä¸Šçš„å…ƒç´ å‡ä¸º 1 ä»¥å¤–å…¨éƒ½ä¸º 0ã€‚</li>
</ul>

<h4 id="section-10">é€†çŸ©é˜µ</h4>

<p>çŸ©é˜µ A æ˜¯ä¸€ä¸ª mÃ—m çŸ©é˜µï¼ˆæ–¹é˜µï¼‰ï¼Œå¦‚æœæœ‰é€†çŸ©é˜µï¼Œåˆ™ï¼šğ´ğ´âˆ’1=ğ´âˆ’1ğ´=ğ¼</p>

<p>æ²¡æœ‰é€†çŸ©é˜µçš„çŸ©é˜µ, ç§°ä¸ºå¥‡å¼‚ (singlar/degenerate)çŸ©é˜µ</p>

<p>```
import numpy as np</p>

<p>a = np.mat([[1,2],[3,4]])
print (â€˜a:\nâ€™,a)
res = np.linalg.inv(a)
print(â€˜a inverse:\nâ€™, res)</p>

<p>```</p>

<p>å¤‡æ³¨: å†octaveä¸­ï¼Œå¯ä»¥ç”¨pinvå‡½æ•°(ä¼ªé€†çŸ©é˜µ)å¯¹å¥‡å¼‚çŸ©é˜µæ±‚é€†ï¼›</p>

<h4 id="section-11">çŸ©é˜µè½¬ç½®</h4>

<p>è®¾ A ä¸º mÃ—n é˜¶çŸ©é˜µï¼ˆå³ m è¡Œ n åˆ—ï¼‰ï¼Œç¬¬ i è¡Œ j åˆ—çš„å…ƒç´ æ˜¯ a(i,j)ï¼Œå³ï¼šA=a(i,j) å®šä¹‰ A çš„è½¬ç½®ä¸ºè¿™æ ·ä¸€ä¸ª nÃ—m é˜¶çŸ©é˜µ Bï¼Œæ»¡è¶³ B=a(j,i)ï¼Œå³ b (i,j)=a (j,i)ï¼ˆB çš„ç¬¬ i è¡Œç¬¬ j åˆ—å…ƒç´ æ˜¯ A çš„ç¬¬ j è¡Œç¬¬ i åˆ—å…ƒç´ ï¼‰ï¼Œè®°  ğ´ğ‘‡=ğµ ã€‚</p>

<p>```
a = np.mat([[1,2],[3,4]])
print (â€˜a:\nâ€™,a)
res = a.T
print(â€˜a transpose:\nâ€™, res)</p>

<p>```</p>

<h2 id="section-12">4-å¤šå˜é‡çº¿æ€§å›å½’</h2>

<ul>
  <li>å¼•å…¥å¤šç§ç‰¹å¾åçš„å‡è®¾hæ¨¡å‹</li>
</ul>

<script type="math/tex; mode=display">
h_{\theta}(x) = \theta_{0} + \theta_{1}x_{1} + \theta_{2}x_{2} + ... + \theta_{n}x_{n}
</script>

<p>æ­¤æ—¶æ¨¡å‹ä¸­çš„å‚æ•°æ˜¯ä¸€ä¸ª n+1 ç»´çš„å‘é‡ï¼Œä»»ä½•ä¸€ä¸ªè®­ç»ƒå®ä¾‹ä¹Ÿéƒ½æ˜¯ n+1 ç»´çš„å‘é‡ï¼Œç‰¹å¾çŸ©é˜µ X çš„ç»´åº¦æ˜¯ m*(n+1)ã€‚ å› æ­¤å…¬å¼å¯ä»¥ç®€åŒ–ä¸ºï¼š</p>

<script type="math/tex; mode=display">
h_{\theta}(x) = \theta^TX
</script>

<h4 id="section-13">å¤šå˜é‡æ¢¯åº¦ä¸‹é™</h4>

<p>ä¸å•å˜é‡çº¿æ€§å›å½’ç±»ä¼¼ï¼Œåœ¨å¤šå˜é‡çº¿æ€§å›å½’ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿæ„å»ºä¸€ä¸ªä»£ä»·å‡½æ•°ï¼Œåˆ™è¿™ä¸ªä»£ä»· å‡½æ•°æ˜¯æ‰€æœ‰å»ºæ¨¡è¯¯å·®çš„å¹³æ–¹å’Œï¼Œå³ï¼š</p>

<script type="math/tex; mode=display">
J(\theta_{0}, \theta_{1}...\theta_{n}) = \frac{1}{2m}\sum_{i=1}^m(h_{\theta}(x^{(i)})-y^{(i)})^{2}
</script>

<p>```
# ä»£ä»·å‡½æ•°çš„pythonä»£ç å®ç°
def Cost(X, y, theta):
    inner = np.power(((X * theta.T) - y), 2)
    return np.sum(inner) / (2 * len(X))</p>

<p>```</p>

<h4 id="section-14">æ¢¯åº¦ä¸‹é™ - ç‰¹å¾ç¼©æ”¾</h4>

<p>åœ¨æˆ‘ä»¬é¢å¯¹å¤šç»´ç‰¹å¾é—®é¢˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦ä¿è¯è¿™äº›ç‰¹å¾éƒ½å…·æœ‰ç›¸è¿‘çš„å°ºåº¦ï¼Œè¿™å¯ä»¥å¸®åŠ©æ¢¯åº¦ä¸‹é™ç®—æ³•æ›´å¿«åœ°æ”¶æ•›ã€‚</p>

<p>è§£å†³çš„æ–¹æ³•æ˜¯å°è¯•å°†æ‰€æœ‰ç‰¹å¾çš„å°ºåº¦éƒ½å°½é‡ç¼©æ”¾åˆ°-1 åˆ° 1 ä¹‹é—´ã€‚</p>

<p>æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä»¤ï¼š</p>

<script type="math/tex; mode=display">
x_n = \frac{x_n - \mu_n}{s_n}
</script>

<p>å…¶ä¸­,  ğœ‡ğ‘› æ˜¯å¹³å‡å€¼ï¼Œ ğ‘ ğ‘› æ˜¯æ ‡å‡†å·®ã€‚</p>

<h4 id="section-15">æ¢¯åº¦ä¸‹é™ - å­¦ä¹ ç‡</h4>

<ul>
  <li>å¦‚æœå­¦ä¹ ç‡ ğ›¼ è¿‡å°ï¼Œåˆ™è¾¾åˆ°æ”¶æ•›æ‰€éœ€çš„è¿­ä»£æ¬¡æ•°ä¼šéå¸¸é«˜ï¼›</li>
  <li>å¦‚æœå­¦ä¹ ç‡ ğ›¼ è¿‡å¤§ï¼Œæ¯æ¬¡è¿­ä»£å¯èƒ½ä¸ä¼šå‡å°ä»£ä»·å‡½æ•°ï¼Œå¯èƒ½ä¼šè¶Šè¿‡å±€éƒ¨æœ€å°å€¼å¯¼è‡´æ— æ³•æ”¶æ•›ã€‚</li>
</ul>

<p>é€šå¸¸å¯ä»¥è€ƒè™‘å°è¯•äº›å­¦ä¹ ç‡ï¼š 0.01ï¼Œ0.03ï¼Œ0.1ï¼Œ0.3ï¼Œ1ï¼Œ3ï¼Œ10; 3å€å¢é•¿</p>

<h4 id="section-16">ç‰¹å¾ä¸å¤šé¡¹å¼å›å½’</h4>

<p>å¦‚æœæˆ‘ä»¬é‡‡ç”¨å¤šé¡¹å¼å›å½’æ¨¡å‹ï¼Œåœ¨è¿è¡Œæ¢¯åº¦ä¸‹é™ç®—æ³•å‰ï¼Œç‰¹å¾ç¼©æ”¾éå¸¸æœ‰å¿…è¦ã€‚å› ä¸ºå¹‚è¿ç®—å¾ˆå®¹æ˜“æ‹‰å¤§ç‰¹å¾ä¹‹é—´å°ºåº¦çš„å·®è·</p>

<h4 id="section-17">æ­£è§„æ–¹ç¨‹</h4>

<p>å‡è®¾æˆ‘ä»¬çš„è®­ç»ƒé›†ç‰¹å¾çŸ©é˜µä¸º Xï¼ˆåŒ…å«äº† ğ‘¥0=1 ï¼‰å¹¶ä¸”æˆ‘ä»¬çš„è®­ç»ƒé›†ç»“æœä¸ºå‘é‡ yï¼Œ åˆ™åˆ©ç”¨æ­£è§„æ–¹ç¨‹è§£å‡ºå‘é‡</p>

<script type="math/tex; mode=display">
\theta = (X^TX)^{-1}X^Ty
</script>

<p>åªè¦ç‰¹å¾å˜é‡çš„æ•°ç›®å¹¶ä¸å¤§ï¼Œæ ‡å‡†æ–¹ç¨‹æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è®¡ç®—å‚æ•° ğœƒ çš„æ›¿ä»£æ–¹æ³•ã€‚å…·ä½“åœ°è¯´ï¼Œåªè¦ç‰¹å¾å˜é‡çš„æ•°é‡å°äºä¸€ä¸‡ï¼Œé€šå¸¸ä½¿ç”¨æ ‡å‡†æ–¹ç¨‹æ³•ï¼Œè€Œä¸ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ä¸ºFlask RestAPIé›†æˆSwagger UI]]></title>
    <link href="https://happy123.me/blog/2019/08/18/wei-flask-restapiji-cheng-swagger-ui/"/>
    <updated>2019-08-18T15:38:02+08:00</updated>
    <id>https://happy123.me/blog/2019/08/18/wei-flask-restapiji-cheng-swagger-ui</id>
    <content type="html"><![CDATA[<p>èŠ±äº†åŠå¤©æ—¶é—´ï¼Œç»™<a href="https://github.com/brain-zhang/chainhorn">chainhorn</a>é›†æˆäº†Swagger;</p>

<p>è™½ç„¶è¿™ç§äº‹æƒ…å·²ç»åšè¿‡å¥½å‡ éäº†ï¼Œä½†æ˜¯ä¸è¯»æ–‡æ¡£è¿˜æ˜¯æ²¡è¾™ï¼›æˆ‘æŠŠè¿™ç§åŠåŠå­å½¢å®¹ä¸ºâ€œæˆ‘è®¤è¯†äººæ°‘å¸ï¼Œä½†æ˜¯ç”»ä¸å‡ºæ¥â€¦T_Tâ€</p>

<p>è¿˜æ˜¯è€è€å®å®æµæ°´è´¦è®°ä¸€ä¸‹å§:</p>

<!-- more -->

<h3 id="section">ä¾èµ–ç»„ä»¶</h3>

<ul>
  <li><a href="https://flask-restplus.readthedocs.io">flask-restplus</a></li>
</ul>

<p>restplusèƒ½è®©äººå¾ˆæ–¹ä¾¿çš„é€šè¿‡å‡ ä¸ªdecoratorå°±å¯ä»¥é›†æˆå¾ˆæ¼‚äº®çš„restapiï¼Œå®ƒæä¾›äº†apiå‘½åç©ºé—´ã€Requestå’ŒResponseè§£æä»¥åŠSwagger UIçš„é›†æˆ</p>

<p>å¦å¤–ï¼Œflask-restplusçš„æ–‡æ¡£å’Œä¾‹å­å†™çš„éå¸¸ç®€æ´æ¸…æ™°ï¼Œèµä¸€ä¸ªã€‚</p>

<ul>
  <li><a href="https://flask-httpauth.readthedocs.io/en/latest/">flask-httpauth</a></li>
</ul>

<p>ç”¨æ¥é›†æˆéªŒè¯æœºåˆ¶ï¼Œæ”¯æŒåŸºæœ¬çš„å¯†ç éªŒè¯ã€TokenéªŒè¯ï¼›çŸ­å°ç²¾æ‚ï¼Œå¤Ÿç”¨äº†</p>

<h3 id="section-1">èµ·æ­¥</h3>

<p>å¼•ç”¨å®˜ç½‘çš„ä¾‹å­:</p>

<h4 id="api">æ„å»ºapiå¯¹è±¡</h4>

<p>```
from flask import Flask
from flask_restplus import Api, Resource, fields
from werkzeug.contrib.fixers import ProxyFix</p>

<p>app = Flask(<strong>name</strong>)
app.wsgi_app = ProxyFix(app.wsgi_app)</p>

<p>api = Api(app, version=â€™1.0â€™, title=â€™Chainhorn APIâ€™,
    description=â€™A simple ChainHorn APIâ€™,
)</p>

<p>ns = api.namespace(â€˜nodeâ€™, description=â€™node operationsâ€™)</p>

<p>```</p>

<p>æœ€é‡è¦çš„æ˜¯æ„å»ºäº†<code>api</code>å¯¹è±¡ï¼Œè¿™æ ·å°±å¯ä»¥ä¸ºåé¢çš„èµ„æºå¢åŠ urlè·¯ç”±ã€å‚æ•°è§£æåŒèƒ½ï¼›</p>

<p>ä¸‹é¢ç´§è·Ÿç€æ„å»ºäº†ä¸€ä¸ª<code>ns</code> â€“<code>namespace</code>å¯¹è±¡ï¼Œä½œç”¨æ˜¯ä¸ºä¸åŒçš„èµ„æºï¼Œä¸åŒçš„urlåˆ†ç»„ï¼Œè¿™æ ·æœ€ååæ˜ åˆ°ç•Œé¢ä¸Šå¥½çœ‹ä¸€ç‚¹ï¼›</p>

<h4 id="section-2">ä¿®é¥°</h4>

<p>```
@ns.route(â€˜â€™)
  class NodeGetInfo(Resource):
      @ns_node.doc(â€˜get node infoâ€™)
      def get(self):
          â€˜'â€™get node infoâ€™â€™â€™
          info = spv.getinfo()
          return {â€˜nodeinfoâ€™: info}, 200</p>

<p>```</p>

<p>æœ€ç®€å•çš„ï¼Œç”¨<code>@ns.route('')</code>ï¼Œå°±å®šä¹‰äº†æ ¹urlï¼Œ ç„¶ååé¢çš„å¥—è·¯éƒ½æ˜¯ç›¸ä¼¼çš„ï¼Œä¸ºèµ„æºå®ç°getæ–¹æ³•ï¼Œå°±ç›´æ¥å“åº” http Getè¯·æ±‚äº†ï¼›</p>

<h4 id="request">Requestå‚æ•°å¤„ç†</h4>

<p>å¦‚æœç›´æ¥åœ¨urlåé¢è·Ÿå‚æ•°ï¼Œé‚£ä¹ˆå¾ˆæ–¹ä¾¿çš„ç”¨ <code>ns.param</code>å®šä¹‰ä¸€ä¸‹å³å¯:
ä¸‹é¢è¿™ä¸ªå‡½æ•°å°±ç›´æ¥æ¥å—ä¸€ä¸ª <code>/broadcast/tx12345</code> è¿™æ ·çš„tx12345ä½œä¸ºå‚æ•°<code>tx</code></p>

<p>```
@ns.route(â€˜/broadcast/<string:tx>')
  class WalletBroadcastTx(Resource):
      @ns.doc('broadcast raw tx')
      @ns.param('tx', 'The transaction hash identifier')
      def post(self, tx):
          '''broadcast raw tx'''
          sendrawtransaction(spv, tx)
          return {'broadcast': 'ok'}, 200</string:tx></p>

<p>```</p>

<p>å¦‚æœè¦æ”¾åœ¨FormDataé‡Œé¢ï¼Œå¯ä»¥ç”¨<code>ns.expect</code>æ¥é™åˆ¶ï¼›å®ƒå¯ä»¥æ¥å—ä¸€ä¸ªå¯¹è±¡ä¼ å…¥ï¼›æ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œè¦æŠŠ<code>tx</code>å­—æ®µæ”¾åˆ°POSTè¯·æ±‚çš„Form Dataä¸­ï¼Œè¦è¿™æ ·åš:</p>

<p>```
TxModel = {â€˜txâ€™: fields.String(required=True, description=â€™The hex txâ€™)}
@ns.route(â€˜/broadcastâ€™)
  class WalletBroadcastTx(Resource):
      @ns.doc(â€˜broadcast raw txâ€™)
      @ns.expect(TxModel, 200)
      def post(self, tx):
          â€˜'â€™broadcast raw txâ€™â€™â€™
          sendrawtransaction(spv, api.payload[â€˜txâ€™])
          return {â€˜broadcastâ€™: â€˜okâ€™}, 200</p>

<p>```</p>

<h4 id="response">Responseå‚æ•°å¤„ç†</h4>

<p>åŒæ ·çš„ï¼Œå¦‚æœéœ€è¦è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨ç•Œé¢ä¸Šå‡ºç°è¿™ä¸ªå¯¹è±¡çš„è¯¦ç»†æè¿°ä¿¡æ¯ï¼Œå¯ä»¥ç”¨<code>marshal_with</code>å’Œ<code>marshal_list_with</code>æ¥ä¿®é¥°ï¼›</p>

<p>å…·ä½“è¯·å‚è€ƒ:</p>

<p>https://flask-restplus.readthedocs.io/en/stable/parsing.html</p>

<h4 id="section-3">ç”¨æˆ·éªŒè¯</h4>

<p>ä¾‹å¦‚ï¼Œä¸ºAPIåŠ ä¸ŠHTTP Token Authï¼Œè¦ç”¨åˆ°<code>HTTPTokenAuth</code>å¯¹è±¡ï¼›</p>

<p>é¦–å…ˆæˆ‘ä»¬å…ˆå®šä¹‰éªŒè¯è§„åˆ™:</p>

<p>```
auth = HTTPTokenAuth()
tokens = {
  â€˜APIKEYâ€™:â€™helloâ€™,
  â€œAPPIDâ€: â€œchainhornâ€
}</p>

<p>@auth.verify_token
def verify_token(token):
  if request.headers.get(â€˜APIKEYâ€™, â€˜â€™).strip()==tokens[â€˜APIKEYâ€™] and \
     request.headers.get(â€˜APPIDâ€™, â€˜â€™).strip() == tokens[â€˜APPIDâ€™]:
      return True
  else:
      return False</p>

<p>```</p>

<p>ç„¶ååœ¨æ¯ä¸ªurl è¯·æ±‚å¤„ç†å‡½æ•°å‰é¢åŠ ä¸Šä¿®é¥°ç¬¦<code>auth_login_required</code>ï¼›æ¯”å¦‚æˆ‘ä»¬æœ€å¼€å§‹çš„ä¾‹å­:</p>

<p>```
@ns.route(â€˜â€™)
class NodeGetInfo(Resource):
  @ns.doc(â€˜get node infoâ€™)
  @auth.login_required
  def get(self):
      â€˜'â€™get node infoâ€™â€™â€™
      info = spv.getinfo()
      return {â€˜nodeinfoâ€™: info}, 200</p>

<p>```</p>

<p>è¿™æ ·åå°éªŒè¯å°±æœ‰äº†ï¼›é‚£ä¹ˆå‰å°è¾“å…¥å‘¢ï¼Ÿ</p>

<p>è¿™ä¸ªä¾‹å­é‡Œé¢ï¼Œæˆ‘ä»¬éœ€è¦å‰å°è¾“å…¥çš„æ—¶å€™åœ¨HTTP Headeré‡Œé¢ä¼ å…¥ä¸¤ä¸ªKey: APIKEYå’ŒAPPKEYï¼›ç›´æ¥ç”¨ç”¨Swagger UIè‡ªå¸¦çš„ç»„ä»¶å®ç°å°±å¯ä»¥äº†ï¼ŒæŠŠapiå¯¹è±¡æ„é€ ä¸º:</p>

<p>```
AUTHORIZATIONS = {
    â€˜apikeyâ€™: {
        â€˜typeâ€™: â€˜apiKeyâ€™,
        â€˜inâ€™: â€˜headerâ€™,
        â€˜nameâ€™: â€˜APIKEYâ€™
    },
    â€˜appidâ€™: {
        â€˜typeâ€™: â€˜apiKeyâ€™,
        â€˜inâ€™: â€˜headerâ€™,
        â€˜nameâ€™: â€˜APPIDâ€™
    }
}
api = Api(app,
        version=â€™v1â€™,
        authorizations=AUTHORIZATIONS,
        security=list(AUTHORIZATIONS.keys()),
        title=â€™Chainhorn APIâ€™,
        description=â€™Chainhorn APIâ€™,
)</p>

<p>```</p>

<p>è¿™æ ·é»˜è®¤æ‰€æœ‰çš„APIè®¿é—®éƒ½éœ€è¦ åœ¨HTTP Headerä¸­ä¼ å…¥ä¸¤ä¸ªKey: APIKEYå’ŒAPPKEYï¼Œå¦‚æœå€¼ä¸å¯¹çš„è¯å°±ä¼šè®¿é—®å¤±è´¥ï¼›</p>

<p>æ­¤æ—¶å‰å°çš„ç•Œé¢æ˜¯è¿™æ ·çš„:</p>

<p><img src="https://raw.githubusercontent.com/brain-zhang/memoryboxes.github.io/source/images/201908/bg3.jpg" alt="Auth1" /></p>

<p>å¯ä»¥ç‚¹å‡»å³ä¸Šè§’çš„Authorizeä¸€æ¬¡æ€§è®¾ç½®æ‰€æœ‰APIçš„è®¿é—®å¯†é’¥ï¼›</p>

<p><img src="https://raw.githubusercontent.com/brain-zhang/memoryboxes.github.io/source/images/201908/bg4.jpg" alt="Auth2" /></p>

<p>ä¹Ÿå¯ä»¥åœ¨æ¯ä¸ªAPIçš„å³ä¸Šè§’è®¾ç½®è®¿é—®å¯†é’¥ï¼›</p>

<p>å½“ç„¶ï¼Œæˆ‘ä»¬ç›®å‰çš„å¯†é’¥æ˜¯åå°å†™æ­»çš„ï¼Œä½ å¯ä»¥å¼•å…¥ä¸€ä¸ªä¸‰æ–¹åº“ä¸ºæ¯ä¸ªç”¨æˆ·ç”Ÿæˆä¸åŒçš„å¯†é’¥å­˜åˆ°æ•°æ®åº“é‡Œé¢ï¼Œç„¶åæ¯æ¬¡éªŒè¯~~~</p>

<h3 id="section-4">ç»¼åˆä¾‹å­</h3>

<p>æœ€åï¼Œåœ¨githubä¸Šé¢æœ‰ä¸ªé›†å¤§æˆçš„ä¾‹å­,å€¼å¾—æ¨è</p>

<p>https://github.com/frol/flask-restplus-server-example</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Python Requests Post for 5 Styles]]></title>
    <link href="https://happy123.me/blog/2019/08/09/python-requests-post-for-5-styles/"/>
    <updated>2019-08-09T09:13:32+08:00</updated>
    <id>https://happy123.me/blog/2019/08/09/python-requests-post-for-5-styles</id>
    <content type="html"><![CDATA[<h4 id="requestspost">requestsåº“å‘é€postè¯·æ±‚çš„äº”ç§å§¿åŠ¿;</h4>

<!-- more -->

<h4 id="applicationx-www-form-urlencoded">1.application/x-www-form-urlencoded</h4>

<p>æœ€å¸¸è§çš„ POST æäº¤æ•°æ®çš„æ–¹å¼äº†ã€‚æµè§ˆå™¨çš„åŸç”Ÿ form è¡¨å•ï¼Œå¦‚æœä¸è®¾ç½® enctypeå±æ€§ï¼Œé‚£ä¹ˆæœ€ç»ˆå°±ä¼šä»¥ application/x-www-form-urlencodedæ–¹å¼æäº¤æ•°æ®ã€‚è¯·æ±‚ç±»ä¼¼äºä¸‹é¢è¿™æ ·:</p>

<p>```
POST http://www.example.com HTTP/1.1    Content-Type:
application/x-www-form-urlencoded;charset=utf-8
title=test&amp;sub%5B%5D=1&amp;sub%5B%5D=2&amp;sub%5B%5D=3</p>

<p>```</p>

<p>requestsé»˜è®¤å¤„ç†å°±æ˜¯è¿™ç§æ–¹å¼ï¼Œ exp:</p>

<p>```
url = â€˜http://httpbin.org/postâ€™
d = {â€˜key1â€™: â€˜value1â€™, â€˜key2â€™: â€˜value2â€™}
r = requests.post(url, data=d)
print r.text</p>

<p>```</p>

<h4 id="multipartform-data">2.multipart/form-data</h4>

<p>é™¤äº†ä¼ ç»Ÿçš„application/x-www-form-urlencodedè¡¨å•ï¼Œæˆ‘ä»¬å¦ä¸€ä¸ªç»å¸¸ç”¨åˆ°çš„æ˜¯ä¸Šä¼ æ–‡ä»¶ç”¨çš„è¡¨å•ï¼Œè¿™ç§è¡¨å•çš„ç±»å‹ä¸ºmultipart/form-dataã€‚
è¿™åˆæ˜¯ä¸€ä¸ªå¸¸è§çš„ POST æ•°æ®æäº¤çš„æ–¹å¼ã€‚æˆ‘ä»¬ä½¿ç”¨è¡¨å•ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œå¿…é¡»è®© form çš„ enctyped ç­‰äºè¿™ä¸ªå€¼:</p>

<p>requests exp:</p>

<p>```
from requests_toolbelt import MultipartEncoder
import requests</p>

<p>m = MultipartEncoder(
    fields={â€˜field0â€™: â€˜valueâ€™, â€˜field1â€™: â€˜valueâ€™,
            â€˜field2â€™: (â€˜filenameâ€™, open(â€˜file.pyâ€™, â€˜rbâ€™), â€˜text/plainâ€™)}
    )</p>

<p>r = requests.post(â€˜http://httpbin.org/postâ€™, data=m,
                  headers={â€˜Content-Typeâ€™: m.content_type})</p>

<p>```</p>

<h4 id="applicationjson">3.application/json</h4>

<p>application/json è¿™ä¸ª Content-Typeä½œä¸ºå“åº”å¤´å¤§å®¶è‚¯å®šä¸é™Œç”Ÿã€‚å®é™…ä¸Šï¼Œç°åœ¨è¶Šæ¥è¶Šå¤šçš„äººæŠŠå®ƒä½œä¸ºè¯·æ±‚å¤´ï¼Œç”¨æ¥å‘Šè¯‰æœåŠ¡ç«¯æ¶ˆæ¯ä¸»ä½“æ˜¯åºåˆ—åŒ–åçš„ JSON å­—ç¬¦ä¸²ã€‚</p>

<p>requests exp:</p>

<p>```
url = â€˜http://httpbin.org/postâ€™
s = json.dumps({â€˜key1â€™: â€˜value1â€™, â€˜key2â€™: â€˜value2â€™})
r = requests.post(url, data=s)
print r.text</p>

<p>```</p>

<p>or</p>

<p>```
requests.post(url=â€™â€˜,data=json.dumps({â€˜key1â€™:â€™value1â€™,â€™key2â€™:â€™value2â€™}),headers={â€˜Content-Typeâ€™:â€™application/jsonâ€™})</p>

<p>```</p>

<p>or</p>

<p>```
requests.post(url=â€™â€˜,json=,headers={â€˜Content-Typeâ€™:â€™application/jsonâ€™})</p>

<p>```</p>

<h4 id="textxml">4. text/xml</h4>
<p>è·Ÿjsonç±»ä¼¼ï¼ŒXML ä½œä¸ºç¼–ç æ–¹å¼çš„è¿œç¨‹è°ƒç”¨è§„èŒƒã€‚</p>

<p>requests exp:</p>

<p>```
requests.post(url=â€™â€˜,data=â€™<?xml  ?>â€˜,headers={â€˜Content-Typeâ€™:â€™text/xmlâ€™})</p>

<p>```</p>

<h4 id="binary">5. binary</h4>

<p>ç›´æ¥äºŒè¿›åˆ¶æµæ•°æ®ä¼ è¾“ï¼Œå¤šç”¨äºä¸Šä¼ å›¾ç‰‡</p>

<p>requests exp:</p>

<p>```
requests.post(url=â€™â€˜,files={â€˜fileâ€™:open(â€˜test.xlsâ€™,â€™rbâ€™)},headers={â€˜Content-Typeâ€™:â€™binaryâ€™})</p>

<p>```</p>

<p>or</p>

<p>```
url = â€˜http://httpbin.org/postâ€™
files = {â€˜fileâ€™: open(â€˜report.txtâ€™, â€˜rbâ€™)}
r = requests.post(url, files=files)
print r.text</p>

<p>```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SSL&TLS Tips]]></title>
    <link href="https://happy123.me/blog/2019/08/04/ssl-tls-tips/"/>
    <updated>2019-08-04T09:35:42+08:00</updated>
    <id>https://happy123.me/blog/2019/08/04/ssl-tls-tips</id>
    <content type="html"><![CDATA[<p>æ¯å¤©çš„æ—¥å¸¸ç¼–ç å·¥ä½œï¼šå°±æ˜¯è§£å†³ä¸€ä¸ªé—®é¢˜çš„æ—¶å€™å†åˆ›é€ å¦å¤–ä¸€ä¸ªé—®é¢˜ Orzâ€¦..</p>

<p>è¯è¯´åˆšæ‰ç”Ÿæˆä¸€ä¸ªç§é’¥çš„æ—¶å€™ï¼Œ Python3ç»‘å®šlibssl1.1 åˆå´©äº†ï¼›æ­£åœ¨ç—›è‹¦æ€è€ƒä¸­~~~</p>

<!-- more -->

<p>ç°åœ¨æœ‰ä¸¤ä¸ªé€‰æ‹©:</p>

<ol>
  <li>æ”¾å¼ƒsslåŠ¨æ€åº“è°ƒç”¨ï¼Œåæ­£æˆ‘åªç”¨ECDSAï¼Œæ‰€ä»¥æ‰¾ä¸ªåŸç”Ÿåº“æ¥ç”¨å¥½å•¦</li>
  <li>æ­»ç£•opensslï¼ŒæŠŠå®ƒå½»åº•ææ˜ç™½</li>
</ol>

<p>åˆ©å¼Šæƒè¡¡ä¹‹ä¸‹æˆ‘é€‰æ‹©äº†1ï¼Œä¸è¿‡å½“ç„¶æˆ‘ä¹Ÿåœ¨2ä¸ŠèŠ±äº†ä¸€ç‚¹æ—¶é—´ï¼Œå¤ä¹ äº†ä¸€ä¸‹åŸºç¡€çŸ¥è¯†ï¼Œåœ¨æ­¤è®°å½•ä¸‹æ¥ã€‚</p>

<h3 id="libssl3">libssl3æ˜¯ä¸ªä»€ä¹ˆä¸œä¸œ</h3>

<p>åœ¨æ¢ç©¶libssl.soçš„æ—¶å€™ï¼Œæˆ‘æ— æ„å‘ç°æˆ‘çš„ç³»ç»Ÿé‡Œé¢è¿˜æœ‰ä¸€ä¸ªlibssl3.soï¼›è¿™ä¸ªæ˜¯ä»€ä¹ˆä¸œä¸œï¼Ÿæˆ‘å°è±¡é‡Œé¢opensslè¿˜åªæœ‰1.xç‰ˆæœ¬æ‰å¯¹ï¼›</p>

<p>æˆ‘åœ¨ubuntu16.04ä¸‹æŸ¥çœ‹è¿™ä¸ªsoæ–‡ä»¶æ¥æº;</p>

<p>```
~ locate libssl3.so
/usr/lib/x86_64-linux-gnu/libssl3.so</p>

<p>```</p>

<p>nmçœ‹ä¸€ä¸‹:</p>

<p>```
~ nm /usr/lib/x86<em>64-linux-gnu/libssl3.so
nm: /usr/lib/x86</em>64-linux-gnu/libssl3.so: no symbols</p>

<p>```</p>

<p>å¥‡æ€ªï¼Œæ²¡æœ‰ä»»ä½•ç¬¦å·ï¼›ç»§ç»­ç”¨lddçœ‹ä¸€ä¸‹ï¼š</p>

<p>```
~ ldd /usr/lib/x86<em>64-linux-gnu/libssl3.so
ldd /usr/lib/x86</em>64-linux-gnu/libssl3.so
        linux-vdso.so.1 =&gt;  (0x00007ffe833bb000)
        libnss3.so =&gt; /usr/lib/x86<em>64-linux-gnu/libnss3.so (0x00007faf3cc8a000)
        libnssutil3.so =&gt; /usr/lib/x86</em>64-linux-gnu/libnssutil3.so (0x00007faf3ca5d000)
        libplc4.so =&gt; /usr/lib/x86<em>64-linux-gnu/libplc4.so (0x00007faf3c858000)
        libnspr4.so =&gt; /usr/lib/x86</em>64-linux-gnu/libnspr4.so (0x00007faf3c619000)
        libpthread.so.0 =&gt; /lib/x86<em>64-linux-gnu/libpthread.so.0 (0x00007faf3c3fc000)
        libc.so.6 =&gt; /lib/x86</em>64-linux-gnu/libc.so.6 (0x00007faf3c032000)
        libz.so.1 =&gt; /lib/x86<em>64-linux-gnu/libz.so.1 (0x00007faf3be18000)
        libplds4.so =&gt; /usr/lib/x86</em>64-linux-gnu/libplds4.so (0x00007faf3bc14000)
        libdl.so.2 =&gt; /lib/x86<em>64-linux-gnu/libdl.so.2 (0x00007faf3ba10000)
        librt.so.1 =&gt; /lib/x86</em>64-linux-gnu/librt.so.1 (0x00007faf3b808000)
        /lib64/ld-linux-x86-64.so.2 (0x00007faf3d21d000)</p>

<p>```</p>

<p>å—¯ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªæœ‰æ„æ€çš„ä¾èµ–:libnss3.so</p>

<p>å†ç”¨å‘½ä»¤dpkgçœ‹ä¸€ä¸‹</p>

<p>```
~ dpkg -S /usr/lib/x86<em>64-linux-gnu/libnss3.so
libnss3:amd64: /usr/lib/x86</em>64-linux-gnu/libnss3.so</p>

<p>```</p>

<p>åŸºæœ¬ä¸Šç¡®å®šæ˜¯libnss3è¿™ä¸ªåº“å¼•å…¥çš„libssl3.soäº†ï¼Œæœ€åå†ç”¨dpkgç¡®è®¤ä¸€ä¸‹:</p>

<p>```
~ dpkg-query -L libnss3
/.
/usr
/usr/lib
/usr/lib/x86<em>64-linux-gnu
/usr/lib/x86</em>64-linux-gnu/libnssutil3.so
/usr/lib/x86<em>64-linux-gnu/nss
/usr/lib/x86</em>64-linux-gnu/nss/libfreebl3.chk
/usr/lib/x86<em>64-linux-gnu/nss/libnssckbi.so
/usr/lib/x86</em>64-linux-gnu/nss/libsoftokn3.so
/usr/lib/x86<em>64-linux-gnu/nss/libsoftokn3.chk
/usr/lib/x86</em>64-linux-gnu/nss/libfreeblpriv3.chk
/usr/lib/x86<em>64-linux-gnu/nss/libfreeblpriv3.so
/usr/lib/x86</em>64-linux-gnu/nss/libnssdbm3.chk
/usr/lib/x86<em>64-linux-gnu/nss/libnssdbm3.so
/usr/lib/x86</em>64-linux-gnu/nss/libfreebl3.so
/usr/lib/x86<em>64-linux-gnu/nss/libnsssysinit.so
/usr/lib/x86</em>64-linux-gnu/libsmime3.so
/usr/lib/x86<em>64-linux-gnu/libnss3.so
/usr/lib/x86</em>64-linux-gnu/libssl3.so
/usr/share
/usr/share/doc
/usr/share/doc/libnss3
/usr/share/doc/libnss3/copyright
/usr/share/doc/libnss3/changelog.Debian.gz
/usr/share/lintian
/usr/share/lintian/overrides
/usr/share/lintian/overrides/libnss3</p>

<p>```</p>

<h3 id="libnss3">libnss3æ˜¯ä¸ªä»€ä¹ˆä¸œä¸œ?</h3>

<p>```
apt-cache show libnss3</p>

<p>```</p>

<p>çœ‹äº†ä¸€ä¸‹ï¼Œå‘ç°æ˜¯mozillaåŸºé‡‘ä¼šæå¾—ä¸œä¸œï¼›å†googleä¸€ä¸‹ï¼Œå‘ç°æ˜¯è‡ªå·±å­¤é™‹å¯¡é—»äº†ï¼›</p>

<p>åŸæ¥ï¼ŒSSL&amp;TSLçš„å®ç°ï¼Œä¸åªæ˜¯opensslä¸€å®¶ç‹¬å¤§ï¼ŒåƒMozilla Firefoxå°±ç”¨è‡ªå®¶å®ç°çš„Nssï¼›</p>

<p>Google Chromeä¹‹å‰ä¹Ÿæ˜¯ç”¨Nssçš„ï¼Œåæ¥è¿ç§»åˆ°äº†opensslï¼Œå†åæ¥ï¼Œ2014å¹´ï¼Œopenssl1.0.1å‡ºç°äº†heartbeat æ¼æ´ï¼ŒGoogleå¹²è„†è‡ªå·±å¼€äº†ä¸ªåˆ†æ”¯ï¼Œç”¨è‡ªå·±å®šåˆ¶çš„openssläº†ï¼›</p>

<p>è‡³äºWindowså¹³å°çš„ï¼Œè¿˜æœ‰C++é˜µè¥çš„ï¼Œéƒ½æœ‰è‡ªå·±å®ç°çš„sslåº“ï¼Œå…·ä½“å¯å‚è§:</p>

<p>https://www.usenix.org/conference/usenixsecurity15/technical-sessions/presentation/de-ruiter</p>

<h3 id="nsscentos">nssåœ¨centosä¸­</h3>

<p>æœç´ çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘æƒŠå¥‡çš„å‘ç°ï¼Œubuntuå’Œcentosä¸Šé¢çš„curlï¼Œç«Ÿç„¶é“¾æ¥çš„libsslä¹Ÿä¸ä¸€æ ·ï¼š</p>

<p>ubuntuä¸Šçš„curlé»˜è®¤é“¾æ¥çš„æ˜¯opensslï¼Œè€Œcentosä¸Šé¢é»˜è®¤é“¾æ¥çš„æ˜¯libnss3ï¼›</p>

<p>è€äººå¯»å‘³å•Šï¼Œè«éredhatç³»çš„äººå‘ç°äº†ä»€ä¹ˆ~~~~</p>

<p>åšäº‹è¦åšå…¨å¥—ï¼Œæˆ‘åˆ†åˆ«åˆ‡æ¢åˆ°ubuntu16.04å’Œcentos7.2ä¸Šé¢ï¼Œçœ‹çœ‹ä»–ä»¬å®˜æ–¹ä»“åº“ä¸­è‡ªå¸¦çš„curlæ˜¯å¦‚ä½•ç¼–è¯‘çš„ã€‚</p>

<h4 id="centos72">centos7.2</h4>

<p>```
~ rpm -q â€“requires curl
libc.so.6()(64bit)
libc.so.6(GLIBC<em>2.14)(64bit)
libc.so.6(GLIBC</em>2.17)(64bit)
libc.so.6(GLIBC<em>2.2.5)(64bit)
libc.so.6(GLIBC</em>2.3)(64bit)
libc.so.6(GLIBC<em>2.4)(64bit)
libc.so.6(GLIBC</em>2.7)(64bit)
libcurl = 7.29.0-51.el7
libcurl.so.4()(64bit)
libdl.so.2()(64bit)
libnspr4.so()(64bit)
libnss3.so()(64bit)
libnssutil3.so()(64bit)
libplc4.so()(64bit)
libplds4.so()(64bit)
libpthread.so.0()(64bit)
libpthread.so.0(GLIBC_2.2.5)(64bit)
libsmime3.so()(64bit)
libssl3.so()(64bit)
libz.so.1()(64bit)
rpmlib(CompressedFileNames) &lt;= 3.0.4-1
rpmlib(FileDigests) &lt;= 4.6.0-1
rpmlib(PayloadFilesHavePrefix) &lt;= 4.0-1
rtld(GNU_HASH)
rpmlib(PayloadIsXz) &lt;= 5.2-1</p>

<p>```
ç”¨çš„æ˜¯libcurl = 7.29.0-51.el7ï¼›</p>

<p>```
~ rpm -q â€“requires libcurl
/sbin/ldconfig
libc.so.6()(64bit)
libc.so.6(GLIBC<em>2.14)(64bit)
libc.so.6(GLIBC</em>2.15)(64bit)
libc.so.6(GLIBC<em>2.16)(64bit)
libc.so.6(GLIBC</em>2.17)(64bit)
libc.so.6(GLIBC<em>2.2.5)(64bit)
libc.so.6(GLIBC</em>2.3)(64bit)
libc.so.6(GLIBC<em>2.3.4)(64bit)
libc.so.6(GLIBC</em>2.4)(64bit)
libc.so.6(GLIBC<em>2.7)(64bit)
libcom_err.so.2()(64bit)
libdl.so.2()(64bit)
libgssapi_krb5.so.2()(64bit)
libgssapi_krb5.so.2(gssapi_krb5</em>2<em>MIT)(64bit)
libidn.so.11()(64bit)
libidn.so.11(LIBIDN</em>1.0)(64bit)
libk5crypto.so.3()(64bit)
libkrb5.so.3()(64bit)
liblber-2.4.so.2()(64bit)
libldap-2.4.so.2()(64bit)
libnspr4.so()(64bit)
libnss3.so()(64bit)
libnss3.so(NSS<em>3.10)(64bit)
libnss3.so(NSS</em>3.12.1)(64bit)
libnss3.so(NSS<em>3.12.5)(64bit)
libnss3.so(NSS</em>3.2)(64bit)</p>

<p>â€¦.</p>

<p>```
çœ‹åˆ°libnss3äº†,é‡ç‚¹è¾“å‡ºï¼š</p>

<p>```
libnss3.so</p>

<p>```
é‚£ä¹ˆè¿™ä¸ªåŒ…æ˜¯è°æä¾›çš„ï¼Ÿè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š</p>

<p>```
~ rpm -qf /usr/lib64/libnss3.so 
    nss-3.36.0-7.1.el7<em>6.x86</em>64
~ rpm -ql nss
/etc/pki/nss-legacy
/etc/pki/nss-legacy/nss-rhel7.config
/etc/pki/nssdb
/etc/pki/nssdb/cert8.db
/etc/pki/nssdb/cert9.db
/etc/pki/nssdb/key3.db
/etc/pki/nssdb/key4.db
/etc/pki/nssdb/pkcs11.txt
/etc/pki/nssdb/secmod.db
/usr/lib64/libnss3.so
/usr/lib64/libnssckbi.so
/usr/lib64/libsmime3.so
/usr/lib64/libssl3.so
/usr/lib64/nss/libnssckbi.so
â€¦</p>

<p>```
è‡³æ­¤æ°´è½çŸ³å‡ºï¼Œè¿˜å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç†Ÿæ‚‰çš„è¯ä¹¦cert8.dbæ–‡ä»¶ï¼›ä½†å…¶å® curl æœ€ç»ˆä½¿ç”¨çš„æ ¹è¯ä¹¦åº“å¹¶ä¸æ˜¯è¯¥æ–‡ä»¶ã€‚é‚£ curl ä½¿ç”¨çš„æ ¹è¯ä¹¦æ–‡ä»¶åœ¨å“ªå„¿å‘¢ï¼Ÿ</p>

<p>ä½¿ç”¨ curl-config å‘½ä»¤è¡Œå·¥å…·ï¼Œèƒ½å¤Ÿäº†è§£æ›´å¤šï¼š</p>

<p>```
~ curl-config â€“ca                      <br />
/etc/pki/tls/certs/ca-bundle.crt</p>

<p>```</p>

<h4 id="ubuntu1604">ubuntu16.04</h4>

<p>ubuntu16ä¸Šé¢éªŒè¯ç±»ä¼¼ï¼Œä¸ä¸€ä¸€è¯´æ˜äº†~~~</p>

<p>```
~ dpkg-query -L libcurl3
/.
/usr
/usr/share
/usr/share/doc
/usr/share/doc/libcurl3
/usr/share/doc/libcurl3/copyright
/usr/share/doc/libcurl3/changelog.Debian.gz
/usr/share/doc/libcurl3/NEWS.Debian.gz
/usr/share/lintian
/usr/share/lintian/overrides
/usr/share/lintian/overrides/libcurl3
/usr/lib
/usr/lib/x86<em>64-linux-gnu
/usr/lib/x86</em>64-linux-gnu/libcurl.so.4.4.0
/usr/lib/x86<em>64-linux-gnu/libcurl.so.3
/usr/lib/x86</em>64-linux-gnu/libcurl.so.4</p>

<p>```</p>

<p>```
~ apt-cache depends  libcurl3
  Depends: libc6
  Depends: libgssapi-krb5-2
  Depends: libidn11
  Depends: libldap-2.4-2
  Depends: librtmp1
  Depends: libssl1.0.0
  Depends: zlib1g
  Recommends: ca-certificates</p>

<p>```</p>

<p>ç„¶åå¯»æ‰¾libcurlçš„ä¾èµ–åº“:</p>

<p>```
~ ldd /usr/lib/x86<em>64-linux-gnu/libcurl.so.4.4.0|grep ssl
libssl.so.1.0.0 =&gt; /lib/x86</em>64-linux-gnu/libssl.so.1.0.0 (0x00007fbdf8aa0000)</p>

<p>```</p>

<p>éªŒè¯ä¸€ä¸‹:</p>

<p>```
~ apt-cache depends openssl
openssl
  Depends: libc6
  Depends: libssl1.0.0
  Suggests: ca-certificates</p>

<p>~ apt-cache rdepends  libssl1.0.0 | grep curl
  libcurl3  </p>

<p>```</p>

<h3 id="section">æ€»ç»“</h3>

<p>æ‰€ä»¥è¿™å°±æ˜¯æƒ³è¦è§£å†³ä¸€ä¸ªé—®é¢˜çš„ä¸­é€”ï¼Œåˆè¢«å¸¦åˆ°äº†å¦å¤–ä¸€æ¡å°è·¯ä¸Šï¼›è¯¥è¯´æˆ‘æ˜¯è¿˜æœ‰é‚£ä¹ˆä¸€ç‚¹å¥½å¥‡å¿ƒå‘¢ï¼Ÿè¿˜æ˜¯æ³¨æ„åŠ›ä¸é›†ä¸­å‘¢ï¼Ÿ</p>

<p>Orzâ€¦â€¦â€¦</p>

<h3 id="section-1">å‚è€ƒèµ„æ–™:</h3>

<p>https://www.ruanyifeng.com/blog/2014/02/ssl_tls.html</p>

<p>https://www.usenix.org/conference/usenixsecurity15/technical-sessions/presentation/de-ruiter</p>

<p>https://zh.wikipedia.org/wiki/%E5%BF%83%E8%84%8F%E5%87%BA%E8%A1%80%E6%BC%8F%E6%B4%9E</p>

<p>https://www.lbbniu.com/6680.html</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Libssl Segfaults on python3.6 With Threading]]></title>
    <link href="https://happy123.me/blog/2019/08/03/libssl-segfaults-on-python3-dot-6-with-threading/"/>
    <updated>2019-08-03T20:23:47+08:00</updated>
    <id>https://happy123.me/blog/2019/08/03/libssl-segfaults-on-python3-dot-6-with-threading</id>
    <content type="html"><![CDATA[<p>openssl1.0.0 å’Œ openssl1.0.1 ä½¿ç”¨Python3.6çš„ç»‘å®š:</p>

<!-- more -->

<p>```
import ctypes
import logging</p>

<p>try:
    ssl_library = ctypes.cdll.LoadLibrary(â€˜libeay32.dllâ€™)
except Exception:
    ssl_library = ctypes.cdll.LoadLibrary(â€˜libssl.soâ€™)</p>

<p>def check_result(val, func, args):
    if val == 0:
        raise ValueError
    else:
        return ctypes.c_void_p(val)</p>

<h1 id="ssllibraryeckeynewrestype--ctypescvoidp">ssl_library.EC_KEY_new.restype = ctypes.c_void_p</h1>
<p>ssl_library.EC_KEY_new_by_curve_name.restype = ctypes.c_void_p
ssl_library.EC_KEY_new_by_curve_name.errcheck = check_result</p>

<p>k = ssl_library.EC_KEY_new_by_curve_name(NID_secp256k1)</p>

<p>if ssl_library.EC_KEY_generate_key(k) != 1:
    raise Exception(â€œinternal errorâ€)
ssl_library.EC_KEY_free(k)</p>

<p>```</p>

<p>è¿™æ®µä»£ç åœ¨å¤šçº¿ç¨‹çš„æ—¶å€™ä¼šå‡ºç°segmentation fault errorï¼› googleä¸€ä¸‹å‘ç°<code>EC_KEY_generate_key</code>å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼›äºæ˜¯:</p>

<p>```
openssl_locks = [threading.Lock() for _ in range(ssl_library.CRYPTO_num_locks())]
openssl_locking_function = ctypes.CFUNCTYPE(None, ctypes.c_int, ctypes.c_int, ctypes.c_char_p, ctypes.c_int)
openssl_threadid_function = ctypes.CFUNCTYPE(ctypes.c_ulong)</p>

<p>@openssl_locking_function
def openssl_lock(mode, type, file, line):
    if (mode &amp; CRYPTO_LOCK) != 0:
        openssl_locks[type].acquire()
    else:
        openssl_locks[type].release()</p>

<p>@openssl_threadid_function
def openssl_threadid():
    v = threading.current_thread().ident
    return v</p>

<p>ssl_library.CRYPTO_set_id_callback(openssl_threadid)
ssl_library.CRYPTO_set_locking_callback(openssl_lock)</p>

<p>```</p>

<p>è¯¡å¼‚çš„æ˜¯è¿˜æ˜¯ä¸å®šæ—¶çš„crashæ‰ï¼Œåˆä¸€é€šgoogleä¹‹åå‘ç°æ˜¯openssl1.0.0çš„å®ç°é—®é¢˜ï¼Œå‚è€ƒ:</p>

<p>https://bugs.python.org/issue29340</p>

<p>éœ€è¦å‡çº§è‡³openssl1.1.0ï¼›</p>

<p>è¿™ä¸ªæ˜¯ä»Šå¤©æˆ‘åœ¨å®ç°ä¸€ä¸ªç®€å•çš„æ¯”ç‰¹å¸é’±åŒ…çš„æ—¶å€™å‘ç°çš„ï¼Œç”¨å‡½æ•°ågoogleäº†ä¸€é€šæ²¡å‘ç°é—®é¢˜ï¼›æŒ‚ä¸Šgdbæ‰è¿½è¸ªåˆ°äº†libåº“é‡Œé¢ï¼›</p>

<p>æˆ‘å½“æ—¶é€šè¯»äº†electrumçš„ä»£ç ï¼Œè¿˜çº³é—·ä»–ä¸ºå•¥è‡ªå·±å®ç°äº†ä¸€éECDSAï¼Œè¿™å›æ˜ç™½äº†ï¼›</p>

<p>åŸæ¥è§£å†³è¿™ç§é—®é¢˜è¿˜è›®æœ‰å…´è‡´çš„ï¼Œç°åœ¨æ˜¯è¶Šæ¥è¶Šæ‡’ï¼Œæœ‰æ—¶å€™è§‰å¾—è¿™æ ·æ•ˆç‡çœŸä½å•Šï¼Œéš¾é“å·²ç»åˆ°äº†æ™ºåŠ›è¡°é€€æœŸäº†ï¼Œè¯è¯´ç¨‹åºå‘˜æœ‰ä¸ª35å²é™åˆ¶ï¼Œæˆ‘åŸæ¥æ˜¯ä¸ä¿¡çš„ï¼Œç°åœ¨æœ‰ç‚¹ä½“ä¼šäº†~~~</p>
]]></content>
  </entry>
  
</feed>
