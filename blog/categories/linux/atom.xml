<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Linux | Living a Simple Life is a Happy Life]]></title>
  <link href="http://happy123.me/blog/categories/linux/atom.xml" rel="self"/>
  <link href="http://happy123.me/"/>
  <updated>2018-02-12T22:01:31+08:00</updated>
  <id>http://happy123.me/</id>
  <author>
    <name><![CDATA[memoryboxes]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Megacli Cheat]]></title>
    <link href="http://happy123.me/blog/2016/08/05/megacli-cheat/"/>
    <updated>2016-08-05T03:21:49+08:00</updated>
    <id>http://happy123.me/blog/2016/08/05/megacli-cheat</id>
    <content type="html"><![CDATA[<p>做Raid，用到了megacli，又学了一套命令.</p>

<!-- more -->


<ul>
<li>显示Rebuid进度</li>
</ul>


<p><code>
/opt/MegaRAID/MegaCli/MegaCli64 -PDRbld -ShowProg -physdrv[20:2] -aALL
</code></p>

<ul>
<li>查看ES</li>
</ul>


<p><code>
/opt/MegaRAID/MegaCli/MegaCli64 -PDList -aAll -NoLog | grep -Ei "(enclosure|slot)"
</code></p>

<ul>
<li>查看所有硬盘的状态</li>
</ul>


<p><code>
/opt/MegaRAID/MegaCli/MegaCli64 -LDInfo -LALL -aAll
/opt/MegaRAID/MegaCli/MegaCli64 -PDList -aAll -NoLog
</code></p>

<p>如果RAID卡被设置成了writethrough。这个是完全不利用卡上内存的一种做法，操作系统需要确认磁盘全部写入后再返回，io latency很大，而且性能差。</p>

<p>可以强制让他一定使用writeback模式，命令：</p>

<p><code>
/opt/MegaCli64 -LDSetProp -ForcedWB -Immediate -Lall –aAll
</code></p>

<p>RAID卡上电池没电，单个盘损坏，都会造成RAID策略的变化，所以需要及时检测。</p>

<ul>
<li>查看所有Virtual Disk的状态</li>
</ul>


<p><code>
/opt/MegaRAID/MegaCli/MegaCli64 -LdPdInfo -aAll -NoLog
</code></p>

<p>RAID Level对应关系：</p>

<pre><code>RAID Level : Primary-1, Secondary-0, RAID Level Qualifier-0 RAID 1
RAID Level : Primary-0, Secondary-0, RAID Level Qualifier-0 RAID 0
RAID Level : Primary-5, Secondary-0, RAID Level Qualifier-3 RAID 5
RAID Level : Primary-1, Secondary-3, RAID Level Qualifier-0 RAID 10
</code></pre>

<ul>
<li>在线做Raid</li>
</ul>


<p><code>
/opt/MegaRAID/MegaCli/MegaCli64 -CfgLdAdd -r0[0:11] WB NORA Direct CachedBadBBU -strpsz64 -a0 -NoLog
/opt/MegaRAID/MegaCli/MegaCli64 -CfgLdAdd -r5 [12:2,12:3,12:4,12:5,12:6,12:7] WB Direct -a0
</code></p>

<ul>
<li>点亮指定硬盘（定位）</li>
</ul>


<p><code>
/opt/MegaRAID/MegaCli/MegaCli64 -PdLocate -start -physdrv[252:2] -a0
</code></p>

<ul>
<li>清除Foreign状态</li>
</ul>


<p><code>
/opt/MegaRAID/MegaCli/MegaCli64 -CfgForeign -Clear -a0
</code></p>

<ul>
<li>查看RAID阵列中掉线的盘</li>
</ul>


<p><code>
/opt/MegaRAID/MegaCli/MegaCli64 -pdgetmissing -a0
</code></p>

<ul>
<li>替换坏掉的模块</li>
</ul>


<p><code>
/opt/MegaRAID/MegaCli/MegaCli64 -pdreplacemissing -physdrv[12:10] -Array5 -row0 -a0
</code></p>

<ul>
<li>手动开启rebuid</li>
</ul>


<p><code>
/opt/MegaRAID/MegaCli/MegaCli64 -pdrbld -start -physdrv[12:10] -a0
</code></p>

<ul>
<li>查看Megacli的log</li>
</ul>


<p><code>
/opt/MegaRAID/MegaCli/MegaCli64 -FwTermLog dsply -a0 &gt; adp2.log
</code></p>

<ul>
<li>设置HotSpare</li>
</ul>


<p><code>
/opt/MegaRAID/MegaCli/MegaCli64 -pdhsp -set [-Dedicated [-Array2]] [-EnclAffinity] [-nonRevertible] -PhysDrv[4:11] -a0
/opt/MegaRAID/MegaCli/MegaCli64 -pdhsp -set [-EnclAffinity] [-nonRevertible] -PhysDrv[32：1}] -a0
</code></p>

<ul>
<li>关闭Rebuild</li>
</ul>


<p><code>
/opt/MegaRAID/MegaCli/MegaCli64 -AdpAutoRbld -Dsbl -a0
</code></p>

<ul>
<li>设置rebuild的速率</li>
</ul>


<p><code>
/opt/MegaRAID/MegaCli/MegaCli64 -AdpSetProp RebuildRate -30 -a0
</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to Change Systemd Service Timeout Value]]></title>
    <link href="http://happy123.me/blog/2016/07/05/how-to-change-systemd-service-timeout-value/"/>
    <updated>2016-07-05T17:56:04+08:00</updated>
    <id>http://happy123.me/blog/2016/07/05/how-to-change-systemd-service-timeout-value</id>
    <content type="html"><![CDATA[<h1>show value</h1>

<p><code>
systemctl show SERVICE_NAME.service -p TimeoutStopUSec
</code></p>

<h1>change value</h1>

<p><code>
vim /usr/lib/systemd/system/node.service
</code>
TimeoutStopUSec = 900
<code>
systemctl daemon-reexec
</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Migrate Centos7 From Centos6]]></title>
    <link href="http://happy123.me/blog/2015/12/22/migrate-centos7-from-centos6/"/>
    <updated>2015-12-22T11:58:43+08:00</updated>
    <id>http://happy123.me/blog/2015/12/22/migrate-centos7-from-centos6</id>
    <content type="html"><![CDATA[<p>工作环境切换到Centos7 半年有余，epel仓库里的软件版本比el6更新了不少，非常方便。</p>

<p>另外systemd的引入让很多程序，尤其是开机启动上，速度提升了不少。</p>

<p>总体来说，很多细节让你感觉很舒服，值得大家尽快切换到这个版本上了。</p>

<p>下面记一下从Centos6迁移到Centos7上 常见的Question:</p>

<h2>Q: 为什么引入systemd 代替 SysV init，我就是习惯原来的 /etc/init.d/xxxx 的方法?</h2>

<p>A: 在我看来，有两点:</p>

<ol>
<li><p> 快。 真的是快，嗖嗖的快</p></li>
<li><p> 日志。 终于能取代syslog了，我对syslog素无好感，配置复杂，level巨多，还不好排障。</p></li>
</ol>


<p>参考资料:</p>

<p><a href="http://www.ibm.com/developerworks/cn/linux/1407_liuming_init3/">http://www.ibm.com/developerworks/cn/linux/1407_liuming_init3/</a></p>

<p><a href="https://wiki.archlinux.org/index.php/Systemd">https://wiki.archlinux.org/index.php/Systemd</a></p>

<h2>Q: 为什么网卡名字这么奇怪，我要原来的简单明了的办法!!!</h2>

<p>A: 呃，好吧，我觉得虽然有一堆理由，但是网卡名字这个改变可能真的是没有产品经理的弊端。你想回到从前，很简单:</p>

<ul>
<li><p>在 grub 加入 net.ifnames=0 and biosdevname=0 作为内核参数</p></li>
<li><p>在 /etc/sysconfig/network-scripts/ 内把你的网络卡配置文件换名为 ifcfg-ethX</p></li>
<li><p>假若你拥有多个界面并希望控制每个设备的名称，不想由内核作主，你似乎有必要通过 /etc/udev/rules.d/60-net.rules 盖过 /usr/lib/udev/rules.d/60-net.rules。</p></li>
</ul>


<h2>Q: grub.cfg 文件生成怎么这个奇怪，还要先配置 /etc/default/grub，再用命令生成一遍？我要直接改!!</h2>

<p>A:  醒醒吧，我对这个改动双手赞成，至少她解决了centos6上一直被人诟病的efi问题。</p>

<h2>Q: 嗯，我想问，ifconfig和 netstat哪里去了?</h2>

<p>A: 额，套用官方原话回答吧:</p>

<p>ifconfig 及 netstat 工具程序在 CentOS 5 及 6 的应用手册内被置标为降级已接近十年，而 Redhat 决定在 CentOS 7 不会缺省安装 net-utils 组件。取而代之的工具是 ss 和 ip 。假如你真的、真的很需要 ifconfig 和 netstat，你可执行 yum install net-utils。</p>

<p>更多请参考：</p>

<p><a href="https://wiki.centos.org/zh/FAQ/CentOS7#head-d04a9f331b47791774aefd7c11371934e7350ab3">https://wiki.centos.org/zh/FAQ/CentOS7#head-d04a9f331b47791774aefd7c11371934e7350ab3</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[装服务器偶得]]></title>
    <link href="http://happy123.me/blog/2015/08/07/zhuang-fu-wu-qi-ou-de/"/>
    <updated>2015-08-07T09:05:30+08:00</updated>
    <id>http://happy123.me/blog/2015/08/07/zhuang-fu-wu-qi-ou-de</id>
    <content type="html"><![CDATA[<p>最近工作需要，连续装了不少服务器。虽然做系统真是没什么技术含量的事，但做多了还是有些想法，记录下。</p>

<h2>硬件tips</h2>

<h4>Dell</h4>

<ul>
<li><p>Dell PowerEdge 2950  2U</p></li>
<li><p>Dell PowerEdge R610 2U</p></li>
<li><p>Dell PowerEdge R630 1U</p></li>
<li><p>Dell PowerEdge R710  1U</p></li>
<li><p>Dell PowerEdge R720xd 1U</p></li>
</ul>


<p>对Dell 系列的服务器印象一直很好，皮实耐折腾， R系列的兼容性也很好，开机启动速度也算是凑合。</p>

<p>但是最近发现一个问题，就是R630 系列的做了Raid5之后，分XFS分区，用clonezilla做镜像的时候非常慢。如果要调大xfs的blocksize，又需要重新编译内核，比较麻烦。</p>

<h4>HP</h4>

<ul>
<li><p>HP ProLiant DL380 Gen6  2U</p></li>
<li><p>HP ProLiant DL360 Gen9  1U</p></li>
</ul>


<p>网上对惠普 DL360系列的机器评价很好，但我对它印象不佳。</p>

<p>首先说设计，前面板只有一个usb接口，一般做系统的时候，条件简陋点，需要一个USB光驱，一套键鼠，光驱可以插后面，但是键鼠插后面太麻烦了，所以我比较喜欢前面板有两个USB接口的机器。</p>

<p>然后HP 的BIOS 自检极其缓慢，是Dell的1.5倍。很扯。</p>

<p>然后DL360系列，如果安装centos系，自编译内核的话，需要自己编译Raid驱动，这个极其不爽，而且惠普的官网找驱动，真是费力，而且kernel编出来总有种种小毛病。</p>

<p>比较值得赞扬的是 Gen9以后的机器，做Raid的界面做的挺漂亮的。但是极其坑爹的是，BIOS自检过了以后，没有明确提示按F8进Raid，一定要到网上查。而且我觉得HP的BIOS管理引导做的很啰嗦，要进三层才能看到功能。</p>

<h4>Lenovo</h4>

<ul>
<li>Lenovo System x3550 M5</li>
</ul>


<p>公司里说进了IBM的服务器，开机一看，打的Lenovo的LOGO，好吧，原来联想已经做到这个程度了。</p>

<p>机器的配置不错，说说吐槽点:</p>

<ul>
<li><p>首先自检的速度又慢了一个档次，重启一遍可以买个包子吃了。</p></li>
<li><p>BIOS 工具又是层层深入，做Raid估计要进入5级菜单才能搞定。</p></li>
<li><p>不支持centos5系了，同事打电话问客服，号称没测过centos6.4以下的，真是理直气壮</p></li>
</ul>


<h2>吐槽</h2>

<ul>
<li><p>所有的机器做Raid的那套东西大同小异，控制器都是一家的。但是界面包装有好有坏，按靠谱程度排序  HP>DELL>Lenovo</p></li>
<li><p>做好机器后，总是需要在前面贴个标签，现在机器越做越小，最直观的感觉就是前面贴个标签都找不到地方了。看人家管理，有把标签挂在上面的，有在LED屏上编号的，都不方便。为什么没有厂商在前面设计一个小卡片槽，专门放标签纸呢，我估计这个小功能肯定会讨得很多人欢心。</p></li>
<li><p>我装服务器，到现在为止一个最大的吐槽点，没有见过一家厂商解决过。就是机器自检的时候，很多显示器兼容性不好，会把左边屏幕的输出吃掉一截。最坑爹的是，每家的BIOS输出都是紧靠左边打出来的，往往会有  <code>F2=Setup</code> 前面的 <code>F2</code>被吃掉的情况，他们就不知道把输出居中一点，我只能说这些公司真是僵化了，下一个诺基亚，说不定就是惠普。</p></li>
<li><p>最后就是所有的所谓大公司，官网做的都和微软帮助一个style，就是我按照提示一步步点下去，又回到开始了，它还问我"有帮助吗?&ldquo;，已经吐槽无力了。在我看来，这些所谓的高科技大公司，其实已经比很多传统行业还恐龙了，看看他们数十年如一日的BIOS就知道了。只不过积累在那里，让他们产生自我感觉良好的错觉。这些公司死是早晚的事。</p></li>
</ul>


<h2>软件tips</h2>

<h4>centos5 &ndash;> centos6 &ndash;> centos7</h4>

<p>redhat系的的安装界面 一代比一代漂亮，也一代比一代依赖鼠标。</p>

<ul>
<li>centos5不支持鼠标，熟练后完全依赖键盘一路打下去，很方便</li>
<li>centos6 界面很朴素，但比较好用，键盘鼠标都能不是很痛苦的搞定</li>
<li>centos7 界面比较花哨了，都做到一个安装界面里，鼠标操作很方便，键盘操作很痛苦，我曾经在没有鼠标的环境下，硬是花了半个小时装了个centos7.1U</li>
</ul>


<p>孰是孰非，让后来人评说。</p>

<h4>xfs resize blocksize</h4>

<ul>
<li>xfs做文件系统的时候，试图mkfs.xfs -b &mdash;size=xxx ，不生效，默认redhat系的page_size设置的就是4K，xfs的blocksize必须不大于这个size，如果要设大，只能重新编译kernel</li>
</ul>

]]></content>
  </entry>
  
</feed>
