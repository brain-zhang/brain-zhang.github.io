<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Tools | Living a Simple Life is a Happy Life]]></title>
  <link href="https://brain-zhang.github.io/blog/categories/tools/atom.xml" rel="self"/>
  <link href="https://brain-zhang.github.io/"/>
  <updated>2022-07-26T16:02:02+08:00</updated>
  <id>https://brain-zhang.github.io/</id>
  <author>
    <name><![CDATA[brain-zhang]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Rsync Cheat]]></title>
    <link href="https://brain-zhang.github.io/blog/2022/07/26/rsync-cheat/"/>
    <updated>2022-07-26T15:35:51+08:00</updated>
    <id>https://brain-zhang.github.io/blog/2022/07/26/rsync-cheat</id>
    <content type="html"><![CDATA[<p>这条命令我用了不下百次了，但是每次还得查，老年痴呆的前兆，/(ㄒoㄒ)/~~</p>

<p><code>
rsync -acvruP --progress /opt/src1 /opt/src2  /mnt/dest/
</code></p>

<ul>
  <li>-c, –checksum 打开校验开关，强制对文件传输进行校验; 开了前置计算会很慢，文件多的时候不要用</li>
  <li>-a, –archive 归档模式，表示以递归方式传输文件，并保持所有文件属性，等于-rlptgoD</li>
  <li>-r, –recursive 对子目录以递归模式处理</li>
  <li>-u, –update 仅仅进行更新，也就是跳过所有已经存在于DST，并且文件时间晚于要备份的文件。(不覆盖更新的文件)；已经有拷贝了一半的文件的情况下不要用，不会自动更新</li>
</ul>

<p>最后，要注意路径中的斜杠处理:</p>

<p><code>
rsync -acvruP --progress /opt/src1 /mnt/dest/
</code></p>

<p>与下面的命令是不一样的</p>

<p><code>
rsync -acvruP --progress /opt/src1/ /mnt/dest/
</code></p>

<p>前者会拷贝src1目录，后者会拷贝src1目录下的文件，但是不会带src1</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ZFS Cheat]]></title>
    <link href="https://brain-zhang.github.io/blog/2022/07/26/zfs-cheat/"/>
    <updated>2022-07-26T15:14:19+08:00</updated>
    <id>https://brain-zhang.github.io/blog/2022/07/26/zfs-cheat</id>
    <content type="html"><![CDATA[<h2 id="zfs-">ZFS 使用命令小集</h2>

<h4 id="zpool">列出zpool磁盘</h4>
<p><code>
zfs list
</code></p>

<h4 id="pool">查看pool状态</h4>
<p><code>
zpool status
</code>
<!-- more --></p>

<h4 id="section">替换坏掉的硬盘</h4>
<p><code>
zpool replace -f pool0 /dev/sdb
</code></p>

<h4 id="section-1">查看是否开启重复数据删除</h4>
<p><code>
zfs get dedup pool1
</code></p>

<h4 id="section-2">开启重复数据删除</h4>
<p><code>
zfs set dedup=on pool1
</code></p>

<h4 id="section-3">获取去重比例</h4>
<p>```
# zpool get dedupratio pool1</p>

<p>NAME  PROPERTY    VALUE  SOURCE
tank  dedupratio  1.42x  -
```</p>

<h4 id="section-4">查看是否开启压缩</h4>
<p><code>
zfs get compress pool1
</code></p>

<h4 id="section-5">开启压缩</h4>
<p><code>
zfs set compress=lz4 pool1
</code></p>

<p>或者
<code>
zfs set compress=on pool1
</code></p>

<p>从2015年zfs版本后，默认压缩为lz4格式， compresss=on 即代表压缩为lz4， <a href="!http://open-zfs.org/wiki/Performance_tuning#Compression">参考</a></p>

<h4 id="section-6">获取压缩比例</h4>
<p><code>
root@ypcpve:~# zfs get compressratio zpool0
NAME    PROPERTY       VALUE  SOURCE
zpool0  compressratio  1.15x  -
</code></p>

<h3 id="section-7">强制删除不用的硬盘</h3>
<p><code>
zfs destroy -f zpool0/vm-102-disk-2
</code></p>

<h4 id="sparse">开启空间自动回收机制(sparse)</h4>
<p><code>
zfs set refreservation=0G NVMe/vm-901-disk-0
</code></p>

<h4 id="section-8">查看磁盘负载</h4>
<p><code>
zpool iostat
</code></p>

<h4 id="section-9">查看磁盘状态及容量</h4>

<p>```
root@proxmox4 ~ &gt; zfs list rpool/data/vm-100-disk-1
NAME                       USED  AVAIL  REFER  MOUNTPOINT
rpool/data/vm-100-disk-1   132G   832G    64K  -</p>

<p>root@proxmox4 ~ &gt; zfs get all rpool/data/vm-100-disk-1
NAME                      PROPERTY              VALUE                 SOURCE
rpool/data/vm-100-disk-1  type                  volume                -
rpool/data/vm-100-disk-1  creation              Mi Feb 21 13:29 2018  -
rpool/data/vm-100-disk-1  used                  132G                  -
```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to Limit Exists Running Docker Container Cpus]]></title>
    <link href="https://brain-zhang.github.io/blog/2021/11/07/how-to-limit-docker-cpus/"/>
    <updated>2021-11-07T11:05:44+08:00</updated>
    <id>https://brain-zhang.github.io/blog/2021/11/07/how-to-limit-docker-cpus</id>
    <content type="html"><![CDATA[<p><code>
docker update --cpu-period=100000 --cpu-quota=40000  &lt;container&gt;
</code></p>

<p>意思是cpu时间切分为100000份，指定容器占用40000份，即cpu占用率最高40%</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to Allow Non-root Process to Bind to Low-numbered Ports]]></title>
    <link href="https://brain-zhang.github.io/blog/2021/06/01/how-to-allow-non-root-process-to-bind-to-low-numbered-ports/"/>
    <updated>2021-06-01T16:32:31+08:00</updated>
    <id>https://brain-zhang.github.io/blog/2021/06/01/how-to-allow-non-root-process-to-bind-to-low-numbered-ports</id>
    <content type="html"><![CDATA[<h4 id="use-capnetbindservice-to-grant-low-numbered-port-access-to-a-process">Use CAP_NET_BIND_SERVICE to grant low-numbered port access to a process:</h4>

<p>With this you can grant permanent access to a specific binary to bind to low-numbered ports via the setcap command:</p>

<p><code>
sudo setcap CAP_NET_BIND_SERVICE=+eip /path/to/binary
</code></p>

<p>For more details on the e/i/p part, see cap_from_text.</p>

<p>After doing this, /path/to/binary will be able to bind to low-numbered ports. Note that you must use setcap on the binary itself rather than a symlink.</p>

<p>FROM:</p>

<p>https://superuser.com/questions/710253/allow-non-root-process-to-bind-to-port-80-and-443</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to Hide a Password Passed as Command Line Argument?]]></title>
    <link href="https://brain-zhang.github.io/blog/2021/05/22/how-to-hide-a-password-passed-as-command-line-argument/"/>
    <updated>2021-05-22T17:22:37+08:00</updated>
    <id>https://brain-zhang.github.io/blog/2021/05/22/how-to-hide-a-password-passed-as-command-line-argument</id>
    <content type="html"><![CDATA[<p>有部分软件设计的时候没有考虑命令行参数之外传递密码的途径，无法用环境变量或配置传递密码；导致任何用户用ps一看都能看到，这是重大的安全隐患；</p>

<p>解决方法很tricky:</p>

<p>https://serverfault.com/questions/592744/how-to-hide-a-password-passed-as-command-line-argument</p>

<p>https://stackoverflow.com/questions/3830823/hiding-secret-from-command-line-parameter-on-unix</p>

<p>做软件设计的时候一定要考虑命令行传递密码的替代方案；</p>
]]></content>
  </entry>
  
</feed>
