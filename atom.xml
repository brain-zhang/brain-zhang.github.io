<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Living a Simple Life is a Happy Life]]></title>
  <link href="https://happy123.me/atom.xml" rel="self"/>
  <link href="https://happy123.me/"/>
  <updated>2018-11-04T13:08:00+08:00</updated>
  <id>https://happy123.me/</id>
  <author>
    <name><![CDATA[memoryboxes]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[比特币的HD钱包演化-2]]></title>
    <link href="https://happy123.me/blog/2018/11/02/bi-te-bi-de-hdqian-bao-yan-hua-2/"/>
    <updated>2018-11-02T13:31:50+08:00</updated>
    <id>https://happy123.me/blog/2018/11/02/bi-te-bi-de-hdqian-bao-yan-hua-2</id>
    <content type="html"><![CDATA[<p>好了，有了上一篇文章的基础，我们可以从零开始完全探究数字货币的地址生成、管理方法；下面的代码均使用Linux Bash shell和Python3来处理；另外需要安装<a href="https://github.com/richardkiss/pycoin">pycoin</a>这个库。</p>

<!-- more -->


<h2>生成私钥</h2>

<p>一般来说，私钥是个256bit的随机字符。为了演示方便，我们用一个人民大众喜闻乐见的地址生成为例子，私钥选取为 sha256(&ldquo;satoshi&rdquo;)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&gt; printf "satoshi"|sha256sum
</span><span class='line'>da2876b3eb31edb4436fa4650673fc6f01f90de2f1793c4ec332b2387b09726f  -</span></code></pre></td></tr></table></div></figure>


<p>得到私钥为<code>da2876b3eb31edb4436fa4650673fc6f01f90de2f1793c4ec332b2387b09726f</code></p>

<h2>用WIF (Wallet Import Format)表示私钥</h2>

<p>我们看到私钥本质上是256bit的数字，他可以用二进制表示，也可以用16进制字符串表示，也可以用Base58Check来表示；为了在不同的钱包中方便的导入导出私钥，也为了方便二维码的生成，比特币采用了名为<code>WIF</code>的表示方法，下面列一个表格来说明:</p>

<table>
<thead>
<tr>
<th>Type </th>
<th> Prefix </th>
<th> Description </th>
<th> Private key</th>
</tr>
</thead>
<tbody>
<tr>
<td>Raw </td>
<td> None </td>
<td> 32 bytes binary </td>
<td>  11011010001010000&hellip;&hellip;&hellip;..</td>
</tr>
<tr>
<td>HEX </td>
<td> None </td>
<td> 64 hexadecimal digits </td>
<td> da2876b3eb31edb4436fa4650673fc6f01f90de2f1793c4ec332b2387b09726f</td>
</tr>
<tr>
<td>WIF </td>
<td> 5 </td>
<td> Base58Check encoding </td>
<td> 5KUN8s42BCTkQVMTy3oFfqeXE8awVskbDi6XbDMpRnFvHJW9fgk</td>
</tr>
<tr>
<td>WIF-compressed </td>
<td> K or L </td>
<td> Base58Check encoding </td>
<td> L4XnHhvLC1b4ag9L2PM9kRicQxUoYT1Q36PQ21YtLNkrAdWZNos6</td>
</tr>
</tbody>
</table>


<p>得到WIF 代码示例:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def gen_pubk_from_privk(private_key, compressed=True):
</span><span class='line'>    # private_key = codecs.encode(os.urandom(32), 'hex').decode()
</span><span class='line'>    secret_exponent = int('0x' + private_key, 0)
</span><span class='line'>    print('WIF: ' + encoding.secret_exponent_to_wif(secret_exponent, compressed=compressed))
</span><span class='line'>    public_pair = ecdsa.public_pair_for_secret_exponent(ecdsa.secp256k1.generator_secp256k1, secret_exponent)
</span><span class='line'>    print('public pair:', public_pair)
</span><span class='line'>    return public_pair
</span></code></pre></td></tr></table></div></figure>


<p>WIF格式分为非压缩和压缩格式，压缩私钥其实是对非压缩私钥后缀追加了01之后的Base58Check编码，具体生成过程为:</p>

<ul>
<li>压缩私钥: 私钥前缀80+私钥本体+压缩私钥后缀01 + 校验</li>
<li>非压缩私钥: 私钥前缀80+私钥本体+校验</li>
</ul>


<p>和字面意思相相反的是，压缩私钥比非压缩私钥还长。为啥这么折腾呢？这个我们在公钥生成的部分说明。</p>

<h2>生成公钥</h2>

<p>我们之前的文章介绍了，公钥是在椭圆曲线上的一个点，由一对坐标（x，y）组成。公钥通常表示为前缀04紧接着两个256比特的数字。其中一个256比特数字是公钥的x坐标，另一个256比特数字是y坐标。前缀04是用来区分非压缩格式公钥， 压缩格式公钥是以02或者03开头。</p>

<p>下面是由前文中的私钥所生成的公钥，其坐标x和y如下:</p>

<ul>
<li><p>public pair:</p>

<ul>
<li>x = 89077434373547985693783396961781741114890330080946587550950125758215996319671</li>
<li>y = 114001858762817543140175961139571810325965930451644331549950109688554928624341</li>
</ul>
</li>
</ul>


<p>加上前缀04，完整的公钥为:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>K = 0489077434373547985693783396961781741114890330080946587550950125758215996319671114001858762817543140175961139571810325965930451644331549950109688554928624341</span></code></pre></td></tr></table></div></figure>


<h4>为什么要区分压缩格式和非压缩格式</h4>

<p>这是一个历史问题，初版比特币运行时，中本聪没有考虑到一个问题:</p>

<p>一个公钥是一个椭圆曲线上的点(x,y)。而椭圆曲线实际是一个数学方程，曲线上的点实际是该方程的一个解。因此，如果我们知道了公钥的x坐标，就可以通过解方程 <code>y^2 % p = (x^3 + 7) % p</code>得到y坐 标。这种方案可以让我们只存储公钥的x坐标，略去y坐标，从而将公钥的大小和存储空间减少了256 bits。如果每笔交易所 需要的字节数减少了近一半，随着时间推移，节省的数据传输和存储空间还是很客观的。</p>

<p>所以后来开发团队推出了压缩公钥，为了跟之前老版本的非压缩公钥相区分，就加上了02和03作为前缀。</p>

<p>那么为什么要加两个前缀(02,03)呢？</p>

<p>因为椭圆曲线加密的公式的左边是y2 ，也就是说y的解是来自于一个平方根，可能是正值也可能是负值。更形象地说，y坐标可能在 x坐标轴的上面或者下面。椭圆曲线图中曲线是对称的，从x轴看就像对称的镜子两面。因此，如果我们略去y坐标，就必须储存y的符号（正值或者负值）。换句话说，对于给定的x值，我们需要知道y值在x轴的上面还是下面，因为它们代表椭圆曲线上不同的点，即不同的公钥。当我们在素数p阶的有限域上使用二进制算术计算椭圆曲线的时候，y坐标可能是奇数或者偶数，分别对应前面所讲的y值的正负符号。因此，为了区分y坐标的两种可能值，我们在生成压缩格式公钥时，如果y是偶数，则使用02作为前缀；如果y是奇数，则使用03作为前缀。这样就可以根据公钥中给定的x值，正确推导出对应的y坐标，从而将公钥解压缩为在椭圆曲线上的完整的点坐标。</p>

<p>总结出来，一个公钥的表现形式可以又两种:</p>

<ol>
<li>04开头的非压缩公钥: (130位十六进制 2+64+64)</li>
<li>02或03开头的压缩公钥:（66位十六进制 2+64）</li>
</ol>


<p>这样继续推导，两种表现形式可以推导出两个地址，也就是手握一个私钥，可以推导出两个合法的比特币地址。</p>

<p>这样又间接解释了为什么会有压缩私钥和非压缩私钥两种表现：</p>

<ul>
<li>当中本聪实现第一版比特币客户端钱包的时候，没有考虑到公钥可以压缩，所以采用了最原始直接的办法存储公钥和私钥</li>
<li>后来人们发现公钥可以简化存储来节省一部分空间，于是加入了压缩公钥格式，为了跟之前的非压缩公钥区分，引入了前缀</li>
<li>同样，使用压缩公钥格式的钱包导入导出私钥时，为了区分，也必须为私钥标明它对应的公钥是否压缩格式，所以也为私钥的表示引入了后缀</li>
<li>压缩私钥的意思是，由这个私钥导出的公钥表示方法是压缩的，私钥本身还需要引入一个01作为后缀，长度反而多了一个字节</li>
</ul>


<h2>从公钥到比特币地址</h2>

<p>得出公钥之后，地址的生成还要经过三重变换， 公钥为K，变换过程如下:</p>

<ol>
<li>首先计算 A = SHA256(K)</li>
<li>计算 B = RIPEMD160(A)</li>
<li>Addr = Base58Check（prefix + B）</li>
</ol>


<h4>为什么要有RIPEMD160(SHA256(K)) 的过程</h4>

<p>因为中本聪设计之初充分考虑到了安全性方面的问题，一笔交易广播后，并不是直接把公钥K暴漏在外，如果你不花费这个UTXO，暴漏的只有<code>RIPEMD160(SHA256(K))</code>这个值。假如将来有一种计算机的计算能力得到指数级别的提升，有一定可能暴力破解椭圆曲线算法。解决方案就是引入<code>RIPEMD160(SHA256(K))</code>的过程，这样要破解一个未花费的UTXO，需要逆向RIPEMD160，SHA256，secp256k1三种不同的算法，即使将来量子计算发展到实用阶段，也很难做到吧。</p>

<p>但是根据比特币交易的设计，一个地址重复使用就会暴露公钥K，所以我们推荐的安全做法就是一笔UTXO花费后就更换地址。这也是所有安全钱包的默认实现方法。</p>

<p>这个设计的唯一的瑕疵，在我看来，就是RIPEMD160将公钥的碰撞空间减小了，由 2<sup>256</sup> 减小到了 2<sup>160</sup>，当然 2<sup>160</sup> 的碰撞空间对于现有计算能力也是个天文数字，我想中本聪没有选择SHA3等算法的原因，应该是充分考虑了散列算法的复杂度和差异度，最后选择的RIPEMD160吧。</p>

<h4>Base58Check编码</h4>

<p>WIF格式和比特币地址都是用Base58Check编码表示的，Base58是Base64基础上发展来的，它具有以下功能:</p>

<ul>
<li>一个任意大小的payload。</li>
<li>一组58个字母数字符号，由易于区分的大小写字母组成(不使用0OIl)</li>
<li>一个字节的版本/应用程序信息。比特币地址为这个字节使用0x00</li>
<li>四个字节（32位）基于SHA256的错误检查代码。此代码可用于自动检测并可能纠正排版错误。</li>
<li>保留数据中零开头的额外步骤</li>
</ul>


<p>创建过程:</p>

<ol>
<li><p>获取版本字节和payload字节，并将它们连接在一起（按字节顺序）。</p></li>
<li><p>取SHA256(SHA256(步骤1的结果))的前四个字节</p></li>
<li><p>将步骤1的结果和步骤2的结果连在一起（按字节顺序）。</p></li>
<li><p>处理步骤3的结果 &ndash; 一系列字节 &ndash; 作为单个大端序号，使用正常的数学步骤（bignumber division）和下面描述的base-58字母表转换为base-58。结果应该被标准化为没有任何前导零（字符&#8217;1&#8217;）的base-58。</p></li>
<li><p>在base58中，值为零的前导字符&#8217;1&#8217;被保留用于表示整个前导零字节，就像它处于前导位置时一样，没有值作为base-58符号。必要时可以有一个或多个前导&#8217;1&#8217;来表示一个或多个前导零字节。计算步骤3结果中的前导零字节数（对于旧的比特币地址，至少有一个用于版本/应用程序字节;对于新地址，将永远不会有）。每个前导零字节在最终结果中应由其自己的字符&#8217;1&#8217;表示。</p></li>
<li><p>将步骤5中的1与步骤4 的结果连接起来。这是Base58Check的结果。</p></li>
</ol>


<p>最后综合起来，从公钥K到比特币地址完整的示意图如下:</p>

<p><img src="https://raw.githubusercontent.com/memoryboxes/memoryboxes.github.io/source/images/20181102/bg1.jpg" alt="img" /></p>

<p><code>satoshi</code>作为seed计算出私钥，进而计算出公钥K之后，最终进一步生成地址</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def genaddress_from_pubk(compressed=True)
</span><span class='line'>    # 首先计算 RIPEMD160(SHA256(K))
</span><span class='line'>    ripemd160 = encoding.public_pair_to_hash160_sec(public_pair, compressed=compressed)
</span><span class='line'>    # 再用Base58Check计算最终地址
</span><span class='line'>    addr = encoding.hash160_sec_to_bitcoin_address(ripemd160)
</span><span class='line'>    return addr</span></code></pre></td></tr></table></div></figure>


<p>因为公钥存在压缩形式和非压缩两种形式，所以完整的结果是:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>seed: satoshi
</span><span class='line'>sha256 private key: da2876b3eb31edb4436fa4650673fc6f01f90de2f1793c4ec332b2387b09726f
</span><span class='line'>
</span><span class='line'>compress address
</span><span class='line'>WIF: L4XnHhvLC1b4ag9L2PM9kRicQxUoYT1Q36PQ21YtLNkrAdWZNos6
</span><span class='line'>hash160: 0a8ba9e453383d4561cbcdda36e5789c2870dd41
</span><span class='line'>Bitcoin address:1xm4vFerV3pSgvBFkyzLgT1Ew3HQYrS1V
</span><span class='line'>
</span><span class='line'>uncompress address
</span><span class='line'>WIF: 5KUN8s42BCTkQVMTy3oFfqeXE8awVskbDi6XbDMpRnFvHJW9fgk
</span><span class='line'>hash160: 650d0497e014e60d4680fce6997d405de264f042
</span><span class='line'>Bitcoin address:1ADJqstUMBB5zFquWg19UqZ7Zc6ePCpzLE</span></code></pre></td></tr></table></div></figure>


<p><code>satoshi</code>作为seed生成了两个地址:</p>

<p><code>1xm4vFerV3pSgvBFkyzLgT1Ew3HQYrS1V</code>和<code>1ADJqstUMBB5zFquWg19UqZ7Zc6ePCpzLE</code>，这都是两个正在使用的地址哦，到今天为止还有热心人源源不断的为<code>1ADJqstUMBB5zFquWg19UqZ7Zc6ePCpzLE</code>转账一些零钱作为中本聪的纪念。你可以将WIF导入钱包，然后运行一个全节点，在bitcoin.conf文件中加入<code>walletnotify</code>这个选项，关联一个脚本，当收到比特币时就自动转账到自己的地址，参与这两个地址的抽奖哦。</p>

<h2>一些Base58Check版本前缀和编码后的结果</h2>

<p>看到这里，我们发现Base58Check 编码的过程中，最后一步会引入一个前缀。而在比特币中，除了WIF私钥和地址，大多数需要向用户展示的数据都使用Base58Check编码，理所当然的，引入了不同的前缀来区分不同的信息，下面展示了一些版本前缀和他们对应的Base58格式:</p>

<table>
<thead>
<tr>
<th>Type </th>
<th> Version prefix </th>
<th> Base58 result prefix</th>
</tr>
</thead>
<tbody>
<tr>
<td>Bitcoin Address </td>
<td> 0x00 </td>
<td> 1</td>
</tr>
<tr>
<td>Pay to Script Hash Address </td>
<td> 0x05 </td>
<td> 3</td>
</tr>
<tr>
<td>Bitcoin Testnet Address </td>
<td> 0x5F </td>
<td> m or n</td>
</tr>
<tr>
<td>Private Key WIF </td>
<td> 0x80 </td>
<td> 5, K or L</td>
</tr>
<tr>
<td>BIP-38 Encrypted Private Key </td>
<td> 0x0142 </td>
<td> 6P</td>
</tr>
<tr>
<td>BIP-32 Encrypted public Key </td>
<td> 0x0488B21E </td>
<td> xpub</td>
</tr>
</tbody>
</table>


<p>除了我们已经提到的WIF和Bitcoin Address，我们还发现了奇怪的BIP-38和BIP-32，这个需要到解释比特币原始交易编码的时候来讲解。</p>

<h2>Brain Wallet</h2>

<p>好啦，我们上面已经完整的再现了由一个 seed单词 <code>satoshi</code>，导出两个比特币地址的过程；你只要记好<code>satoshi</code>这个单词，就可以在世界上的任何地方，任何时间，掌管发送给<code>1xm4vFerV3pSgvBFkyzLgT1Ew3HQYrS1V</code>和<code>1ADJqstUMBB5zFquWg19UqZ7Zc6ePCpzLE</code>这两个地址的比特币了。</p>

<p>你不需要银行账号，不需要密保卡，只需要有个可以联网的地方，就能秘密发送交易啦。将来有了免费的卫星网络的话，我想你都不用登陆互联网，可能在家里屋顶上架个锅，淘宝买些零件天线DIY一个设备，要转帐的时候，只要输入<code>satoshi</code>就可以秘密完成数亿美元的汇款，而且丝毫不用担心这个账户被政府查封，世界上也只有你一个人能动用这个账户，真是完美的洗钱逃汇工具！也难怪有人说，比特币是人类历史上第一次用技术手段保证了财产的完全私有权。</p>

<p>这个<code>satoshi</code>的seed，就是所谓脑钱包的口令，相对于天书一般的256 bits私钥无疑更好记忆，早期这样的工具非常受欢迎，到现在为止你也可以到这个<a href="https://brainwalletx.github.io/">在线工具</a> 去重复我们以上推导的所有过程。</p>

<p>但是这个方法有个致命的弱点，他的安全性完全取决于seed这个单词的复杂度，像<code>satoshi</code>这样的seed，就像<code>123456</code>的密码一样，不用说大家都知道安全度为0啊。</p>

<p>而且你自以为选取生日啊、姓名缩写啊、恋人海誓山盟的话语啊，这些东西作为seed，其实也是非常脆弱的。总有人孜孜不倦的遍历所有可能的seed。这在后期导致了非常多的hack事件。</p>

<p>截至2018-10，我检索区块链，统计公开的比特币地址已经超过了3亿个，如果有万分之一的地址是由脑钱包生成的话，不安全的地址也超过了3w个，所以后来脑钱包这种方式就不被推荐了。</p>

<p>下面可以列举一些已经公开的seed，这都是我用一些公开语料库随意碰撞出来的，你就知道这种方法的危险性啦：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>FINAL_CRACK_ADDRESS: hash160:sha256:seed:address:wif-priv
</span><span class='line'>FINAL_CRACK_ADDRESS:0a8ba9e453383d4561cbcdda36e5789c2870dd41:c:sha256:satoshi:1xm4vFerV3pSgvBFkyzLgT1Ew3HQYrS1V:L4XnHhvLC1b4ag9L2PM9kRicQxUoYT1Q36PQ21YtLNkrAdWZNos6
</span><span class='line'>FINAL_CRACK_ADDRESS:650d0497e014e60d4680fce6997d405de264f042:u:sha256:satoshi:1ADJqstUMBB5zFquWg19UqZ7Zc6ePCpzLE:5KUN8s42BCTkQVMTy3oFfqeXE8awVskbDi6XbDMpRnFvHJW9fgk
</span><span class='line'>FINAL_CRACK_ADDRESS:c71e3a0989754d4ffae45a1c6ef8e348539cd83c:u:sha256:satoshinakamoto:1K9qgN3H2wB2v3LwJEBDbRRJ3znHXEQP4Y:5HqE1vZMMLc7jZRF5wZb79QexyCguNeNdaHLdKTGndvLBrCHD31
</span><span class='line'>FINAL_CRACK_ADDRESS:ec42ad7fd54f931274b83f6137379206e458b106:u:sha256:1satoshi:1NYEM85RpgkSofLqDfwjb21o3MD4ibSo49:5JSGPQ2Jw1P5cVi2L8LeuWnMF5H8rLGrPPgVM2XE1cahG1BQDzY
</span><span class='line'>FINAL_CRACK_ADDRESS:fd8d22e02b3a41bc38f69516c43f7ebd6268e16b:u:sha256:satoshi nakamoto:1Q7f2rL2irjpvsKVys5W2cmKJYss82rNCy:5K7EWwEuJu9wPi4q7HmWQ7xgv8GxZ2KqkFbjYMGvTCXmY22oCbr
</span><span class='line'>FINAL_CRACK_ADDRESS:0000d85a71f305a1c907cdc7437c43b2eecc35e5:u:sha256:CHARINA143:11121ioKu4MCB1LLzPF98AVtzFsEg7UYKm:5JhayTrDhzDHqCg2v16Y2gZWi4kWF6BFoZR3MyaaxWtyKHzKJ8d
</span><span class='line'>FINAL_CRACK_ADDRESS:0002439f087ffefb973c5b9bbd52f509984d3cbe:c:sha256:purple99:113iKJcZeRxEYRVcWNgVxmjodPAisDZ45:KxFLoyseSyVtKGXQNkYBajT8EqviQSuH64Y6GE1g6KXuvcFaSrqc
</span><span class='line'>FINAL_CRACK_ADDRESS:00027a0ef2b9295011b10b089c8caf2e69f6b6f7:u:sha256:bridesmaid:113y6FCRm2WHh5Aru2R7ot37wkNDtxqf3:5JsYc8oXiHBJm9rzRPJHaCSYBBx7KCTx5L81rqRMZBArsdZTsan
</span><span class='line'>FINAL_CRACK_ADDRESS:00030fa763130b5310afe68b12204009e60e935c:u:sha256:masturbating:114fh9qiRhubJJDV5rCthFxmGyYeLQ2B6:5J8TgeF9jU3BPRrsCD75Ks4a6aWxgzLKENDSbsLufDTWq7evCQa
</span><span class='line'>FINAL_CRACK_ADDRESS:0005736b486f87e5823909a89eb48dda185d3956:u:sha256:nitro:117XjTn3UdBNjVo3KsB17WRFDDmcW2pPa:5JkUWsPzNEZEvMFwWQjoXCeem5LL6LDcC7K6H1LWiwXFAA9LFo1
</span><span class='line'>FINAL_CRACK_ADDRESS:00080beae5c3a433fbae8ff0b69e705ac3ce5464:u:sha256:resultantly:11Ae5tbiSZ7QJWh4okWJhDKuPfAvk3a13:5KftjbtsSmhy5Y42AYpfEAm4U4vQKP9VhjbS6xtFqBDhUfAGaFj
</span><span class='line'>FINAL_CRACK_ADDRESS:00083c18c738e883ebc1b5ca270569ee8f9f790e:u:sha256:suggestively:11AsAKWdMZj5ScSYRoAQ8xG4J7Y6s7cW9:5JvrusiSgSmCTV7x7f5vgdWUMLjwk153j9UXmNHvRAJ8m7rtsJD
</span><span class='line'>FINAL_CRACK_ADDRESS:000e4d1774a3fc0251e9e6caf0a8617639e80093:u:sha256:dezoxiribonukleinsav:11J8fK9qhgxdQ96ZvvXExkfFvQSPQiPKN:5KSkRxaAbk94wzzzynDNj2bzRFmJZXCrhtYj3iGU9JjUxnRXTYM
</span><span class='line'>FINAL_CRACK_ADDRESS:00135d1c8f99cc657ad1f246bc5051ad03f95d32:u:sha256:Mussolini:11QCR3sk9r4jeyMqCKGEYabGTfjzhgGdZ:5K2x6UanMSevNX7f19oB4to46C3zXoGTUBGVqv8WNtCRwJNGBGC
</span><span class='line'>FINAL_CRACK_ADDRESS:001ed6fae0af0b37126004029defcc4521b300dd:u:sha256:meagerness:11dwnVzCyGoMZcGDndQteWgR9b7FKsJMu:5JKVJhbZWXmHxj2MuttZCDaFk7TC9KBVYjbPRjztP63mmAUV6Vm
</span><span class='line'>FINAL_CRACK_ADDRESS:002607c11a2311825a087f37c95d7816e0491a9d:u:sha256:vertebrate:11nZPfxYPeDm4d4fd93BaFa1BezFRTP6F:5HsBbgzEXZEaeLRCZHs66ho2ekpFEqeAJyyBPe8YyMkCqCHWv6j
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<p>不过我们现在已经掌握到了比特币地址的生成原理，所以如何提高安全性就不用我再啰嗦了，相信你心中已有答案。</p>

<h2>那些山寨币们</h2>

<p>比特币项目是2009-01-03正式开始运行的，之后简单的复制一下比特币的代码，稍作修改就推出的山寨币们数不胜数；这些山寨币第一个要修改的，就是地址格式，以免和比特币地址混淆；</p>

<p>怎么修改呢？注意到前面Base58Check Encode的最后一步了吗？那个时候我们需要引入一个前缀作为地址的区分；得益于比特币这种前瞻性的设计，山寨币们只要改动一下这个前缀就可以了，下面列举一下我所知道的山寨币的实现：</p>

<p>引用自:
<a href="https://github.com/walletgeneratornet/WalletGenerator.net">https://github.com/walletgeneratornet/WalletGenerator.net</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>name, networkVersion, privateKeyPrefix, WIF_Start, CWIF_Start
</span><span class='line'>"2GIVE",               0x27, 0xa7, "6",    "R"
</span><span class='line'>"42coin",              0x08, 0x88, "5",    "M"
</span><span class='line'>"Acoin",               0x17, 0xe6, "8",    "b"
</span><span class='line'>"AGAcoin",             0x53, 0xd3, "8",    "Y"
</span><span class='line'>"Alphacoin",           0x52, 0xd2, "8",    "Y"
</span><span class='line'>"Alqo",                0x17, 0xc1, "7",    "V"
</span><span class='line'>"Animecoin",           0x17, 0x97, "6",    "P"
</span><span class='line'>"Anoncoin",            0x17, 0x97, "6",    "P"
</span><span class='line'>"Apexcoin",            0x17, 0x97, "6",    "P"
</span><span class='line'>"Auroracoin",          0x17, 0x97, "6",    "T"
</span><span class='line'>"Aquariuscoin",        0x17, 0x97, "6",    "P"
</span><span class='line'>"Axe",                 0x4B, 0xCB, "7",    "X"
</span><span class='line'>"BBQcoin",             0x55, 0xd5, "6",    "T"
</span><span class='line'>"Biblepay",            0x19, 0xb6, "7",    "[TU]"
</span><span class='line'>"Bitcoin",             0x00, 0x80, "5",    "[LK]"
</span><span class='line'>"BitcoinCash",         0x00, 0x80, "5",    "[LK]"
</span><span class='line'>"BitcoinDark",         0x3c, 0xbc, "7",    "U"
</span><span class='line'>"Bitcore",             0x00, 0x80, "5",    "[LK]"
</span><span class='line'>"BitcoinGold",         0x26, 0x80, "5",    "[LK]"
</span><span class='line'>"Bitconnect",          0x12, 0x92, "5",    "N"
</span><span class='line'>"Birdcoin",            0x2f, 0xaf, "6",    "[ST]"
</span><span class='line'>"BitSynq",             0x3f, 0xbf, "7",    "V"
</span><span class='line'>"BitZeny",             0x51, 0x80, "5",    "[LK]"
</span><span class='line'>"Blackcoin",           0x19, 0x99, "6",    "P"
</span><span class='line'>"BlackJack",           0x15, 0x95, "[56]", "P"
</span><span class='line'>"BlockNet",            0x1a, 0x9a, "6",    "P"
</span><span class='line'>"BolivarCoin",         0x55, 0xd5, "8",    "Y"
</span><span class='line'>"BoxyCoin",            0x4b, 0xcb, "7",    "X"
</span><span class='line'>"BunnyCoin",           0x1a, 0x9a, "6",    "P"
</span><span class='line'>"Cagecoin",            0x1f, 0x9f, "6",    "Q"
</span><span class='line'>"CampusCoin",          0x1c, 0x9c, "6",    "Q"
</span><span class='line'>"CanadaeCoin",         0x1c, 0x9c, "6",    "Q"
</span><span class='line'>"CannabisCoin",        0x1c, 0x9c, "6",    "Q"
</span><span class='line'>"Capricoin",           0x1c, 0x9c, "6",    "Q"
</span><span class='line'>"CassubianDetk",       0x1e, 0x9e, "6",    "Q"
</span><span class='line'>"CashCoin",            0x22, 0xa2, "6",    "[QR]"
</span><span class='line'>"Catcoin",             0x15, 0x95, "[56]", "P"
</span><span class='line'>"ChainCoin",           0x1c, 0x9c, "6",    "Q"
</span><span class='line'>"ColossusCoinXT",      0x1e, 0xd4, "5",    "[LK]"
</span><span class='line'>"Condensate",          0x3c, 0xbc, "7",    "U"
</span><span class='line'>"Copico",              0x1c, 0x90, "5",    "N"
</span><span class='line'>"CopperCoin",          0x1c, 0x9c, "6",    "Q"
</span><span class='line'>"Corgicoin",           0x1c, 0x9c, "6",    "Q"
</span><span class='line'>"CryptoBullion",       0x0b, 0x8b, "5",    "M"
</span><span class='line'>"CryptoClub",          0x23, 0xa3, "6",    "R"
</span><span class='line'>"Cryptoescudo",        0x1c, 0x9c, "6",    "Q"
</span><span class='line'>"Cryptonite",          0x1c, 0x80, "5",    "[LK]"
</span><span class='line'>"CryptoWisdomCoin",    0x49, 0x87, "5",    "[LM]"
</span><span class='line'>"C2coin",              0x1c, 0x9c, "6",    "Q"
</span><span class='line'>"Dash",                0x4c, 0xcc, "7",    "X"
</span><span class='line'>"DeafDollars",         0x30, 0xb0, "6",    "T"
</span><span class='line'>"DeepOnion",           0x1f, 0x9f, "6",    "Q"
</span><span class='line'>"Deutsche eMark",      0x35, 0xb5, "7",    "T"
</span><span class='line'>"Devcoin",             0x00, 0x80, "5",    "[LK]"
</span><span class='line'>"DigiByte",            0x1e, 0x9e, "6",    "Q"
</span><span class='line'>"Digitalcoin",         0x1e, 0x9e, "6",    "Q"
</span><span class='line'>"Dimecoin",            0x0f, 0x8f, "5",    "N"
</span><span class='line'>"DNotes",              0x1f, 0x9f, "6",    "Q"
</span><span class='line'>"Dogecoin",            0x1e, 0x9e, "6",    "Q"
</span><span class='line'>"DogecoinDark",        0x1e, 0x9e, "6",    "Q"
</span><span class='line'>"eGulden",             0x30, 0xb0, "6",    "T"
</span><span class='line'>"eKrona",              0x2d, 0xad, "6",    "S"
</span><span class='line'>"ELECTRA",             0x21, 0xa1, "6",    "Q"
</span><span class='line'>"Ember",               0x5c, 0x32, "2",    "8"
</span><span class='line'>"Emerald",             0x22, 0xa2, "6",    "[QR]"
</span><span class='line'>"Emercoin",            0x21, 0x80, "5",    "[LK]"
</span><span class='line'>"EnergyCoin",          0x5c, 0xdc, "8",    "Z"
</span><span class='line'>"Espers",              0x21, 0x90, "5",    "N"
</span><span class='line'>"Fastcoin",            0x60, 0xe0, "8",    "a"
</span><span class='line'>"Feathercoin",         0x0e, 0x8e, "5",    "N"
</span><span class='line'>"Fedoracoin",          0x21, 0x80, "5",    "[KL]"
</span><span class='line'>"Fibre",               0x23, 0xa3, "6",    "R"
</span><span class='line'>"Florincoin",          0x23, 0xb0, "6",    "T"
</span><span class='line'>"Flurbo",              0x23, 0x30, "6",    "8"
</span><span class='line'>"Fluttercoin",         0x23, 0xa3, "6",    "R"
</span><span class='line'>"FrazCoin",            0x23, 0xA3, "6",    "R"
</span><span class='line'>"Freicoin",            0x00, 0x80, "5",    "[LK]"
</span><span class='line'>"FUDcoin",             0x23, 0xa3, "6",    "R"
</span><span class='line'>"Fuelcoin",            0x24, 0x80, "5",    "[KL]"
</span><span class='line'>"Fujicoin",            0x24, 0xa4, "6",    "R"
</span><span class='line'>"GabenCoin",           0x10, 0x90, "5",    "N"
</span><span class='line'>"Garlicoin",           0x26, 0xb0, "6",    "T"
</span><span class='line'>"GlobalBoost",         0x26, 0xa6, "6",    "R"
</span><span class='line'>"Goodcoin",            0x26, 0xa6, "6",    "R"
</span><span class='line'>"GridcoinResearch",    0x3e, 0xbe, "7",    "V"
</span><span class='line'>"Gulden",              0x26, 0xa6, "6",    "R"
</span><span class='line'>"Guncoin",             0x27, 0xa7, "6",    "R"
</span><span class='line'>"HamRadioCoin",        0x00, 0x80, "5",    "LK"
</span><span class='line'>"HFRcoin",             0x10, 0x90, "5",    "N"
</span><span class='line'>"HOdlcoin",            0x28, 0xa8, "5",    "[LK]"
</span><span class='line'>"HTMLCoin",            0x29, 0xa9, "6",    "S"
</span><span class='line'>"HyperStake",          0x75, 0xf5, "9",    "d"
</span><span class='line'>"ImperiumCoin",        0x30, 0xb0, "6",    "T"
</span><span class='line'>"IncaKoin",            0x35, 0xb5, "7",    "T"
</span><span class='line'>"IncognitoCoin",       0x00, 0x80, "5",    "LK"
</span><span class='line'>"Influxcoin",          0x66, 0xe6, "8",    "b"
</span><span class='line'>"Innox",               0x4b, 0xcb, "7",    "X"
</span><span class='line'>"IridiumCoin",         0x30, 0xb0, "6",    "T"
</span><span class='line'>"iCash",               0x66, 0xcc, "7",    "X"
</span><span class='line'>"iXcoin",              0x8a, 0x80, "5",    "[LK]"
</span><span class='line'>"Judgecoin",           0x2b, 0xab, "6",    "S"
</span><span class='line'>"Jumbucks",            0x2b, 0xab, "6",    "S"
</span><span class='line'>"KHcoin",              0x30, 0xb0, "6",    "T"
</span><span class='line'>"KittehCoin",          0x2d, 0xad, "6",    "S"
</span><span class='line'>"Lanacoin",            0x30, 0xb0, "6",    "T"
</span><span class='line'>"Latium",              0x17, 0x80, "5",    "[LK]"
</span><span class='line'>"LBRY Credits",        0x55, 0x80, "5",    "[LK]"
</span><span class='line'>"Litecoin",            0x30, 0xb0, "6",    "T"
</span><span class='line'>"LiteDoge",            0x5a, 0xab, "6",    "S"
</span><span class='line'>"LoMoCoin",            0x30, 0xb0, "6",    "T"
</span><span class='line'>"MadbyteCoin",         0x32, 0x6e, "4",    "H"
</span><span class='line'>"MagicInternetMoney",  0x30, 0xb0, "6",    "T"
</span><span class='line'>"Magicoin",            0x14, 0x94, "5",    "[NP]"
</span><span class='line'>"Marscoin",            0x32, 0xb2, "6",    "T"
</span><span class='line'>"MarteXcoin",          0x32, 0xb2, "6",    "T"
</span><span class='line'>"MasterDoge",          0x33, 0x8b, "5",    "M"
</span><span class='line'>"Mazacoin",            0x32, 0xe0, "8",    "a"
</span><span class='line'>"Megacoin",            0x32, 0xb2, "6",    "T"
</span><span class='line'>"MintCoin",            0x33, 0xb3, "[67]", "T"
</span><span class='line'>"MobiusCoin",          0x00, 0x80, "5",    "[LK]"
</span><span class='line'>"MonetaryUnit",        0x10, 0x7e, "5",    "K"
</span><span class='line'>"Monocle",             0x32, 0xb2, "6",    "T"
</span><span class='line'>"MoonCoin",            0x03, 0x83, "5",    "L"
</span><span class='line'>"Myriadcoin",          0x32, 0xb2, "6",    "T"
</span><span class='line'>"NameCoin",            0x34, 0x80, "5",    "[LK]"
</span><span class='line'>"Navcoin",             0x35, 0x96, "6",    "P"
</span><span class='line'>"NeedleCoin",          0x35, 0xb5, "7",    "T"
</span><span class='line'>"NEETCOIN",            0x35, 0xb5, "7",    "T"
</span><span class='line'>"NYC",                 0x3c, 0xbc, "7",    "U"
</span><span class='line'>"Neoscoin",            0x35, 0xb1, "6",    "T"
</span><span class='line'>"Nevacoin",            0x35, 0xb1, "6",    "T"
</span><span class='line'>"Novacoin",            0x08, 0x88, "5",    "M"
</span><span class='line'>"Nubits",              0x19, 0xbf, "7",    "V"
</span><span class='line'>"Nyancoin",            0x2d, 0xad, "6",    "S"
</span><span class='line'>"Ocupy",               0x73, 0xf3, "9",    "[cd]"
</span><span class='line'>"Omnicoin",            0x73, 0xf3, "9",    "[cd]"
</span><span class='line'>"Onyxcoin",            0x73, 0xf3, "9",    "[cd]"
</span><span class='line'>"PacCoin",             0x18, 0x98, "6",    "P"
</span><span class='line'>"Particl",             0x38, 0x6c, "4",    "[HG]"
</span><span class='line'>"Paycoin",             0x37, 0xb7, "7",    "U"
</span><span class='line'>"Pandacoin",           0x37, 0xb7, "7",    "U"
</span><span class='line'>"ParkByte",            0x37, 0xb7, "7",    "U"
</span><span class='line'>"Peercoin",            0x37, 0xb7, "7",    "U"
</span><span class='line'>"Pesetacoin",          0x2f, 0xaf, "6",    "[ST]"
</span><span class='line'>"PHCoin",              0x37, 0xb7, "7",    "U"
</span><span class='line'>"PhoenixCoin",         0x38, 0xb8, "7",    "U"
</span><span class='line'>"PiggyCoin",           0x76, 0xf6, "9",    "d"
</span><span class='line'>"Pinkcoin",            0x3,  0x83, "[RQP]","L"
</span><span class='line'>"PIVX",                0x1e, 0xd4, "8",    "Y"
</span><span class='line'>"Peercoin",            0x37, 0xb7, "7",    "U"
</span><span class='line'>"Potcoin",             0x37, 0xb7, "7",    "U"
</span><span class='line'>"Primecoin",           0x17, 0x97, "6",    "P"
</span><span class='line'>"ProsperCoinClassic",  0x3a, 0xba, "7",    "Q"
</span><span class='line'>"Quark",               0x3a, 0xba, "7",    "U"
</span><span class='line'>"Qubitcoin",           0x26, 0xe0, "8",    "a"
</span><span class='line'>"Reddcoin",            0x3d, 0xbd, "7",    "[UV]"
</span><span class='line'>"Riecoin",             0x3c, 0x80, "5",    "[LK]"
</span><span class='line'>"Rimbit",              0x3c, 0xbc, "7",    "U"
</span><span class='line'>"ROIcoin",             0x3c, 0x80, "5",    "[LK]"
</span><span class='line'>"Rubycoin",            0x3c, 0xbc, "7",    "U"
</span><span class='line'>"Rupaya",              0x3c, 0xbc, "7",    "U"
</span><span class='line'>"Sambacoin",           0x3e, 0xbe, "7",    "V"
</span><span class='line'>"SecKCoin",            0x3f, 0xbf, "7",    "V"
</span><span class='line'>"SibCoin",             0x3f, 0x80, "5",    "[LK]"
</span><span class='line'>"SixEleven",           0x34, 0x80, "5",    "[LK]"
</span><span class='line'>"SmileyCoin",          0x19, 0x99, "6",    "P"
</span><span class='line'>"SongCoin",            0x3f, 0xbf, "7",    "V"
</span><span class='line'>"SpreadCoin",          0x3f, 0xbf, "7",    "V"
</span><span class='line'>"StealthCoin",         0x3e, 0xbe, "7",    "V"
</span><span class='line'>"Stratis",             0x3f, 0xbf, "7",    "V"
</span><span class='line'>"SwagBucks",           0x3f, 0x99, "6",    "P"
</span><span class='line'>"Syscoin",             0x00, 0x80, "5",    "[LK]"
</span><span class='line'>"Tajcoin",             0x41, 0x6f, "6",    "H"
</span><span class='line'>"Terracoin",           0x00, 0x80, "5",    "[LK]"
</span><span class='line'>"Titcoin",             0x00, 0x80, "5",    "[LK]"
</span><span class='line'>"TittieCoin",          0x41, 0xc1, "7",    "V"
</span><span class='line'>"Topcoin",             0x42, 0xc2, "7",    "V"
</span><span class='line'>"TransferCoin",        0x42, 0x99, "6",    "P"
</span><span class='line'>"TreasureHuntCoin",    0x32, 0xb2, "6",    "T"
</span><span class='line'>"TrezarCoin",          0x42, 0xC2, "7",    "V"
</span><span class='line'>"Unobtanium",          0x82, 0xe0, "8",    "a"
</span><span class='line'>"USDe",                0x26, 0xa6, "6",    "R"
</span><span class='line'>"Vcash",               0x47, 0xc7, "7",    "W"
</span><span class='line'>"Versioncoin",         0x46, 0xc6, "7",    "W"
</span><span class='line'>"VergeCoin",           0x1e, 0x9e, "6",    "Q"
</span><span class='line'>"Vertcoin",            0x47, 0x80, "5",    "[LK]"
</span><span class='line'>"Viacoin",             0x47, 0xc7, "7",    "W"
</span><span class='line'>"VikingCoin",          0x46, 0x56, "3",    "D"
</span><span class='line'>"W2Coin",              0x49, 0xc9, "7",    "W"
</span><span class='line'>"WACoins",             0x49, 0xc9, "7",    "W"
</span><span class='line'>"WankCoin",            0x00, 0x80, "5",    "[LK]"
</span><span class='line'>"WeAreSatoshiCoin",    0x87, 0x97, "6",    "P"
</span><span class='line'>"WorldCoin",           0x49, 0xc9, "7",    "W"
</span><span class='line'>"XP",                  0x4b, 0xcb, "7",    "X"
</span><span class='line'>"Yenten",              0x4e, 0x7b, "5",    "K"
</span><span class='line'>"Zcash",        [0x1c,0xb8], 0x80, "5",    "[LK]"
</span><span class='line'>"Zetacoin",            0x50, 0xE0, "8",    "a"
</span><span class='line'>"Testnet Bitcoin",     0x6f, 0xef, "9",    "c"
</span><span class='line'>"Testnet Dogecoin",    0x71, 0xf1, "9",    "c"
</span><span class='line'>"Testnet MonetaryUnit",0x26, 0x40, "3",    "A"
</span><span class='line'>"Testnet PIVX",        0x8b, 0xef, "9",    "c"
</span><span class='line'>"Testnet WACoins",     0x51, 0xd1, "8",    "[XY]"
</span></code></pre></td></tr></table></div></figure>


<p>哈哈，洋洋大观啊。这也说明了folk一个山寨币的成本是如何的低；然后有了以太坊的ERC20之后，发一个新币的成本简直低到令人发指，也无怪乎场子里面骗子横行了。</p>

<h2>以太坊的地址生成</h2>

<p>Ethereum项目是不走寻常路的，他作为比特币之后最具创新性的后辈，地址设计反而简单的多。</p>

<p>直到生成公钥这一步，以太坊和比特币都是一致的，采用了secp256k1算法，只是最后的地址生成以太坊很简洁，直接Keccak256 hash，然后取最后的40位16进制字符得到的。</p>

<p>为什么比特币实现复杂呢？这是因为比特币的交易是以UTXO为核心的，每个UTXO包含其所有者及价值信息，系统中的每一笔的交易由若干UTXO输入和若干UTXO输出组成。UTXO无法只提取部分，每次必须完整的使用，这有点像我们生活现实中的现金。比特币系统中，一个用户的“余额”是该用户的私钥能够有效签名的所有UTXO的总和。要深刻的理解这一点，还需要我们了解了比特币的交易数据构成之后才能探讨。我们后面会写文章解释这一点啦。</p>

<p>而以太坊采用了与比特币不同的实现方式——账户，类似我们生活中的银行卡。以账户为核心的设计比较节省空间,而且以太坊的block组织更为精巧。另外，以太坊的设计目标和比特币是不同的：</p>

<ul>
<li>首先以太坊的账户除了普通的收发币的账户(俗称外部账户EOA)，还有合约账户，合约账户需要一个固定的地址，不然每次调用合约都会很麻烦；这样就要求以太坊的合约账户不像比特币交易那样频繁的更换地址；</li>
<li>他并不执着于强迫用户去注意隐私问题，以太坊的态度是，如果用户注重隐私问题，你就自己搞定；你需要通过合约中的签名数据包协议来建立一个加密“混合器”进行加密。</li>
<li>总之以太坊因为要实现的目标更为宏大，他的设计理念是根据最初的用户都是一群Geek们来建立的；Geek们最喜欢啥？就是不要过度设计，让我来自己搞定</li>
</ul>


<p>所以在以太坊系统中，账户是一个20字节的地址，他关联的信息包含四个部分：</p>

<ol>
<li><p>随机数，用于确定每笔交易只能被处理一次的计数器</p></li>
<li><p>账户目前的以太币余额</p></li>
<li><p>账户的合约代码，如果有的话</p></li>
<li><p>账户的存储（默认为空）</p></li>
</ol>


<p>可以采用<a href="https://github.com/ethereum/pyethereum">pyethereum</a>这个库，用以下代码模拟以太坊地址的生成:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># -*- coding: utf-8 -*-
</span><span class='line'>
</span><span class='line'>"""doctopt ethereum address generate tools
</span><span class='line'>
</span><span class='line'>Usage:
</span><span class='line'>  genaddr.py p2addr         &lt;private&gt;
</span><span class='line'>  genaddr.py word2addr      &lt;word&gt;
</span><span class='line'>
</span><span class='line'>Options:
</span><span class='line'>  -h --help                                             Show this screen.
</span><span class='line'>  --version                                             Show version.
</span><span class='line'>
</span><span class='line'>Example:
</span><span class='line'>
</span><span class='line'>    genaddr.py p2addr 6bd3b27c591                                         # gen address from private 0x6bd3b27c591=&gt;1PiFuqGpG8yGM5v6rNHWS3TjsG6awgEGA1
</span><span class='line'>    genaddr.py word2addr 'Money is the root of all evil.'                 # gen address from private wordlist
</span><span class='line'>
</span><span class='line'>"""
</span><span class='line'>
</span><span class='line'>from docopt import docopt
</span><span class='line'>
</span><span class='line'>import os
</span><span class='line'>import sys
</span><span class='line'>from ethereum import utils
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>if __name__ == '__main__':
</span><span class='line'>    arguments = docopt(__doc__, version='1.0')
</span><span class='line'>
</span><span class='line'>    if arguments['p2addr']:
</span><span class='line'>        private_key = bytes.fromhex(arguments['&lt;private&gt;'])
</span><span class='line'>        passpharse = b'unknown'
</span><span class='line'>
</span><span class='line'>    elif arguments['word2addr']:
</span><span class='line'>        passpharse = arguments['&lt;word&gt;'].encode('utf-8')
</span><span class='line'>        private_key = utils.sha3(passpharse)
</span><span class='line'>
</span><span class='line'>    raw_address = utils.privtoaddr(private_key)
</span><span class='line'>    account_address = utils.checksum_encode(raw_address)
</span><span class='line'>    print("word:{}:private:{}:address:{}".format(passpharse.decode('utf-8'), private_key.hex(), account_address))
</span><span class='line'>    </span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&gt; python genaddr.py word2addr 'hello'
</span><span class='line'>
</span><span class='line'>word:hello:private:1c8aff950685c2ed4bc3174f3472287b56d9517b9c948127319a09a7a36deac8:address:0x5ccfa55C29F0522f062E3C15004E35a69dD45F6B</span></code></pre></td></tr></table></div></figure>


<p>以太坊账户方式的一个弱点是：为了阻止重放攻击，每笔交易必须有nonce。这就使得账户需要跟踪nonce的使用情况。而且，不再使用的账户，无法从账户状态中移除。</p>

<p>关于重放攻击，我们会在后面说明。</p>

<h2>重放攻击</h2>

<p>在网络中重放攻击是一种很常见的hack方式，关于相关攻防有足够丰富的案例；但是在区块链历史上却是一个悲伤的故事；在此我们用一点点篇幅回忆一下区块链上第一次大规模的重放攻击(replay Attack)。</p>

<h4>缘起</h4>

<p>众所周知，以太坊作为<code>智能合约</code>的首创者，在区块链技术史上是继比特币之后最大的创新。在V神于2015-07-30正式推出运行后，立即吸引了众多Geek来探究如何实现白皮书中所说的去中心化程序。其中最受关注的就是2016-04-30日开始募资的<a href="https://etherscan.io/address/0xbb9bc244d798123fde783fcc1c72d3bb8c189413">The DAO</a>项目。</p>

<p>关于这个项目的始末，实在是槽点满满。即使已经两年后的今天，估计你去搜索这起著名的事件，非码农人士也很难搞明白。简而言之，就是<code>The DAO</code>作为一个去中心化的项目基金会开始募资，令人觉得神奇的是，这个项目背后没有一个控制人！即使这个项目筹到一大笔钱，也没有一个人有权利单独动用它，只能所有投资人投票才能决定资金的使用，这是写在区块链代码上的铁律，这就是去中心化的魅力！</p>

<p>但是一个没有控制人，没有开发目标，拿到了钱也不知道今后要干啥的项目组织，说要募资了，然后人们纷纷掏钱买股权，是不是很神奇！</p>

<p>咱们说传销还得有个愿景呢！但是当时<code>去中心化程序</code>的概念横空出世，官网页面美轮美奂，诸多<code>专家</code>纷纷发表晦涩难懂的高大上文章齐赞<code>The DAO</code>的历史意义，就在那种巨大的泡沫环境中，人们害怕的是错过发财的上车机会，于是根本搞不明白这是个什么东西，就慷慨解囊。</p>

<p>你可能觉得好笑，可是看看今天，那些所谓的高大上的区块链项目，所谓的伟大愿景，那些山寨币，那些要颠覆这颠覆那的各路神仙，和当时何其相似！熙熙攘攘的投资人群中，有几人能花时间去搞明白比特币和以太坊的白皮书？</p>

<p>所谓的区块链技术的发展，充斥着贪婪和诈骗。就和人性一样。</p>

<h4>崩溃</h4>

<p>同样，人类的愚蠢也是不变的，贪婪之下，BUG是无法避免的。</p>

<p>截至2016-05-15，<code>The DAO</code>项目的合约募集了大约当时价值约1.5亿美元Ether，占当时Ether发行总量的15%。讽刺的是，这个项目募集了巨大的金额，却没有一个像样的专家去做一个合约代码安全审计！</p>

<p>终于，THE DAO创始人之一Stephan Tual发现其合约代码有部分缺陷，他于6月12日宣布，他们发现了软件中存在的“递归调用漏洞”问题，不过对DAO资金来说则不会出现风险。讽刺的是还是没有多少人注意到这个问题。</p>

<p>2016-06-17，一名黑客在编码上发现了真正的漏洞，使得他可以从<code>The Dao</code>上抽走资金。在攻击的头几个小时，360万的Ether被转出，在当时价值相当于七千万美元。当时引起的混乱可想而知，社区采用紧急措施冻结了所有的币，但是只要以太坊的根基代码不变，就无法阻止黑客取现这些财富。</p>

<p>你可以想象当时那些投资人的反应，有人气急败坏要求以太坊开发团队立即采取措施，作废黑客的攻击行为，回退区块链并退回所有投资人的Ether。</p>

<p>而真正的区块链信徒认为<code>代码即正义、代码即法律</code>，传统世界中的法律不能应用到cyberpunk世界中，即使是黑客的盗窃行为，也理应收到这种正义保护！回退作废Block的行为其实就是否认区块链的技术意义，它会毁灭以太坊项目。</p>

<p>你可以想象，当你损失了几十万美元，对面的一群码农却做出这种<code>奇谈怪论</code>，肯定是想砍人的心都有了。当时的各路利益纠葛者吵了一个翻天覆地。甚至黑客本人也跳出来发表了一通公开信，先为自己的盗窃行为辩护一番，然后承诺只要社区不回退，就会返还一部分金额。整个事件好一场精彩大戏。</p>

<h4>分裂</h4>

<p>经历了无休止的利益、法律、技术等等辩论后，以太坊社区分裂了。争论的结果就是诞生了ETH Classic (即ETC)项目；一批坚持<code>代码即正义</code>者分裂出来创造了ETH Classic 网络，这个项目称自己才是真正的以太坊，并承认黑客的攻击行为且继续将这条链运行下去。而现在仍旧运行的Ethereum网络保护了投资者的利益，做出了妥协；</p>

<p>这个分叉开启于Ethereum网络Block编号为<a href="https://gastracker.io/block/0x94365e3a8c0b35089c1d1195081fe7489b528a84b22199c916180db8b28ade7f">1920000</a>区块。</p>

<p>这是世界上第一次公开的人为的区块链分叉事件。但是好戏才刚刚开始。</p>

<h4>重放攻击</h4>

<p>以太坊硬分叉出现了ETH和ETC两条链，两条链上的交易数据结构是完全一样的，因此一笔交易在ETH上是有效的， 那它在ETC上同样会被接受，反之亦然。 因为当时所有人都认为ETC将不会再存在，所以分叉前没人意识到两条链会产生相互重放问题。 后来还有许多矿工继续在维持ETC链时， 大家发现在ETH链上的交易拿到ETC链继续重放（广播）仍然是有效的。</p>

<p>因为没经验，以太坊分叉时几乎所有交易所也都没意识到这个问题，更没有提前做ETH和ETC分离， 这时候只要有人从交易所提取ETH币，就有可能得到同等数量的ETC币。许多人利用这个漏洞，不断在交易所充币和提币（ETH）， 从而获取额外的ETC。 当时云币、BTC-E等交易所发布说自己被重放攻击了，被骗取了几乎所有ETC。“重放攻击”也就此闻名于币圈。</p>

<p>解决这个问题也很简单，或者就是两边的原始交易数据要有所区别:</p>

<ul>
<li>或者地址前缀做一下改动</li>
<li>或者交易数据签名增加一个标志</li>
</ul>


<p>因为以太坊地址没有像比特币一样的前缀，ETC和ETH社区经过讨论，简单的提出了<a href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-155.md">EIP-155</a> 作为解决方案。简而言之，就是判断分叉的区块编号，引入一个CHAIN ID新值来解决这个问题。</p>

<p>耐人寻味的是，Ethereum团队此时对于ETC分叉的态度是支持的。就像中本聪早期提到的那样，没有一个人可以集权控制一条链，算力说话。因此ETC活了下来。也因为以太坊的创始人Vitalik Buterin是个非常年轻的天才，整个开发团队洋溢着一种骑士精神;他们对于自由竞争出生的ETC非常包容，不管将来结果如何，我认为这种态度是非常了不起的。</p>

<p>当然，个人感情的说一下。此事说明了投资所谓的区块链项目，究竟有多大的风险！以太坊基础代码有许多人审核，有一定的安全保证，但是形形色色的智能合约就不好说了。后来像DAO一样的hack事件数不胜数！</p>

<p>我得说，当你想要投资一个所谓<code>未来项目</code>时，除了你自己的知识和判断，没有任何一个人是可信的！我是说，只能靠自己，其他任何人，甚至创始者的意见也不可信。</p>

<h2>Bitcoin Cash地址生成</h2>

<p>关于Bitcoin Cash的诞生，其过程之离奇曲折，胜过ETH分叉百倍。这是一个比最精彩的侦探小说还要反转反转再反转的故事。</p>

<p>不过我们就不要讲故事了，总之Bitcoin Cash分叉诞生后，为了和传统的Bitcoin地址相区别，自己又做了一下改动。</p>

<p>快速看看BCH新老地址的对比：</p>

<ol>
<li><p>新地址是和老地址一一对应的，它们对应了同一个私钥，只是换了种写法</p></li>
<li><p>新地址可以发送余额给老地址，老地址可以发送余额到新地址</p></li>
<li><p>新地址是大小写不敏感的，可以全部转成大写，也可以全部转成小写，优先小写格式，同一地址不能大小写混用</p></li>
<li><p>新地址的前缀可写可不写，老地址没有前缀，通过首字符来标识类型</p></li>
<li><p>新地址用base32编码，老地址用base58编码</p></li>
</ol>


<p>官方文档描述参见<a href="https://github.com/bitcoincashorg/bitcoincash.org/blob/master/spec/cashaddr.md">这里</a>，让我们从seed <code>satoshi</code> 生成一个bitcoin cash 地址演示一遍。</p>

<h4>规范</h4>

<p>新的bitcoin cash地址是由：</p>

<ul>
<li>能够表示该地址有效的网络的前缀，一般为主网(bitcoincash)、测试网(bchtest)、回归测试网(bchreg)三种。</li>
<li>一个分隔符：<code>:</code></li>
<li>一个base32编码的payload，表示这个地址的目的地和包含的checksum（校验和）。</li>
</ul>


<h4>Payload</h4>

<p>payload是base32编码的数据流，由三个元素组成:</p>

<ul>
<li>指示地址字节的版本类型</li>
</ul>


<p>共8bits, 1bit(0) + 4bits (地址类型：Type bits) + 3bits (hash长度：Size bits)</p>

<table>
<thead>
<tr>
<th>Type bits (二进制) </th>
<th> 地址类型 </th>
</tr>
</thead>
<tbody>
<tr>
<td>0000 </td>
<td> P2PKH</td>
</tr>
<tr>
<td>1000 </td>
<td> P2SH</td>
</tr>
<tr>
<td>0000 </td>
<td> P2PKH-TESTNET</td>
</tr>
<tr>
<td>1000 </td>
<td> P2SH-TESTNET</td>
</tr>
</tbody>
</table>


<table>
<thead>
<tr>
<th>Size bits (二进制) </th>
<th> 代表hash长度</th>
</tr>
</thead>
<tbody>
<tr>
<td>000 </td>
<td> 160</td>
</tr>
<tr>
<td>001 </td>
<td> 192</td>
</tr>
<tr>
<td>010 </td>
<td> 224</td>
</tr>
<tr>
<td>011 </td>
<td> 256</td>
</tr>
<tr>
<td>100 </td>
<td> 320</td>
</tr>
<tr>
<td>101 </td>
<td> 384</td>
</tr>
<tr>
<td>110 </td>
<td> 448</td>
</tr>
<tr>
<td>111 </td>
<td> 512</td>
</tr>
</tbody>
</table>


<ul>
<li>一个hash值</li>
</ul>


<p>hash含义取决于版本字段。它是表示数据的hash，即P2KH的pubkey hash和P2SH的reedemScript哈希。这个可以直接从BTC地址里面推出，这个hash值导出后需要用40Bits的BCH码来表示，这样做之后，地址大小写不敏感。</p>

<ul>
<li>一个40字节的校验和</li>
</ul>


<p>这个校验和的计算比较繁琐，它是在GF（2 ^ 5）上定义的40bits的BCH码，校验和根据以下代码计算：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>uint64_t PolyMod(const data &v) {
</span><span class='line'>    uint64_t c = 1;
</span><span class='line'>    for (uint8_t d : v) {
</span><span class='line'>        uint8_t c0 = c &gt;&gt; 35;
</span><span class='line'>        c = ((c & 0x07ffffffff) &lt;&lt; 5) ^ d;
</span><span class='line'>        
</span><span class='line'>        if (c0 & 0x01) c ^= 0x98f2bc8e61;
</span><span class='line'>        if (c0 & 0x02) c ^= 0x79b76d99e2;
</span><span class='line'>        if (c0 & 0x04) c ^= 0xf33e5fb3c4;
</span><span class='line'>        if (c0 & 0x08) c ^= 0xae2eabe2a8;
</span><span class='line'>        if (c0 & 0x10) c ^= 0x1e4f43e470;
</span><span class='line'>    }
</span><span class='line'>    
</span><span class='line'>    return c ^ 1;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>具体的规则可以详细参考<a href="https://github.com/bitcoincashorg/bitcoincash.org/blob/master/spec/cashaddr.md">这里</a>。</p>

<h4>地址转换生成</h4>

<ol>
<li>取<code>satoshi</code> 生成的非压缩地址<code>1ADJqstUMBB5zFquWg19UqZ7Zc6ePCpzLE</code></li>
<li>这个地址是一个主网地址，前缀为<code>bitcoincash:xxxxx</code></li>
<li>这个地址类型为<code>P2PKH</code>，version_bits为0000</li>
<li><code>1ADJqstUMBB5zFquWg19UqZ7Zc6ePCpzLE</code>进行base58 Decode，去掉末尾的4字节checksum，得到的hash值用list表示<code>[101, 13, 4, 151, 224, 20, 230, 13, 70, 128, 252, 230, 153, 125, 64, 93, 226, 100, 240, 66]</code></li>
<li>加入version前缀，<code>payload = [0, 101, 13, 4, 151, 224, 20, 230, 13, 70, 128, 252, 230, 153, 125, 64, 93, 226, 100, 240, 66]</code></li>
<li>将hash进行8bits->5bits BCH码的转换，<code>payload = [0, 1, 18, 16, 26, 1, 4, 23, 28, 0, 10, 14, 12, 3, 10, 6, 16, 3, 30, 14, 13, 6, 11, 29, 8, 1, 14, 30, 4, 25, 7, 16, 8, 8]</code></li>
<li>计算校验和:<code>checksum=[24, 25, 19, 1, 12, 3, 18, 8]</code></li>
<li>对payload + checksum进行base32编码，得到<code>qpjs6pyhuq2wvr2xsr7wdxtagpw7ye8sggcenpvrjg</code></li>
<li>加入前缀<code>bitcoincash:</code>，组合得到最后地址<code>bitcoincash:qpjs6pyhuq2wvr2xsr7wdxtagpw7ye8sggcenpvrjg</code></li>
</ol>


<p>有许多在线转换工具可以验证，比如:</p>

<p><a href="https://bch.btc.com/tools/address-converter">https://bch.btc.com/tools/address-converter</a></p>

<h2>总结</h2>

<p>以上长篇大论了比特币系统的地址是如何生成的，当然我们也略过了许多细节，比如钱包如何加salt，如何加passphrase等等，这些直接去读BIP 规范更为精确；但是一个完整的钱包，可不仅仅是要解决地址生成这个问题，还要能方便的管理私钥。</p>

<p>在比特币早期，私钥的管理是非常粗暴的，就是每次创建新钱包时，系统自动随机生成100个私钥，然后随着用户交易增多用光之后，再生成100个私钥；钱包文件就是一个二进制文件，即使加了密码保护，也很容易暴力破解泄密；</p>

<p>这导致了无穷多的hack事件；不管你信不信，初期很多从事比特币交易的网站，其wallet.dat文件就明晃晃的放在服务器上，管理员粗心大意，完全可以形容为 <code>没头脑+不高兴</code>，很多人连个最基本的密码保护也不设置；另外也发生过很多悲剧的<code>rm -rf</code>事件，我认为由于这样的失误导致的比特币丢失至少在100w+ 币的级别；换算今天的汇率，你能相信有个银行将数亿美元现金的保险柜不加锁，明晃晃的摆在大堂上摆阔吗？</p>

<p>在一连串的悲剧事件中(具体是哪些悲剧可以写一本书哦)，作为登峰造极者，mtgox当之无愧！ 80多万个比特币的丢失，史上独一份。这个交易所的老板也是心大，80w+币的钱包密码也不设置一个，就在那里任由黑客予取予求；还不是一天两天哦，是持续好几周的hack事件！</p>

<p>mtgox是比特币历史上巨大的迷雾，他不光牵扯到许多比特币的早期玩家，还有BTC-E, FBI牵涉其中，我认为这是仅次于<code>中本聪到底何方神圣</code>的谜题。所幸法胖还活着，我希望有生之年能读到这个事件的完整披露。</p>

<p>好了，假如你是一个交易所的老板，你会很快发现自己面临着以下问题：</p>

<ul>
<li>不需要给每个用户的账户都建立一个钱包文件，我希望能有一个总的账户管理方案</li>
<li>可能交易所有1000个大户，你希望他们的钱包是冷存储的，提币的时候他们可以耐心等一段时间，但是剩下的100000个普通用户的账户就要存放到一个热钱包上，只留有部分资产来应付流动性</li>
<li>有很多部门需要批准获取一些资金，比如研发要用来做测试，市场部门要用来搞活动等等</li>
<li>最后，私钥最好只能由少数人，最好只有我本人来掌握，不然私钥的传播过程中，随便一个人就能让你万劫不复</li>
<li>我如果有一些合伙人的话，肯定也希望能掌管一部分资金</li>
<li>如果有突发情况，我能迅速把公司账上所有的币都转移到另外一个安全的账户上，这有可能是要迅速完成上万笔的交易转移</li>
<li>最后，我希望所有的交易，签署和广播是在不同的机器上进行的，存有私钥的机器不能联网，这台机器签名完毕后，调用远端的服务端广播交易，这样完全实现钱包的冷隔离</li>
</ul>


<p>好啦，假如我们现在只有前面那种一个wallet.dat钱包的管理方案，要怎么做呢？</p>

<p>很明显的，这种管理太粗糙了。社区们经过不断的探索，提出了BIP-32，BIP-39，BIP-44等规范，以绝妙的办法解决了这些问题。这就是比特币HD钱包的由来。同时这些规范不仅仅适用于比特币系统，还适用于所有的电子货币方案，也许今后，你可以同时在一个钱包里管理你的ETH, BTC, 支付宝余额等等~~~</p>

<p>那到底要怎么做呢？</p>

<p>我们已经探索了这么远，估计你也不耐烦了，但是我们还要说，这还早的很呢！那么下次文章再见。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Bitcoin-cli Cheat]]></title>
    <link href="https://happy123.me/blog/2018/10/26/bitcoin-cli-cheat/"/>
    <updated>2018-10-26T16:28:23+08:00</updated>
    <id>https://happy123.me/blog/2018/10/26/bitcoin-cli-cheat</id>
    <content type="html"><![CDATA[<p>今天踩了一个巨坑。</p>

<p>我一直以为<code>bitcoin-cli sendfrom</code>命令是可以花费uncomfirmed UTXO的。</p>

<!-- more -->


<p>然后今天发现bitcoin-core 0.17版本已经开始废弃这个命令和<code>bitcoin account</code>的支持了。于是去修改万年之前的一个脚本。</p>

<p>然后我切换到TESTNET里面发了几笔交易，惊奇的发现sendfrom并不能花费uncomfirmed UTXO。执行:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&gt; bitcoin-cli sendfrom "" "1M72Sfpbz1BPpXFHz9m3CdqATR44Jvaydd" 0.01 0</span></code></pre></td></tr></table></div></figure>


<p>明明我已经发给测试账户0.1BTC过去了，getwalletinfo可以看到这个币了，我也把minconf设为0了，却在执行sendfrom的时候总是提示我<code>Account has insufficient funds</code>；</p>

<p>我一路代码追下去，在这里:</p>

<p><a href="https://github.com/bitcoin/bitcoin/blob/e44150feed53317677b1e2073f3cb0cfc67b691c/src/wallet/rpcwallet.cpp#L915">https://github.com/bitcoin/bitcoin/blob/e44150feed53317677b1e2073f3cb0cfc67b691c/src/wallet/rpcwallet.cpp#L915</a></p>

<p>惊奇的发现只有自己的找零才会在uncomfirmed的情况下被计入credit fund，震惊了。我这个脚本运行了半年了，才发现这个坑。</p>

<p>没办法，自己又封装了一遍<code>createrawtransaction</code>，<code>signrawtransaction</code>, <code>sendrawtransaction</code>，来代替sendfrom的功能。</p>

<p>找这个问题我在TESTNET里面发了不下一百笔交易，wallet部分的代码已经翻遍了，我深深为之感叹bitcoin core实现wallet这部分的精巧，好多地方的细节已经不是人类能理解的了；太可怕了。</p>

<p>另外记一下远程调用bitcoind rpc接口的套路:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&gt;bitcoin_cli --rpcconnect=192.168.2.7 --rpcpassword="xxxxx" --rpcuser=test getwalletinfo</span></code></pre></td></tr></table></div></figure>


<p>相应的，bitcoin.conf也要允许远端调用rpc接口的权限:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rpcuser=test
</span><span class='line'>rpcpassword=xxxxx
</span><span class='line'>rpcallowip=192.168.2.0/255.255.255.0
</span><span class='line'>rpcport=8332
</span><span class='line'>rpcthreads=10
</span><span class='line'>server=1
</span></code></pre></td></tr></table></div></figure>


<p>ps: bitcoin.conf 可以直接放到blockchain的数据目录，反正我看0.15的代码，已经把这个路径默认加到path搜索里面了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[比特币的HD钱包演化-1]]></title>
    <link href="https://happy123.me/blog/2018/10/23/bi-te-bi-de-hdqian-bao-yan-hua-1/"/>
    <updated>2018-10-23T18:49:26+08:00</updated>
    <id>https://happy123.me/blog/2018/10/23/bi-te-bi-de-hdqian-bao-yan-hua-1</id>
    <content type="html"><![CDATA[<h2>密钥分发的问题</h2>

<p>在之前我们的一篇文章<a href="https://happy123.me/blog/2016/12/25/jia-mi-ji-zhu-fa-zhan/">加密技术发展</a> 中提到了一个经典的问题:</p>

<!-- more -->


<ul>
<li><p>Alice和Bob是朋友，他们的住处离得比较远，Alice想要发送一则隐私消息给Bob</p></li>
<li><p>Eve想要窃听Alice和Bob的通信，Alice和Bob无法防止Eve的偷看</p></li>
<li><p>Alice把信放在一个盒子里，她上了锁，让邮差发给Bob，Eve没有钥匙，无法打开盒子，但是Bob也无法打开</p></li>
</ul>


<p>那么问题来了，Alice如何把钥匙发给Bob呢？</p>

<p>Alice如何发送钥匙给Bob的问题，就是现代密码学中<code>密钥分发</code>的问题;现代密码学的大部分研究，就是围绕这个问题展开的。</p>

<p>我们在思想实验中虚拟了两个解决方案:</p>

<h4>方案A</h4>

<ul>
<li><p>Alice把信息放到铁盒子里，上锁，发给Bob</p></li>
<li><p>Bob收到盒子，没有去想办法打开它，而是又加上了自己的一把锁，发回给Alice</p></li>
<li><p>Alice打开自己加的锁，发回给Bob</p></li>
<li><p>Bob打开自己的锁</p></li>
</ul>


<h4>方案B</h4>

<ul>
<li><p>Bob满世界散播自己的锁，随便一个人都能捡到Bob的锁并且能分辨是否被别人伪造</p></li>
<li><p>Alice捡了一把Bob的锁，把消息放进铁盒子里，锁上，发给Bob</p></li>
<li><p>Bob打开自己的锁</p></li>
</ul>


<p>这两个虚拟的解决方案意义非同寻常，它证明了两个人可以互相交换秘密的信息而不怕密钥泄露；但是在真实世界中，对一则文本信息加密，并不完全像给一个铁盒子上锁那样方便，我们如何把这两个故事的寓意融入到真正的密码术当中去呢？</p>

<h2>单向/双向函数</h2>

<p>在密码学中，很常用的一个数学特性叫做<code>单向函数</code>。</p>

<p>同样与之相对的，还有一个概念叫做<code>双向函数</code>。</p>

<p>让我们来看看他们是什么东东。</p>

<h4>双向函数</h4>

<p>大部分函数都是双向函数，<code>双向</code>意味着可逆。比如加倍函数就是一个双向函数:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>y = 2x</span></code></pre></td></tr></table></div></figure>


<p>知道了x，很容易能求得y；同理，知道了y，很容易逆向求得x。</p>

<h4>单向函数</h4>

<p>与上面相对的，知道x，很容易能求得y；但是知道了y，逆向很难推出x。这就是单向函数。举一个最常见的例子:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>y = 453^x % 21997</span></code></pre></td></tr></table></div></figure>


<p>一个很大的数的x次方来模除另一个很大的数，取模得到y，知道x，y是很容易计算的，但是反向从y推导x却十分困难。这就是一个单向函数。</p>

<p>码农童鞋们非常熟悉的一种算法:HASH(散列)，其原理就是建立在单向函数之上的；但是现在我们先把这个应用放到一边，单单探讨单向函数在密钥交换中的作用</p>

<h4>单向函数在密码学中的应用</h4>

<p>Alice和Bob在不懈的努力之后，发现采用上述 M<sup>x</sup> % P = y 的单向函数可以帮助他们交换密钥，而且
不怕遭到Eve的窃听，让我们看看他们怎么做到的：</p>

<table>
<thead>
<tr>
<th>选择 7<sup>x</sup> % 11 = y 这个单向函数作为约定函数 </th>
<th>Alice </th>
<th> Bob</th>
</tr>
</thead>
<tbody>
<tr>
<td>第一步 </td>
<td> Alice随机选择了一个数字代入x，比如3 </td>
<td> Bob 随机选择了一个数字代入x，比如6</td>
</tr>
<tr>
<td>第二步 </td>
<td> Alice运算得到 7<sup>3</sup> % 11 = 2  </td>
<td> Bob 运算得到 7<sup>6</sup> % 11 = 4</td>
</tr>
<tr>
<td>第三步 </td>
<td> Alice把2发给Bob  </td>
<td> Bob 把4发给Alice</td>
</tr>
<tr>
<td>第四步 </td>
<td> Alice得到Bob发送的结果4，代入单向函数再一次运算得到 4<sup>3</sup> % 11 = 9  </td>
<td> Bob 得到Alice的2后进行同样的运算 2<sup>6</sup> % 11 = 9</td>
</tr>
</tbody>
</table>


<p>神奇的事情发生了，第四步中Alice和Bob得出了相同的数字9，这个数字就是他们需要传递的密钥。</p>

<p>让我们再重新审视一遍，Alice和Bob在这次交换密钥的过程中都传递了什么呢？</p>

<ol>
<li>他们约定了单向函数的 M, P值</li>
<li>他们各自选定了一个x值，然后计算结果y值并互相传递</li>
<li>通过前面两组信息，他们各自独立计算出了密钥值</li>
<li>Eve如果监听到了M,P,以及两个人传递的y，是很难逆向计算出x，并得出密钥值的；这是单向函数的数学特性决定的</li>
</ol>


<p>通过仔细的选定一个稳妥的单向函数，就可以通过公开的讨论来建立一个密钥。这是密码学史上一个伟大发现。它是如此的简单和违反直觉，简直让人觉得不可思议。</p>

<p>如果仔细看看，两个人交换模除结果y的过程，是不是和我们之前提到过的<code>方案A</code>有点像呢，这就是思想实验在理论世界中的映射。</p>

<p>这个发现是由我们前面那篇<a href="https://happy123.me/blog/2016/12/25/jia-mi-ji-zhu-fa-zhan/">加密技术发展</a>中帅帅的大叔们在1972年的工作成果，向他们致敬！</p>

<h2>非对称加密算法的建立</h2>

<p>虽然我们上面所建立的交换密钥的方案已经取得了巨大的进步，但是这个方案并不完美，因为它有一个不方便的地方:</p>

<p>Alice 想要给Bob发信，必须拿到Bob的y值，除非是热恋的情人，谁能一直在线回复你的消息呢？所以Alice要发信，一定要Bob配合达成一个密钥才可以；如果Bob恰巧睡觉了，这封信就只能延迟发了</p>

<p>这个不方便之处促使密码学家们寻求更完美的解决之道，这促成了非对称加密算法的建立。</p>

<p>我们至今为止的所有探讨都是建立在对称加密算法之上的。所谓<code>对称加密</code>，就是你有一个密钥，使用这个密钥加密一段信息，同样可以使用这个密钥解密这段信息。正是之前所有的加密算法都是建立在这个基础上的，所以密钥的传递才是如此重要。</p>

<h4>现在让我们思考另外一种看似违反直觉的方案</h4>

<p>如果有一种加密解密函数，它的加密密钥和解密密钥是不同的。在这个系统中，如果Alice只知道加密密钥，她只能加密，加密之后自己却无法解密&mdash;除非她知道另外一个解密密钥。</p>

<p>听起来好像有点绕口。用现代密码学的定义来解释，就是Alice需要同时拥有两把密钥：私钥和公钥。私钥用来解密，公钥用来加密。这样Alice只要好好藏好自己的私钥，然后把公钥广播天下，谁想要给Alice写情书，就用Alice广播出来的公钥加密寄给她就好啦，只有持有私钥的Alice才能解密这封情书。</p>

<p>这个系统的巨大优点就是两人通信不需要同时在线来来回回折腾了，只要两人把各自把自己的公钥广而告之，任何一个人就可以毫不顾忌的用公钥加密，写一些只能给Alice和Bob才能解密的隐私信息了。</p>

<p>这个方案是由帅帅的Whtfield Diffie想到的，在此我们要撒一把狗粮；这位老兄灵光一现想到这个方案之后，第一个想要与之分享的人是他的妻子玛丽，当时的情形是这样的:</p>

<blockquote><p>那是在下午发生的，维特不得不等几个小时，玛丽才会回来。
&ldquo;维特等在门口，&#8221;玛丽回忆说，&#8221;他说有事要告诉我，他脸上的表情很奇怪。我进了门，他说:&lsquo;请坐下来，我想和你说话。我相信我有一个重大的发现&mdash;-我是第一个知道这问题答案的人。&#8217;那一刻我感觉时间突然停止了，我似乎生活在好莱坞的电影中。&rdquo;</p></blockquote>

<p>好，单身狗童鞋们从暴击伤害中回过神来没有，让我们继续艰难的人生~~~</p>

<p>虽然Whtfield Diffie早在1975年就提出了这个方案，但是他没有找到他所需要的函数。他公开发表了论文，号召同时代的数学家们一起来找；但是时间飞逝，年底还是没人能找到这样的函数，有些人灰心了；正在这时，远在5000公里之外的美国西海岸，有个小组找到了这样的函数~~~这就是今天大名鼎鼎的RSA算法的诞生。</p>

<h4>那些个帅帅的大叔们</h4>

<p><img src="https://raw.githubusercontent.com/memoryboxes/memoryboxes.github.io/source/images/20181023/bg1.jpg" alt="RSA加密发明人" /></p>

<p>额，关于RSA算法，阮一峰老师的文章写的更清晰，我就不多废话了；童鞋们可以移步<a href="http://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html">这里</a>来探讨细节，当然，懒得去理解数学原理对于我们下面的探讨也没啥影响~~~~</p>

<h4>让我们总结一下一个典型的非对称加密算法的特点，并看看它是如何应用到实际中的</h4>

<ol>
<li>Bob手里有两把钥匙，一把是公钥，另一把是私钥。有了私钥能推导出公钥，有了公钥不能推导出私钥</li>
<li>用私钥加密，可以使用公钥解密</li>
<li>用公钥加密，可以使用私钥解密</li>
<li>Bob把公钥送给他的朋友们&mdash;&mdash;Alice, Sam ~~每人一把；或者直接把公钥公示在自己的个人网页上，谁都能看；</li>
<li>Alice要给Bob写一封保密的信。她写完后用Bob的公钥加密，就可以达到保密的效果。</li>
<li>Bob收信后，用私钥解密，就看到了信件内容。这里要强调的是，只要Bob的私钥不泄露，这封信就是安全的，即使落在别人手里，也无法解密。</li>
<li>Bob给Alice回信，决定采用&#8221;数字签名&#8221;。他写完后先用Hash函数，生成信件的摘要（digest）。</li>
<li>然后，Bob使用私钥，对这个摘要加密，生成&#8221;数字签名&#8221;（signature）。Bob将这个签名，附在信件下面，一起发给Alice。</li>
<li>Alice收信后，取下数字签名，用Bob的公钥解密，得到信件的摘要。由此证明，这封信确实是鲍勃发出的。</li>
<li>Alice再对信件本身使用Hash函数，将得到的结果，与上一步得到的摘要进行对比。如果两者一致，就证明这封信未被修改过。</li>
<li>复杂的情况出现了。Eve想欺骗Alice，他偷偷使用了Alice的电脑，用自己的公钥换走了鲍勃的公钥。此时，Alice实际拥有的是Eve的公钥，但是还以为这是Bob的公钥。因此，Eve就可以冒充Bob，用自己的私钥做成&#8221;数字签名&#8221;，写信给Alice，让Alice用假的Bob公钥进行解密。</li>
<li>后来，Alice感觉不对劲，发现自己无法确定公钥是否真的属于Bob。每次都去寻找Bob的个人网页去比对也很麻烦；她想到了一个办法，要求Bob去找&#8221;证书中心&#8221;（certificate authority，简称CA），为公钥做认证。证书中心用自己的私钥，对Bob的公钥和一些相关信息一起加密，生成&#8221;数字证书&#8221;（Digital Certificate）。</li>
<li>Bob拿到数字证书以后，就可以放心了。以后再给Alice写信，只要在签名的同时，再附上数字证书就行了。</li>
<li>Alice收到信后，用CA的公钥解开数字证书，就可以拿到Bob真实的公钥了，然后就能证明&#8221;数字签名&#8221;是否真的是Bob签的。</li>
<li>以上过程涉及了<code>非对称加密</code>，<code>HASH</code>，<code>签名</code>,<code>Digest</code>，<code>CA</code>等等名词，没错，我们说的就是HTTPS</li>
</ol>


<p>完整的资料参看这里：</p>

<p><a href="http://www.youdzone.com/signature.html">http://www.youdzone.com/signature.html</a></p>

<h2>椭圆曲线ECC加密算法（Elliptic Curve Cryptography）</h2>

<p>我们看到了，非对称加密的核心，依赖于一个非常健壮的单向函数。RSA采用的是大素数分解的单向函数。这基于一个十分简单的数论事实：将两个大素数相乘十分容易，但是想要对其乘积进行因式分解却极其困难。大质数分解问题一直是数学里面的热门问题。</p>

<p>即便如此，因式分解在位对位基础里不是最难的问题。这些因式分解算法随着被因式分解的数字变得越大而变得越有效率。因式分解大批数字和乘以大批数字的难度的差距随着数字（即秘钥的字节长度）变大而缩小。随着有效解码数字的资源增加，秘钥的大小必须更快增长。对限制计算能力的手机和低功率设备来说，这不是一个可持续的情况。从长期来看，因式分解和乘法的差距是不可持续的。</p>

<p>所有这一切意味着RSA不是理想的系统对将来的密码学来说。在一个完美的trapdoor函数里，对于数字大小的问题，简单方法和困难方法都一同样的速率变难。所以我们需要一个基于更好的trapdoor的公钥系统。</p>

<p>以上RSA的这些不完美加速了另外一种算法的诞生：在1985年，加密算法被提议以一个叫椭圆曲线的数学密码分支为基础。这也是比特币地址采用的核心加密方法。</p>

<h4>什么是椭圆曲线</h4>

<p>对于我们小白来说，椭圆曲线可以暂时简单的理解为描述了特定点的集合的公式：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>y^2 = X^3 + ax + b</span></code></pre></td></tr></table></div></figure>


<p>取不同的a值和b值，这个函数在坐标轴上绘制出来的曲线大概是这样的:</p>

<p><img src="https://raw.githubusercontent.com/memoryboxes/memoryboxes.github.io/source/images/20181023/bg2.jpg" alt="椭圆曲线" /></p>

<p>a和b的取值变化决定了曲线在坐标系上的不同形状。从图中可以看到，椭圆曲线是相对X轴对称。</p>

<p>通过椭圆曲线乘法可以从私钥计算得到公钥，这是不可逆转的过程：K = k * G 。其中k是私钥，G是被称为生成点的常数点，而K是所得公钥。其反向运算，被称为“寻找离散对数”——已知公钥K来求出私钥k——是非常困难的。椭圆曲线乘法是密码学家称之为“陷阱门”功能的一种函数：在一个方向（乘法）很容易做，而不可能在相反的方向（除法）做。 私钥的所有者可以容易地创建公钥，然后与世界共享，知道没有人可以从公钥中反转函数并计算出私钥。</p>

<h4>secp256k1椭圆加密曲线</h4>

<p>a和b的不同取值可以画出多条不同的曲线，比特币使用了secp256k1标准所定义的一种特殊的椭圆曲线和一系列数学常数。该标准由美国国家标准与技术研究院 （NIST）设立。secp256k1曲线由下述函数定义，该函数可产生一条椭圆曲线：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>y^2 % p = (X^3 + 7) % p</span></code></pre></td></tr></table></div></figure>


<p>看到了吧，这个函数结合了我们之前介绍的取模操作和椭圆曲线函数。</p>

<p>上述素数p取模表明该曲线是在素数阶p的有限域内，也写作Fp，其中p = 2<sup>256</sup> – 2<sup>32</sup> – 2<sup>9</sup> – 2<sup>8</sup> – 2<sup>7</sup> – 2<sup>6</sup> – 2<sup>4</sup> – 1， 这是个非常大的素数。 因为这条曲线被定义在一个素数阶的有限域内，而不是定义在实数范围，它的函数图像看起来像分散在两个维度上的散落的点，因此很难可视化。不过，其中的数学原理与实数范围的椭圆曲线相似。</p>

<p>这条曲线画出来的样子大概是这样的:</p>

<p><img src="https://raw.githubusercontent.com/memoryboxes/memoryboxes.github.io/source/images/20181023/bg3.jpg" alt="椭圆曲线" /></p>

<p>在椭圆曲线的数学原理中，有一个点被称为“无穷远点”，这大致对应于0在加法中的作用。计算机中，它有时表示为X = Y = 0（虽然这不满足椭圆曲线方程，但可作为特殊情况进行检验）。</p>

<p>还有一个 + 运算符，被称为“加法”，就像小学数学中的实数相加。给定椭圆曲线上的两个点P1和P2，则椭圆曲线上必定有第三点 P3 = P1 + P2。 几何图形中，该第三点P3可以在P1和P2之间画一条线来确定。这条直线恰好与椭圆曲线相交于另外一个地方。此点记为 P3&#8217;= (x，y)。然后，在x轴做翻折获得 P3=(x，-y)。</p>

<p>下面是几个可以解释“穷远点”之存在需要的特殊情况。</p>

<p>若 P1和 P2是同一点，P1和P2间的连线则为点P1 的切线。曲线上有且只有一个新的点与该切线相交。该切线的斜率可用微积分求得。即使限制曲线点为两个整数坐标也可求得斜率！</p>

<p>在某些情况下（即，如果P1和P2具有相同的x值，但不同的y值），则切线会完全垂直，在这种情况下，P3 = “无穷远点”。</p>

<p>若P1就是“无穷远点”，那么其和 P1 + P2= P2。类似地，当P2是无穷远点，则P1+ P2 = P1。这就是把无穷远点类似于0的作用。 事实证明，在这里 + 运算符遵守结合律，这意味着(A+B)+C = A+(B+C)。这就是说我们可以直接不加括号书写 A + B + C，而不至于混淆。 因此，我们已经定义了椭圆加法，我们可以对乘法用拓展加法的标准方法进行定义。给定椭圆曲线上的点P，如果k是整数，则 kP = P + P + P + …+ P（k次）。注意，在这种情况下k有时被混淆而称为“指数”。</p>

<h4>生成公钥</h4>

<p>以一个随机生成的私钥k为起点，我们将其与曲线上预定的生成点G相乘以获得曲线上的另一点，也就是相应的公钥 K。生成点是secp256k1标准的一部分，比特币密钥的生成点都是相同的：</p>

<p>{K = k * G}</p>

<p>其中k是私钥，G是生成点，在该曲线上所得的点K是公钥。因为所有比特币用户的生成点是相同的，一个私钥k乘以G将 得到相同的公钥K。k和K之间的关系是固定的，但只能单向运算，即从k得到K。这就是可以把比特币地址（K的衍生） 与任何人共享而不会泄露私钥（k）的原因。</p>

<p>提示 因为其中的数学运算是单向的，所以私钥可以转换为公钥，但公钥不能转换回私钥。</p>

<p>为实现椭圆曲线乘法，我们以之前产生的私钥k和与生成点G相乘得到公钥K：</p>

<p>K = 1E99423A4ED27608A15A2616A2B0E9E52CED330AC530EDCC32C8FFC6A526AEDD * G</p>

<p>公钥K 被定义为一个点 K = (x, y)：</p>

<p>K = (x, y)</p>

<p>其中，</p>

<p>x = F028892BAD7ED57D2FB57BF33081D5CFCF6F9ED3D3D7F159C2E2FFF579DC341A</p>

<p>y = 07CF33DA18BD734C600B96A72BBC4749D5141C90EC8AC328AE52DDFE2E505BDB</p>

<p>为了展示整数点的乘法，我们将使用较为简单的实数范围的椭圆曲线。请记住，其中的数学原理是相同的。我们的目标是找到生成点G的倍数kG。也就是将G相加k次。在椭圆曲线中，点的相加等同于从该点画切线找到与曲线相交的另一 点，然后翻折到x轴。</p>

<p>下图显示了在曲线上得到 G、2G、4G 的几何操作。</p>

<p><img src="https://raw.githubusercontent.com/memoryboxes/memoryboxes.github.io/source/images/20181023/bg4.jpg" alt="椭圆曲线" /></p>

<h4>比特币账户</h4>

<p>呼呼，以上就是比特币的账户核心算法的一部分。</p>

<ol>
<li>选定了secp256k1算法，其实是通用的椭圆曲线的特化(a=0, b=7)，另外选定一个非常大的模除数字p</li>
<li>选定了一个G点;G = 04 79BE667E F9DCBBAC 55A06295 CE870B07 029BFCDB 2DCE28D9 59F2815B 16F81798 483ADA77 26A3C465 5DA4FBFC 0E1108A8 FD17B448 A6855419 9C47D08F FB10D4B8</li>
<li>随机生成了一个私钥k</li>
<li>求得公钥K = k * G，这里对G进行了k次翻转，一个不可逆的操作得到公钥K</li>
<li>对K再做后续变形，最终得到比特币账户的地址，这个变形又是一系列神操作，我们在后面的文章会讲</li>
</ol>


<h2>寻求更极限的安全</h2>

<p>到目前为止，密码学家们为了实现更安全的非对称加密算法，探索了模除、大素数分解、以及椭圆曲线；他们的共同特点就是逆向运算极难极难；但是极难并不代表着不可能，随着量子计算的发展，谁也不能保证今后逆向运算的复杂度会不会有大幅降低；所以寻求更安全的单向函数始终是密码学家们最重要的工作之一；</p>

<p>近年来，这个探索的边界又有了更大的突破，就是为人们所熟知的量子加密技术。</p>

<p>限于篇幅，我们就不做更多的科普了，可以参考这本书:</p>

<p><a href="https://book.douban.com/subject/1036413/">https://book.douban.com/subject/1036413/</a></p>

<p>PS:一个小科普，量子计算机和量子加密其实没有多大关系哦，他们之间其实是雷锋和雷峰塔的关系，就是名字相似而已，可不要被忽悠哦</p>

<h2>总结</h2>

<p>呼呼，老实说，我最初想要介绍的是比特币HD钱包的演化过程，BIP32,BIP44,BIP49，BIP84以及BIP141这些文档共同定义了比特币HD钱包的底层构造。</p>

<p>从BIP44开始，比特币账户的管理其实已经在中本聪最初定义的一个简单地址生成的路上又走了很远；我也觉得HD钱包是比特币社区为区块链技术贡献的一个非常重要、非常有用的部分；这个钱包生成的技术超出了比特币本身，在可见的未来，会在多个领域发挥巨大作用。</p>

<p>为了学习比特币HD钱包的基础理论支撑，我们从最原始的凯撒加密，到Alice和Bob的思想实验，到单向函数，再到安全的密钥分发方法，到非对称加密，椭圆曲线，甚至还隐约看到了量子加密，这一切的一切是近2000年来无数密码学家们日日夜夜的冥思苦想的成果；</p>

<p>然后站在所有这些成果的基础上，到了中本聪及比特币技术社区手中融合发扬光大；创造了独一无二的电子货币金融账户；这个账户设计的方法之精妙，值得我们再长篇大论一番；那么，下次文章再见。</p>

<p>参考资料:</p>

<p><a href="https://book.douban.com/subject/30280401/">https://book.douban.com/subject/30280401/</a></p>

<p><a href="https://book.douban.com/subject/1036413/">https://book.douban.com/subject/1036413/</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[我们的货币超发了吗]]></title>
    <link href="https://happy123.me/blog/2018/10/16/wo-men-de-huo-bi-chao-fa-liao-ma/"/>
    <updated>2018-10-16T19:21:08+08:00</updated>
    <id>https://happy123.me/blog/2018/10/16/wo-men-de-huo-bi-chao-fa-liao-ma</id>
    <content type="html"><![CDATA[<p>这是一个没有公认答案的问题，但是从央行的角度来说说，真有点冤；</p>

<p>看看一些数据吧：</p>

<!-- more -->


<h4>美国 (单位：亿美元)</h4>

<table>
<thead>
<tr>
<th>Year</th>
<th> M0  </th>
<th> M2 </th>
<th> GDP</th>
</tr>
</thead>
<tbody>
<tr>
<td>2008</td>
<td>8370 </td>
<td>74574  </td>
<td>144776</td>
</tr>
<tr>
<td>2018</td>
<td>38500</td>
<td>138344 </td>
<td>193906</td>
</tr>
</tbody>
</table>


<p>来源：<a href="https://stock-ai.com/eom-1-M2SL.php">https://stock-ai.com/eom-1-M2SL.php</a></p>

<h4>中国 (单位:亿元)</h4>

<table>
<thead>
<tr>
<th>Year</th>
<th> M0 </th>
<th> M2 </th>
<th>GDP</th>
<th> 外汇储备(亿美元)</th>
<th> 外汇占款(亿元) </th>
<th> 汇率</th>
</tr>
</thead>
<tbody>
<tr>
<td>2008 </td>
<td>  36673 </td>
<td> 403442.2 </td>
<td> 265810.30 </td>
<td> 15898.10 </td>
<td> 115168.71 </td>
<td> 7.4</td>
</tr>
<tr>
<td>2018 </td>
<td>  70645 </td>
<td> 1676800 </td>
<td> 827122.00 </td>
<td> 31399.49 </td>
<td> 214788 </td>
<td> 6.6</td>
</tr>
</tbody>
</table>


<p>来源：<a href="http://www.pbc.gov.cn/diaochatongjisi/116219/index.html">http://www.pbc.gov.cn/diaochatongjisi/116219/index.html</a></p>

<p>Tooltips:</p>

<h3>m2对应的只是存款，没有包含所有的可变现金融资产。另外中美M2统计口径不同</h3>

<h4>美国M2包含零售的货币市场基金份额，是指在售的部分，美国M1、M2的统计口径分别如下：</h4>

<ul>
<li><p>M1：包括：</p>

<p>  1）美国财政部、联邦储备银行以及存款货币机构之外的现金；
  2）旅行支票；
  3）商业银行活期存款；
  4）其他可支付存款；NOW；ATS以及储蓄贷款协会的定期存款。</p></li>
<li><p>M2：包括M1，以及
  1）储蓄存款（包括货币市场存款账户）；
  2）小额定期存款（即10万美元以下）；
  3）零售的货币市场基金份额。</p></li>
</ul>


<p>当前美国货币统计口径最大的M2并未包括机构的大额存款以及境外流入的资金，主要是个人的储蓄存款以及机构的小额定期存款。美国的M2仅大致相当于中国的M1加上储蓄存款，即小于中国M2的统计口径。</p>

<h4>中国的M2包括了货币和准货币，基本上代表了货币总量即广义货币。但是，国际上并不存在这样的约定俗成：M2即是广义货币。</h4>

<h3>中国M2是否超发</h3>

<h4>统计方法差异</h4>

<p>2016-06的统计数据，美国GDP总量17.87万亿美元，中国GDP总量10.42万亿美元，美国总量是中国的1.7倍。美国M2总量12万亿，中国M2总量22万亿，中国M2是1.83倍，看起来似乎人民币超发了。</p>

<p>但是美国基金行业总量17.8万亿美元，中国基金行业总量仅1.2万亿美元，美国国债规模12万亿美元，中国国债规模3万亿美元</p>

<p>美国的财富更多通过直接投资来体现，不体现在M2中，比如同样是购买债券，中国的模式是“个人存银行－》银行购买国债”，而美国的模式是“个人购买债券基金－》债券基金购买国债”或者“个人和机构直接购买国债”。</p>

<p>如果 <code>P＝M2+开放式基金余额＋国债余额</code></p>

<ul>
<li>P（美国）＝12+17.8+12=41.8</li>
<li>P（中国）＝22+3+1.2=26.2</li>
</ul>


<p>那么P（美国）／P（中国）＝1.6</p>

<p>这样看又是正常的</p>

<p>链接：<a href="https://xueqiu.com/5819606767/70273695">https://xueqiu.com/5819606767/70273695</a></p>

<h4>外汇占款理解</h4>

<ul>
<li><p>从<code>M0/外汇占款</code>来看，并没有超发；汇率也是正常的波动</p></li>
<li><p>从美国自己的M2膨胀来看，美元购买力其实下降了，我们的外汇占款发行方式其实吃了美国QE的亏，这是强势美元全世界割韭菜，怨不得央行</p></li>
</ul>


<h3>结论</h3>

<ul>
<li><p>央行对外通过购买美国国债对抗美元通胀，对内实行外汇占款为基础的本币发行，佐以发行国债冲销干预M2超发隐患，操作水平是非常高的，没有可黑的地方;</p></li>
<li><p>除去M2的统计差异，我们的M2/M0比值相对于美国过高；货币周转快，这是我们处于发展相对高速的周期决定的</p></li>
<li><p>美元的通胀和我们高速的货币周转共同造成了国内通胀压力，这不能全部甩锅货币政策</p></li>
<li><p>M2迅猛增长还是经济周期的大势决定，经济周期是逃不开的；</p></li>
<li><p>我们已经享受了很长时间的高增长繁荣，这是不可持续的，有繁荣就有衰落，平常心对待之</p></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[The Evolution of a Programmer]]></title>
    <link href="https://happy123.me/blog/2018/10/06/the-evolution-of-a-programmer/"/>
    <updated>2018-10-06T17:22:54+08:00</updated>
    <id>https://happy123.me/blog/2018/10/06/the-evolution-of-a-programmer</id>
    <content type="html"><![CDATA[<p>快有二十年的老段子了，最近又看到很多次，莫非是邪恶旧势力的崛起？存档一下。</p>

<!-- more -->


<h4>High School/Jr.High</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  10 PRINT "HELLO WORLD"
</span><span class='line'>  20 END</span></code></pre></td></tr></table></div></figure>


<h4>First year in College</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  program Hello(input, output)
</span><span class='line'>    begin
</span><span class='line'>      writeln('Hello World')
</span><span class='line'>    end.</span></code></pre></td></tr></table></div></figure>


<h4>Senior year in College</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  (defun hello
</span><span class='line'>    (print
</span><span class='line'>      (cons 'Hello (list 'World))))</span></code></pre></td></tr></table></div></figure>


<h4>New professional</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  #include &lt;stdio.h&gt;
</span><span class='line'>  void main(void)
</span><span class='line'>  {
</span><span class='line'>    char *message[] = {"Hello ", "World"};
</span><span class='line'>    int i;
</span><span class='line'> 
</span><span class='line'>    for(i = 0; i &lt; 2; ++i)
</span><span class='line'>      printf("%s", message[i]);
</span><span class='line'>    printf("\n");
</span><span class='line'>  }</span></code></pre></td></tr></table></div></figure>


<h4>Seasoned professional</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  #include &lt;iostream.h&gt;
</span><span class='line'>  #include &lt;string.h&gt;
</span><span class='line'> 
</span><span class='line'>  class string
</span><span class='line'>  {
</span><span class='line'>  private:
</span><span class='line'>    int size;
</span><span class='line'>    char *ptr;
</span><span class='line'> 
</span><span class='line'>  string() : size(0), ptr(new char[1]) { ptr[0] = 0; }
</span><span class='line'> 
</span><span class='line'>    string(const string &s) : size(s.size)
</span><span class='line'>    {
</span><span class='line'>      ptr = new char[size + 1];
</span><span class='line'>      strcpy(ptr, s.ptr);
</span><span class='line'>    }
</span><span class='line'> 
</span><span class='line'>    ~string()
</span><span class='line'>    {
</span><span class='line'>      delete [] ptr;
</span><span class='line'>    }
</span><span class='line'> 
</span><span class='line'>    friend ostream &operator &lt;&lt;(ostream &, const string &);
</span><span class='line'>    string &operator=(const char *);
</span><span class='line'>  };
</span><span class='line'> 
</span><span class='line'>  ostream &operator&lt;&lt;(ostream &stream, const string &s)
</span><span class='line'>  {
</span><span class='line'>    return(stream &lt;&lt; s.ptr);
</span><span class='line'>  }
</span><span class='line'> 
</span><span class='line'>  string &string::operator=(const char *chrs)
</span><span class='line'>  {
</span><span class='line'>    if (this != &chrs)
</span><span class='line'>    {
</span><span class='line'>      delete [] ptr;
</span><span class='line'>     size = strlen(chrs);
</span><span class='line'>      ptr = new char[size + 1];
</span><span class='line'>      strcpy(ptr, chrs);
</span><span class='line'>    }
</span><span class='line'>    return(*this);
</span><span class='line'>  }
</span><span class='line'> 
</span><span class='line'>  int main()
</span><span class='line'>  {
</span><span class='line'>    string str;
</span><span class='line'> 
</span><span class='line'>    str = "Hello World";
</span><span class='line'>    cout &lt;&lt; str &lt;&lt; endl;
</span><span class='line'> 
</span><span class='line'>    return(0);
</span><span class='line'>  }</span></code></pre></td></tr></table></div></figure>


<h4>Master Programmer</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  [
</span><span class='line'>  uuid(2573F8F4-CFEE-101A-9A9F-00AA00342820)
</span><span class='line'>  ]
</span><span class='line'>  library LHello
</span><span class='line'>  {
</span><span class='line'>      // bring in the master library
</span><span class='line'>      importlib("actimp.tlb");
</span><span class='line'>      importlib("actexp.tlb");
</span><span class='line'> 
</span><span class='line'>      // bring in my interfaces
</span><span class='line'>      #include "pshlo.idl"
</span><span class='line'> 
</span><span class='line'>      [
</span><span class='line'>      uuid(2573F8F5-CFEE-101A-9A9F-00AA00342820)
</span><span class='line'>      ]
</span><span class='line'>      cotype THello
</span><span class='line'>   {
</span><span class='line'>   interface IHello;
</span><span class='line'>   interface IPersistFile;
</span><span class='line'>   };
</span><span class='line'>  };
</span><span class='line'> 
</span><span class='line'>  [
</span><span class='line'>  exe,
</span><span class='line'>  uuid(2573F890-CFEE-101A-9A9F-00AA00342820)
</span><span class='line'>  ]
</span><span class='line'>  module CHelloLib
</span><span class='line'>  {
</span><span class='line'> 
</span><span class='line'>      // some code related header files
</span><span class='line'>      importheader(&lt;windows.h&gt;);
</span><span class='line'>      importheader(&lt;ole2.h&gt;);
</span><span class='line'>      importheader(&lt;except.hxx&gt;);
</span><span class='line'>      importheader("pshlo.h");
</span><span class='line'>      importheader("shlo.hxx");
</span><span class='line'>      importheader("mycls.hxx");
</span><span class='line'> 
</span><span class='line'>      // needed typelibs
</span><span class='line'>      importlib("actimp.tlb");
</span><span class='line'>      importlib("actexp.tlb");
</span><span class='line'>      importlib("thlo.tlb");
</span><span class='line'> 
</span><span class='line'>      [
</span><span class='line'>      uuid(2573F891-CFEE-101A-9A9F-00AA00342820),
</span><span class='line'>      aggregatable
</span><span class='line'>      ]
</span><span class='line'>      coclass CHello
</span><span class='line'>   {
</span><span class='line'>   cotype THello;
</span><span class='line'>   };
</span><span class='line'>  };
</span><span class='line'> 
</span><span class='line'> 
</span><span class='line'>  #include "ipfix.hxx"
</span><span class='line'> 
</span><span class='line'>  extern HANDLE hEvent;
</span><span class='line'> 
</span><span class='line'>  class CHello : public CHelloBase
</span><span class='line'>  {
</span><span class='line'>  public:
</span><span class='line'>      IPFIX(CLSID_CHello);
</span><span class='line'> 
</span><span class='line'>      CHello(IUnknown *pUnk);
</span><span class='line'>      ~CHello();
</span><span class='line'> 
</span><span class='line'>      HRESULT  __stdcall PrintSz(LPWSTR pwszString);
</span><span class='line'> 
</span><span class='line'>  private:
</span><span class='line'>      static int cObjRef;
</span><span class='line'>  };
</span><span class='line'> 
</span><span class='line'> 
</span><span class='line'>  #include &lt;windows.h&gt;
</span><span class='line'>  #include &lt;ole2.h&gt;
</span><span class='line'>  #include &lt;stdio.h&gt;
</span><span class='line'>  #include &lt;stdlib.h&gt;
</span><span class='line'>  #include "thlo.h"
</span><span class='line'>  #include "pshlo.h"
</span><span class='line'>  #include "shlo.hxx"
</span><span class='line'>  #include "mycls.hxx"
</span><span class='line'> 
</span><span class='line'>  int CHello::cObjRef = 0;
</span><span class='line'> 
</span><span class='line'>  CHello::CHello(IUnknown *pUnk) : CHelloBase(pUnk)
</span><span class='line'>  {
</span><span class='line'>      cObjRef++;
</span><span class='line'>      return;
</span><span class='line'>  }
</span><span class='line'> 
</span><span class='line'>  HRESULT  __stdcall  CHello::PrintSz(LPWSTR pwszString)
</span><span class='line'>  {
</span><span class='line'>      printf("%ws
</span><span class='line'>", pwszString);
</span><span class='line'>      return(ResultFromScode(S_OK));
</span><span class='line'>  }
</span><span class='line'> 
</span><span class='line'> 
</span><span class='line'>  CHello::~CHello(void)
</span><span class='line'>  {
</span><span class='line'> 
</span><span class='line'>  // when the object count goes to zero, stop the server
</span><span class='line'>  cObjRef--;
</span><span class='line'>  if( cObjRef == 0 )
</span><span class='line'>      PulseEvent(hEvent);
</span><span class='line'> 
</span><span class='line'>  return;
</span><span class='line'>  }
</span><span class='line'> 
</span><span class='line'>  #include &lt;windows.h&gt;
</span><span class='line'>  #include &lt;ole2.h&gt;
</span><span class='line'>  #include "pshlo.h"
</span><span class='line'>  #include "shlo.hxx"
</span><span class='line'>  #include "mycls.hxx"
</span><span class='line'> 
</span><span class='line'>  HANDLE hEvent;
</span><span class='line'> 
</span><span class='line'>   int _cdecl main(
</span><span class='line'>  int argc,
</span><span class='line'>  char * argv[]
</span><span class='line'>  ) {
</span><span class='line'>  ULONG ulRef;
</span><span class='line'>  DWORD dwRegistration;
</span><span class='line'>  CHelloCF *pCF = new CHelloCF();
</span><span class='line'> 
</span><span class='line'>  hEvent = CreateEvent(NULL, FALSE, FALSE, NULL);
</span><span class='line'> 
</span><span class='line'>  // Initialize the OLE libraries
</span><span class='line'>  CoInitializeEx(NULL, COINIT_MULTITHREADED);
</span><span class='line'> 
</span><span class='line'>  CoRegisterClassObject(CLSID_CHello, pCF, CLSCTX_LOCAL_SERVER,
</span><span class='line'>      REGCLS_MULTIPLEUSE, &dwRegistration);
</span><span class='line'> 
</span><span class='line'>  // wait on an event to stop
</span><span class='line'>  WaitForSingleObject(hEvent, INFINITE);
</span><span class='line'> 
</span><span class='line'>  // revoke and release the class object
</span><span class='line'>  CoRevokeClassObject(dwRegistration);
</span><span class='line'>  ulRef = pCF-&gt;Release();
</span><span class='line'> 
</span><span class='line'>  // Tell OLE we are going away.
</span><span class='line'>  CoUninitialize();
</span><span class='line'> 
</span><span class='line'>  return(0); }
</span><span class='line'> 
</span><span class='line'>  extern CLSID CLSID_CHello;
</span><span class='line'>  extern UUID LIBID_CHelloLib;
</span><span class='line'> 
</span><span class='line'>  CLSID CLSID_CHello = { /* 2573F891-CFEE-101A-9A9F-00AA00342820 */
</span><span class='line'>      0x2573F891,
</span><span class='line'>      0xCFEE,
</span><span class='line'>      0x101A,
</span><span class='line'>      { 0x9A, 0x9F, 0x00, 0xAA, 0x00, 0x34, 0x28, 0x20 }
</span><span class='line'>  };
</span><span class='line'> 
</span><span class='line'>  UUID LIBID_CHelloLib = { /* 2573F890-CFEE-101A-9A9F-00AA00342820 */
</span><span class='line'>      0x2573F890,
</span><span class='line'>      0xCFEE,
</span><span class='line'>      0x101A,
</span><span class='line'>      { 0x9A, 0x9F, 0x00, 0xAA, 0x00, 0x34, 0x28, 0x20 }
</span><span class='line'>  };
</span><span class='line'> 
</span><span class='line'>  #include &lt;windows.h&gt;
</span><span class='line'>  #include &lt;ole2.h&gt;
</span><span class='line'>  #include &lt;stdlib.h&gt;
</span><span class='line'>  #include &lt;string.h&gt;
</span><span class='line'>  #include &lt;stdio.h&gt;
</span><span class='line'>  #include "pshlo.h"
</span><span class='line'>  #include "shlo.hxx"
</span><span class='line'>  #include "clsid.h"
</span><span class='line'> 
</span><span class='line'>  int _cdecl main(
</span><span class='line'>  int argc,
</span><span class='line'>  char * argv[]
</span><span class='line'>  ) {
</span><span class='line'>  HRESULT  hRslt;
</span><span class='line'>  IHello        *pHello;
</span><span class='line'>  ULONG  ulCnt;
</span><span class='line'>  IMoniker * pmk;
</span><span class='line'>  WCHAR  wcsT[_MAX_PATH];
</span><span class='line'>  WCHAR  wcsPath[2 * _MAX_PATH];
</span><span class='line'> 
</span><span class='line'>  // get object path
</span><span class='line'>  wcsPath[0] = '\0';
</span><span class='line'>  wcsT[0] = '\0';
</span><span class='line'>  if( argc &gt; 1) {
</span><span class='line'>      mbstowcs(wcsPath, argv[1], strlen(argv[1]) + 1);
</span><span class='line'>      wcsupr(wcsPath);
</span><span class='line'>      }
</span><span class='line'>  else {
</span><span class='line'>      fprintf(stderr, "Object path must be specified\n");
</span><span class='line'>      return(1);
</span><span class='line'>      }
</span><span class='line'> 
</span><span class='line'>  // get print string
</span><span class='line'>  if(argc &gt; 2)
</span><span class='line'>      mbstowcs(wcsT, argv[2], strlen(argv[2]) + 1);
</span><span class='line'>  else
</span><span class='line'>      wcscpy(wcsT, L"Hello World");
</span><span class='line'> 
</span><span class='line'>  printf("Linking to object %ws\n", wcsPath);
</span><span class='line'>  printf("Text String %ws\n", wcsT);
</span><span class='line'> 
</span><span class='line'>  // Initialize the OLE libraries
</span><span class='line'>  hRslt = CoInitializeEx(NULL, COINIT_MULTITHREADED);
</span><span class='line'> 
</span><span class='line'>  if(SUCCEEDED(hRslt)) {
</span><span class='line'> 
</span><span class='line'> 
</span><span class='line'>      hRslt = CreateFileMoniker(wcsPath, &pmk);
</span><span class='line'>      if(SUCCEEDED(hRslt))
</span><span class='line'>   hRslt = BindMoniker(pmk, 0, IID_IHello, (void **)&pHello);
</span><span class='line'> 
</span><span class='line'>      if(SUCCEEDED(hRslt)) {
</span><span class='line'> 
</span><span class='line'>   // print a string out
</span><span class='line'>   pHello-&gt;PrintSz(wcsT);
</span><span class='line'> 
</span><span class='line'>   Sleep(2000);
</span><span class='line'>   ulCnt = pHello-&gt;Release();
</span><span class='line'>   }
</span><span class='line'>      else
</span><span class='line'>   printf("Failure to connect, status: %lx", hRslt);
</span><span class='line'> 
</span><span class='line'>      // Tell OLE we are going away.
</span><span class='line'>      CoUninitialize();
</span><span class='line'>      }
</span><span class='line'> 
</span><span class='line'>  return(0);
</span><span class='line'>  }</span></code></pre></td></tr></table></div></figure>


<h4>Apprentice Hacker</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  #!/usr/local/bin/perl
</span><span class='line'>  $msg="Hello, world.\n";
</span><span class='line'>  if ($#ARGV &gt;= 0) {
</span><span class='line'>    while(defined($arg=shift(@ARGV))) {
</span><span class='line'>      $outfilename = $arg;
</span><span class='line'>      open(FILE, "&gt;" . $outfilename) || die "Can't write $arg: $!\n";
</span><span class='line'>      print (FILE $msg);
</span><span class='line'>      close(FILE) || die "Can't close $arg: $!\n";
</span><span class='line'>    }
</span><span class='line'>  } else {
</span><span class='line'>    print ($msg);
</span><span class='line'>  }
</span><span class='line'>  1;</span></code></pre></td></tr></table></div></figure>


<h4>Experienced Hacker</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  #include &lt;stdio.h&gt;
</span><span class='line'>  #define S "Hello, World\n"
</span><span class='line'>  main(){exit(printf(S) == strlen(S) ? 0 : 1);}</span></code></pre></td></tr></table></div></figure>


<h4>Seasoned Hacker</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  % cc -o a.out ~/src/misc/hw/hw.c
</span><span class='line'>  % a.out</span></code></pre></td></tr></table></div></figure>


<h4>Guru Hacker</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  % echo "Hello, world."</span></code></pre></td></tr></table></div></figure>


<h4>New Manager</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  10 PRINT "HELLO WORLD"
</span><span class='line'>  20 END</span></code></pre></td></tr></table></div></figure>


<h4>Middle Manager</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  mail -s "Hello, world." bob@b12
</span><span class='line'>  Bob, could you please write me a program that prints "Hello, world."?
</span><span class='line'>  I need it by tomorrow.
</span><span class='line'>  ^D</span></code></pre></td></tr></table></div></figure>


<h4>Senior Manager</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  % zmail jim
</span><span class='line'>  I need a "Hello, world." program by this afternoon.</span></code></pre></td></tr></table></div></figure>


<h4>Chief Executive</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  % letter
</span><span class='line'>  letter: Command not found.
</span><span class='line'>  % mail
</span><span class='line'>  To: ^X ^F ^C
</span><span class='line'>  % help mail
</span><span class='line'>  help: Command not found.
</span><span class='line'>  % damn!
</span><span class='line'>  !: Event unrecognized
</span><span class='line'>  % logout</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[两个经典的排障故事]]></title>
    <link href="https://happy123.me/blog/2018/10/04/liang-ge-jing-dian-de-pai-zhang-gu-shi/"/>
    <updated>2018-10-04T21:48:57+08:00</updated>
    <id>https://happy123.me/blog/2018/10/04/liang-ge-jing-dian-de-pai-zhang-gu-shi</id>
    <content type="html"><![CDATA[<p>很久之前就在某杂志上看过，不久前在知乎<a href="https://www.zhihu.com/question/21747929">有哪些让你目瞪口呆的 bug</a>里面又见到了；我觉得这两个troubleshooting的case有很深的道理在里面，记一下。</p>

<h3>电子邮件无法发送到500英里以外</h3>

<!-- more -->


<p>这个故事最早出现于2002年11月24日，而且每过若干年，它就会在不同的系统管理技术社区中再次出现，并且引发人们的热议和关注。有人对这个故事给出了这样的评价：</p>

<blockquote><p>这个故事大约每过三年或四年就会在系统管理社区出现，每次我读到它，都觉得很值得一读。即便在正常环境下已经做过检查，甚或经过片刻思考之后，我还是高度怀疑这种事情是否会发生在自己身上。</p></blockquote>

<p>这是一个真实的故事。如果你想要进一步了解它的相关信息，可以访问这个 <a href="http://www.ibiblio.org/harris/500milemail-faq.html">FAQ</a> &ndash; 一个关于本故事的常见问题列表，由本故事作者 Trey Harris 编写。</p>

<p>这个故事听起来有点儿天方夜谭的感觉&hellip; 我已经有些后悔把这个故事分享给大家了，因为它很可能会沦为众人茶余饭后的谈资。:&ndash;) 为了保护自己的内疚感，我对故事做了稍许改动，省略了无关紧要以及无聊的细节，总之让故事变得更加生动有趣了。</p>

<p>几年以前，我在一家运营校园邮件系统的公司工作。有一天，我接到了来自统计部主任给我的电话。</p>

<p>“我们的邮件系统存在一个问题。”</p>

<p>“什么问题？” 我问道。</p>

<p>“我们不能发送超过500英里距离的邮件，” 主任解释说。</p>

<p>我被手中的拿铁咖啡呛着了。“再说一遍？”</p>

<p>“我们不能把邮件发送到超过500英里距离的地方，” 他重复道。“真的，哪怕再远一点点。只能到达520英里，不能再远了。”</p>

<p>“嗯&hellip;通常来说，邮件真的不是按照这种方式来发送的，” 我说道，并尽力让自己的声音平静下来。一个人与部门主任谈话时通常不会带有恐慌情绪，即使是一个相对无实权的部门如统计部。“是什么让你认为邮件不能发送超过500英里之外的？”</p>

<p>“并非我这么认为，” 主任不耐烦地回答道。“你瞧，几天之前我们就发现了这一现象&hellip;”</p>

<p>“你等了好几天了？” 我打断他的话，声音有些颤抖地问道，“这段时间你都不能发送邮件吗？”</p>

<p>“我们能发邮件，只要不超过&hellip;”</p>

<p>“500英里，是吧，” 我替他补充道，“我知道了。但是为什么你不早点给我电话呢？”</p>

<p>“好吧，问题是直到刚才，我们才收集到足够的证据确定这一现象的发生。” 也对，他是统计部主任。“总之，我让一名地理统计人员去调查了这件事情&hellip;”</p>

<p>“地理统计人员&hellip;”</p>

<p>“是的，她制作了一张地图，地图上显示我们能发送邮件的区域半径比500英里多那么一点点。即便如此，这个半径区域之内的有些地方也不能发送，或者偶发性地能发送，但是在半径区域之外从来没有发送成功过。”</p>

<p>“我明白了，” 我说道，“何时开始的？你说几天之前，那么这段时间内系统发生什么改变了吗？”</p>

<p>“是的，技术服务人员来过，给服务器打了补丁然后重启了系统。但是我给他去过电话，他说他没碰邮件系统。”</p>

<p>“好的，我先看看吧，然后再给你打过去，” 我说，几乎不相信我也会来虚与委蛇这一套。今天不是愚人节啊。我试着去回忆，是不是有人欠我一个恶作剧。</p>

<p>我登进他们部门的服务器，发了一封测试邮件。这是发送到北卡罗莱纳州的三角研究实验，测试邮件很顺利地到达我的邮箱。同前面一样，我又发送到里士满、亚特兰大、华盛顿，还有普林斯顿（400英里），都能顺利到达。</p>

<p>但是当我尝试发送邮件到孟菲斯（600英里）时，却失败了。发往波士顿，失败了。发往底特律，同样是失败。我拿出我的地址薄，开始试图缩小范围。纽约（420英里）可以发送，但是普罗维登斯（580英里）就失败了。</p>

<p>我开始困惑，是不是我失去了理智。我试着给我一位居住在北卡罗来纳州的朋友发送邮件，他的 ISP（网络服务提供商）在西雅图。谢天谢地，发送失败了。如果这个问题只和收件人的居住位置有关，而不是和他（她）的邮件服务器有关的话，我想我真该泪奔了。</p>

<p>问题得以确认，尽管令人难以置信，但问题确实存在而且可以重现。我查看了 sendmail.cf 文件，它看起来很正常，没有任何问题。事实上，它看起来很熟悉。</p>

<p>我将这个文件和我本机 home 目录下的 sendmail.cf 文件进行了比对。二者没有什么不同，这个文件就是我自己写的。我也确信没有启用 “FAIL_MAIL_OVER_500_MILES” 这一选项。带着满腹困惑，我远程登录到 SMTP 端口。服务器使用一个 SunOS sendmail 标识愉快地做出了响应。</p>

<p>等等&hellip; 一个 SunOS sendmail 标识？在那时，Sun 仍然随同操作系统捆绑发布 Sendmail 5 版本，尽管 Sendmail 8 已经相当成熟了。作为一名优秀的系统管理员，我已经把 Sendmail 8 作为一个标配了。同时，作为一名优秀系统管理员，我写了一个 sendmail.cf 配置文件，使用了 Sendmail 8 中优雅详细且自我描述的选项和变量名，而不是 Sendmail 5 中含义模糊的标点符号标记的代码。</p>

<p>一切都水落石出了，突然间，我被那杯现已冷的掉渣的拿铁咖啡再次被呛到了。当那名技服给服务器打补丁的时候，很显然他也升级了 SunOS 的版本，如此一来自然把 Sendmail 的版本“降级”了。升级程序将 sendmail.cf 配置文件单独保留了下来，即使它现在对应的是错误的版本。</p>

<p>碰巧的是 Sendmail 5（至少 Sun 发布的版本，或许做过一些调整）可以处理 Sendmail 8 的 sendmail.cf 配置文件，因为大多数的规则在那时并没有改变。但是对于那些在 Sendmail 8 中新增的长配置项，Sendmail 5 将之视为垃圾而忽略掉了。sendmail 的二进制安装包对大多数选项没有提供默认值，因此，如果在 sendmail.cf 中找不到合适的设置，它们就会被设为0。</p>

<p>这些被设为0的选项之一就是连接远程 SMTP 服务器的超时时间。一些试验已经证实，在一个具有典型负载的特定机器上，零超时意味着如果连接时间稍微超过3毫秒，服务器就会终止连接。</p>

<p>当时我们的校园网络有一个很奇怪的特点，它是百分之百交换型网络。发送出去的数据包，在遇到 POP 服务器和远端路由器之前，不会出现路由器延迟。因此，连接到临近网络上负载较轻的服务器所花的时间，很大程度上是由光速决定的，而不是偶发的路由器延迟。</p>

<p>这可真是让人有点儿眼花缭乱啊，我在 shell 里敲入如下代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ units
</span><span class='line'>1311 units, 63 prefixes
</span><span class='line'>
</span><span class='line'>You have: 3 millilightseconds  
</span><span class='line'>You want: miles  
</span><span class='line'>        * 558.84719
</span><span class='line'>        / 0.0017893979
</span><span class='line'>
</span><span class='line'>"500 miles, or a little bit more."</span></code></pre></td></tr></table></div></figure>


<p>原文:</p>

<p><a href="http://www.ibiblio.org/harris/500milemail.html">http://www.ibiblio.org/harris/500milemail.html</a></p>

<h3>地板阻碍打印</h3>

<p>那还是80年代初期，我爸爸在一家存储设备公司工作，这个公司现在已经不存在了，它生产磁带机和驱动这些磁带高速运转的气动系统 —— 这是那个时代的产物。</p>

<p>他们技术改造了磁带驱动器，使得你可以只有一个中心驱动器 —— “A”盘 —— 由它连接着数个“B”盘，在跟A盘连接的内存里驻留这一个小型的操作系统，负责代理所有B盘的数据的读写操作。</p>

<p>每次当你启动A驱动器，你需要在外围驱动器里插入一张软盘，操作系统会把A盘加载到内存里。这个操作系统简单的出奇 —— 它的处理能力全部从一个8字节的微型控制器产生。</p>

<p>这种设备的目标用户是拥有大量数据的企业 —— 银行，杂志等等 —— 他们需要打印大量的地址簿或银行帐目。</p>

<p>有个客户出现了一个问题。在打印的过程中，有个别的驱动器会停止工作，导致整个打印过程终止。为了重载驱动器，值班人员必须重启所有驱动 —— 如果这种事情发生在一个6小时的打印任务中，大量宝贵的计算机使用时间都会浪费，整个任务将不能按时间完成。</p>

<p>公司派出了技术人员。技术人员尽了他最大的努力也不能在测试环境复制出这个问题：这个问题似乎只会出现在打印大量任务的过程中。尽管问题出在硬件上可能性微乎其微，他还是更换了所有的设备 —— 内存，微处理器，磁盘驱动，所有跟磁带机相关的部件 —— 但问题仍然出现。</p>

<p>于是技术人员打电话给总部叫来了一位专家。</p>

<p>专家要了一把椅子和一杯咖啡，坐在了计算机房 —— 那个时候他们已经专门为计算机提供了机房 —— 值班人员准备了一大堆的打印任务，他就在旁边看着。他等着，一直到机器崩溃。机器果真崩溃了，所有人都看着专家 —— 专家没有发现任何的线索。他命令把打印任务重新执行一次，所有的值班人员和技术人员都回各自岗位工作。</p>

<p>专家又在椅子上做下来，等着机器崩溃。这一等就是六小时，但真的又发生了。专家仍然没有弄清是什么导致了崩溃 —— 除了有一点他注意到，崩溃总是发生在屋内人比较多的时候。他命令再打印一次，重新坐下，等着。</p>

<p>当第三次崩溃时，他发现了一件事情。崩溃总是在值班人员更换其他没有关联的启动盘时发生的。进一步研究，他意识到当一个值班人员走过某块地板时崩溃就会发生。</p>

<p>地板是由铝制的板块拼成，下面有6 到 8 英寸高的隔空层，计算机所使用的大量的电缆都走地板下，这样可以避免值班人员无意间踢到它们。地板块间拼合的很紧密，这是为了保证垃圾不掉进电缆通过的空间。</p>

<p>专家说有一块地板变形了。当值班人员踩着这块变形的地板的一角时，地板块的边缘相互摩擦，这就会跟连接各地板的塑料之间产生静电，进而造成电磁干扰。</p>

<p>如今所有的RAM都有防电磁干扰功能。但当时并没有这种技术。专家指出，电磁干扰破坏的RAM的工作，操作系统也就崩溃了。</p>

<p>专家打电话给维护部门，拿来了一块新地板，他自己把它装上，问题就这样解决了。</p>

<p>原文:</p>

<p><a href="http://patrickthomson.tumblr.com/post/2499755681/the-best-debugging-story-ive-ever-heard">http://patrickthomson.tumblr.com/post/2499755681/the-best-debugging-story-ive-ever-heard</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[用wireshark分析网络]]></title>
    <link href="https://happy123.me/blog/2018/10/02/yong-wiresharkfen-xi-wang-luo/"/>
    <updated>2018-10-02T21:36:37+08:00</updated>
    <id>https://happy123.me/blog/2018/10/02/yong-wiresharkfen-xi-wang-luo</id>
    <content type="html"><![CDATA[<p>这两天看了两本有意思的书，<a href="https://book.douban.com/subject/26268767/">《Wireshark网络分析就这么简单》</a>、<a href="https://book.douban.com/subject/26710788/">《wireshark网络分析的艺术》</a>。</p>

<p>之前工作中就常常用到这个软件，好多时候总是感叹<code>这个软件实在太NB了</code>，这本书作者也是个实战派，采用种种案例展示了如何用Wireshark探索网络现象，实在是很迷人。</p>

<p>开篇有一个很有意思的小问题，我思考了一下，觉得很容易作为网络理解的小case用在课堂ABC上，记录一下。</p>

<!-- more -->


<h3>问题：两台服务器A和B的网络配置如下</h3>

<ul>
<li><p>服务器A:</p>

<ul>
<li>IP:192.168.26.129</li>
<li>Mask: 255.255.255.0</li>
<li>Gateway: 192.160.26.2</li>
</ul>
</li>
<li><p>服务器B:</p>

<ul>
<li>IP:192.168.26.3</li>
<li>Mask: 255.255.255.224</li>
<li>Gateway: 192.160.26.2</li>
</ul>
</li>
</ul>


<p>B的子网掩码本应该是255.255.255.0，被不小心配成了255.255.255.224。它们还能正常通信吗？</p>

<p>哈哈，我就喜欢这样简单明快的问题。看似简单，其实想想还是有点陷阱的。而且这种问题有个共同点，就是如果你不懂原理，也没关系；喜欢瞎动手的童鞋一般都会去试试这种情况，所以能把答案<code>碰出来</code>。我就见到过这种·自学成才·的老师，他们从来没有在学校里系统学过什么TCP/IP或者老破旧的ISO 7层模型，照样能对网络和路由配置如数家珍，他们的能力完全建立在实战的基础上。</p>

<p>让我们好好分析一下这个问题。</p>

<p>首先B的子网掩码配置决定了它和A不在一个子网上，我们在书本上学到的知识，如果两台机器不在一个子网上，能够通信吗？</p>

<p>哈，如果死读书不实践的人肯定会说:不能通信，不在一个子网嘛。</p>

<p>那么我们照这个逻辑，公司里岂不是不同子网的机器老死不相往来了？</p>

<h4>看吧，这是第一个陷阱，两台机器跨子网能否通信，取决于网关。</h4>

<p>如果没有网关服务器，或者网关服务器限制的话，肯定是不能通信的，虽然A和B物理上处于同一个子网，但是这个时候可以看成有一道防火墙在两台机器之间。</p>

<h4>其实大部分网络管理员都会把网关设置为不同子网间相互转发的，不然一个公司各部门间的机器不能互访，岂不是很悲剧。</h4>

<p>那么在网关能正常转发的情况下，我们来脑补一下两个场景，B访问A，A访问B的具体过程。</p>

<h4>B Ping => A</h4>

<ol>
<li>B首先检查到A和它不在一个子网，这个时候它需要网关来转发数据包</li>
<li>B发一个网关IP的ARP请求</li>
<li>网关(192.168.26.2) 回复B的ARP请求，告诉它俺的MAC 地址是XXX</li>
<li>有了网关的MAC，B就可以直接发包给网关了，它告诉网关，我要你帮我转发包给A</li>
<li>如果网关没有限制的话，它就会把包转发给A</li>
<li>A收到B的请求，他就会问，这个B是谁呀？A检查一番，发现B和自己在一个子网</li>
<li>既然一个子网，那么A就不会走网关了，它直接发出ARP请求在以太网上广播，谁是B呀，MAC地址回我一个</li>
<li>B在物理上实际上是和A在一起的，所以直接响应A，俺的MAC地址是这个</li>
<li>A收到B的ARP响应，就很HAPPY的跳过网关，直接给B响应包啦</li>
<li>这样的结果就是B发给A的包需要走网关，A发给B的包直接广播到以太网上，由B直接接收</li>
<li>最终的效果就是B能和A正常通信，虽然B的通信绕了一点远路</li>
</ol>


<h4>A Ping => B</h4>

<p>这个过程其实跟上面一样，A发出ARP请求直接找到了B，所以A发包给B是不用走网关的，B的响应还要走网关。</p>

<p>怎么样，这么看看，是不是问题就很明晰了呢。大部分情况下(网关没有特殊配置)，A和B是能够正常通信的。</p>

<p>有点小得意的说，这个问题我很快就反应过来了；因为我和作者一样是野路子出家，实战瞎鼓捣过，所以这类小Case恰好是尝过的菜。</p>

<p>咳咳，真是有点自吹自擂了；其实绝大多数网络问题最后找到原因都很简单，但是当一个大型的网络里面发生诡异的情况时，能迅速定位问题点是很不容易的。我又回想起来之前工作时，在一个客户现场遇到的坑。</p>

<h4>很久很久以前~~~</h4>

<p>咳咳，其实也不是多久，但那个时候我已经工作挺长时间了，虽然没有经过什么系统理论培训，但是靠着大量野路子实践，我觉得也算是见过很多网络万年坑了，我去客户现场从来不怵头，但就是那一次，差点阴沟里翻船~~</p>

<p>我去国内的某家大型券商部署项目，那家券商真是壕啊，从服务器到网络设备都是定制的特别高端的一批货，然后我熟门熟路的安装好Centos7.1，他们的系统管理员按照内部规定，做了安全防护之后，我们从他们的顶层小机房转移到操作办公室，准备部署应用软件。</p>

<p>这家券商的网络大部分已经迁移到SDN上面，办公室的终端机器经过两层跳板，跳到一个云主机的shell上面，然后再远程ssh连接到我们刚刚装好的服务器上，准备大展拳脚~~~~</p>

<p>根据故事的发展，这个时候就出现了诡异的事情，随机过20~40分钟后，我们的ssh连接就会卡一段时间，然后有几率断掉，之前所有工作都是正常的，而且有时候能正常个1小时，但是最后总是会开始卡。</p>

<p>唉，网络卡死，网络时不时断掉，真的是现场网络工程师人生中的一大悲剧，这类问题感觉天天遇见，但是总是没有一个固定的套路去解决它。</p>

<p>我们的终端机经过了两重跳板，然后ssh客户端和服务器之间，还有一个庞大的网络拓扑，跋山涉水十万八千里才能相见，然后就被某个不知名的幽灵生生拆散了，想象他们艰难的会师路径，我不禁打个冷颤。</p>

<h4>肯定不能先去怀疑他们的会师历程，我们先去查找最简单的，也是最容易出错的部分，就是服务端的sshd配置</h4>

<p>因为安装完系统后，客户的管理员根据他们的安全管理条例，运行了自己开发一个脚本进行了系统加固，很自然的，我们怀疑这个脚本是不是有什么地方配置不对，导致问题</p>

<p>在对服务器配置文件和脚本代码详细检查之后，我失望的判定，人家的脚本没问题</p>

<h4>配置没有问题，那就看看是不是ssh终端软件有问题呢</h4>

<p>我反复使用ssh登陆不同的服务器，惊奇的发现，凡是登陆我们刚安装好的这批服务器，就会时不时断掉，其它服务器就没有问题；
但是悲剧的是我们的服务器所在的机房，没有其它测试机，所以只能证明ssh终端软件没问题</p>

<h4>不到万不得已，我是不想怀疑中间庞大的网络路径的，谁知道是不是什么抽风的防火墙规则呢</h4>

<h4>我抱着笔记本，跑到楼上服务器的小机房直联看看，发现直联好得很</h4>

<p>现在说起来简单，其实跑一趟机房需要审批、内部人员带路一堆手续，累的客户跟我上上下下，验证一次需要1个小时以上，而且重现时间是随机的，这就是一线人员苦逼的地方啊。</p>

<h4>看起来一切都导向那个我最不愿意看到的结果，好像是通信中间有个什么诡异的防火墙规则之类的~~，但是这么庞大的网络拓扑，怎么定位问题呢？</h4>

<h4>到了此时，客户不再纠结于安全管理条例，我们小心翼翼的祭出了·抓包·这个手段</h4>

<ul>
<li><p>不到万不得已，其实大家都不想抓包的；金融行业的客户群，重视安全问题甚于生命，所以能在生产环境中让你抓包，其实已经是皇恩浩荡了。</p></li>
<li><p>经过了几十分钟苦苦等待，终于问题又重现了，我们小心翼翼的把抓到的包存到本地，用wireshark打开，像欣赏小电影一样仔仔细细~~~</p></li>
<li><p>果然有问题，那台服务器的ARP响应包里面，MAC地址竟然会变！</p></li>
<li><p>奇哉怪哉，我们刚配好这台服务器，怎么就让人ARP欺骗了呢？而且如果是他们的网络里面有ARP病毒，为啥就只找我们的服务器呢？</p></li>
</ul>


<h4>当时已经从早上折腾到下午3点种左右，虽然有了重大发现，但是也有了更大的迷惑</h4>

<p>突然我灵光一闪，服务器接了两根网线，一根是管理口为了方便管理，这个一直没有动过，会不会是~~~</p>

<p>我立马报着笔记本和一台小交换机跑上楼去</p>

<h4>将服务器和笔记本通过一台小交换机联到一个小局域网络中，再抓包发现了真相</h4>

<p>这台定制的服务器是浪潮提供的，而浪潮的管理口有个奇怪的设定，它和服务器上的多个网卡被绑定成一个NIC Teaming，类型为Transmit Load Balancing（TLB）。TLB的特点就是收包工作只由一个网卡负责，发包工作则分摊给所有网卡，但是管理口的默认配置有问题，有时候莫名其妙会共享同一个IP，回应ARP请求的时候把自己的MAC地址发回去，但是系统中管理口是没有配置的，所以这台服务器莫名其妙就自己变成了一台ARP欺骗源。</p>

<p>问题定位了，我们打电话找浪潮的供应商；供应商也非常奇怪，表明是第一次碰到这种问题，可能是由于定制的机器，考虑不周导致的。</p>

<p>然后我们的解决方法就是，将笔记本直联服务器，在笔记本上运行一个DHCP 服务，这样管理口在开机的时候会被分配一个IP地址，我们再通过这个IP地址登陆服务器管理界面，配置一个静态IP，就OK了。</p>

<p>虽然最后是一个简单至极的ARP欺骗问题，但是发生在一个庞大的网络拓扑中，调试手段被限制，发生时间随机，楼上物理距离和安全条例导致你重现一次成本极为高昂，你还能·镇定自若，指挥谈笑间·吗，这是一次一波三折的排障经历啊。</p>

<p>我这么详细的回忆一次折腾的排障经历，是因为我在这本书里发现了作者和我一模一样的苦逼例子，在&lt;wireshark网络分析的艺术>这本书里，大家有兴趣可以自己去翻翻。</p>

<p>其实这两本书真可谓是作者的网络排障手记，因为我也有那么一段跑在一线的日子，读起来格外亲切。这就是一线工程师的日常啊。</p>

<p>曾经，我以为熟读&lt;TCP/IP详解>和&lt;Unix网络编程>就能成为无所不能的网络大拿；曾经，我以为独立实现一个网络协议栈就是开创天地的神邸；后来，我明白了，网络的海洋无穷无尽，虽然规则是死的，但是现实世界实在不可预测，也许下一分钟就会有一个匪夷所思的case来纠缠你，嘲笑你的妄自尊大。</p>

<p>在网络世界迈入SDN之际，我非常惶恐，因为我明白以我的智商，不可能成为什么·专家·了；我想，未来，可能只有在AWS或者Google Cloud浸淫数十年的人，才能小心翼翼的称自己为·真专家·；面对网络知识的变幻莫测，总有一种·生有涯，知无涯·的惶恐；我总是会感叹，网络这个东西实在是太神奇了，真不知道如何形容这份感觉，就是只有·神奇·来形容</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[黎曼猜想的证明会对加密货币产生影响吗?]]></title>
    <link href="https://happy123.me/blog/2018/09/26/li-man-cai-xiang-de-zheng-ming-hui-dui-jia-mi-huo-bi-chan-sheng-ying-xiang-ma/"/>
    <updated>2018-09-26T10:19:00+08:00</updated>
    <id>https://happy123.me/blog/2018/09/26/li-man-cai-xiang-de-zheng-ming-hui-dui-jia-mi-huo-bi-chan-sheng-ying-xiang-ma</id>
    <content type="html"><![CDATA[<p>当今资讯发达，娱乐界、学术界以及投机赌博界已然不分家了。</p>

<p>Michael Atiyah老爷子来一场数学报告，已然惊动众多娱乐媒体和赌徒大佬。老爷子的秀场视频在这里，快去瞻仰:</p>

<p><a href="https://www.youtube.com/watch?v=oe4Jo4i3w_w">https://www.youtube.com/watch?v=oe4Jo4i3w_w</a></p>

<p>为了跟上时代的步伐，民工也要求上进啊，只能又去填鸭科普了一下数学ABC。</p>

<!-- more -->


<h3>黎曼猜想是啥</h3>

<p>黎曼猜想起源于素数的研究。素数在自然数中是一种特别的数，它只能被1和自己整除。而且素数的个数是无限的。</p>

<p>素数如此特别，数学家们试图搞清楚如何判断一个数是素数。给你一个小的数，例如7，你很容易判断它是素数。但是当给你一个很大的数字时，判断一个数是否为素数，是需要方法的。由此产生了素数判定的算法。</p>

<p>为了更好地理解素数，数学家们在 19 世纪便不再尝试预测素数的精确位置，转而将素数的现象视为一个整体。这个预测素数分布规律的挑战吸引了众多大佬，包括我们的数学王子gauss，独行侠Selberg等等，最著名的还是Riemann hypothesis提出的黎曼猜想。这段历史可以参考卢昌海老师的<a href="https://www.changhai.org/articles/science/mathematics/riemann_hypothesis/index.php">科普文</a>。</p>

<p>黎曼1859年在他的论文《论小于已知数的素数个数》提出了这个著名的猜想，但它并非该论文的中心目的，他也没有试图给出证明。这个猜想描述如下:</p>

<p><img src="https://ws1.sinaimg.cn/large/893d6e9dly1fvmquq5a8ej211y04wgqb.jpg" alt="黎曼猜想" /></p>

<p>这个函数称之为黎曼 zeta 函数。黎曼给出了一个推测：黎曼 zeta 函数的所有非平凡零点可能都全部位于实部等于1/2的直线上。上述公式中的第二项，x 的 ρ 次幂的ρ就是黎曼 zeta 函数非平凡零点。</p>

<h4>简而言之，任意给定一个自然数x，通过这个公式能更精确的得出 x 以内素数的个数。</h4>

<p>那么这个公式是正确的吗，通过现在的计算机暴力计算，不能证伪，好像是正确的。但是也没有人能给出严格的证明，所以称之为是猜想。</p>

<h3>如果猜想被证明，对安全界有什么影响</h3>

<p>这又得从我们码农熟知的非对称加密算法开始说起了。众所周知，SSL/TLS(https)等一系列安全协议都是建立在RSA算法之上的，而RSA作为非对称加密算法的典型代表，又是建立在大素数分解的基础上的。这部分可以参考阮一峰老师的<a href="http://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html">科普文</a>。</p>

<p>那么黎曼猜想如果被证明，是不是意味着RSA算法就不再安全了呢？作为吃瓜群众，大可不必去跟风娱乐媒体，不需要多高深的数学知识就能自己来判断:</p>

<ol>
<li><p>黎曼猜想是在1859年提出的，虽然没人能证明，但是也没人能证伪，这说明这个方法作为一个判别素数个数分布的工具，已然被广泛运用多年了</p></li>
<li><p>非对称加密是在20世纪70年代末提出的，如果黎曼猜想能加速大素数分解的计算，那么其实1970s左右，RSA诞生之初，就已经面临重大威胁了</p></li>
<li><p>素数检测和整数分解是两回事，至今还没有人找到他们之间有何联系</p></li>
<li><p>如果素数的检测能加速分解计算的话，即使有某个人或某个组织掌握了这个技术，那么全世界的网络，包括各大银行、金融、政府组织，都会受到严重威胁；但是目前为止还没有啥迹象；</p></li>
</ol>


<h3>如果猜想被证明，对加密数字货币(如比特币)有什么影响</h3>

<p>我们知道，比特币的安全设计是远远领先于时代的，我们之前在<a href="https://happy123.me/blog/2018/04/24/cryptocurrency-security/">这篇文章</a>中，曾经谈到过比特币的地址安全问题。</p>

<ol>
<li><p>基本上所有加密货币的地址都是参考比特币，采用椭圆曲线非对称加密算法为基础生成的</p></li>
<li><p>椭圆曲线和RSA的套路完全不同，和素数分解也没啥关系，即使RSA被破解了，和比特币也是雷峰塔倒掉和学雷锋的关系&mdash;&mdash;就是没关系</p></li>
<li><p>大多数加密货币的挖矿采用了许多不同的单向散列(HASH)函数，目前理论来看，这基本上也和素数分布没啥关系</p></li>
</ol>


<h2>结论</h2>

<ol>
<li><p>黎曼猜想能不能成功证明、有没有人能理解这个证明还是两说</p></li>
<li><p>即使黎曼猜想不能被证明，它作为一个检测素数分布的工具使用已经好多年了，如果真的对基于素数分解的非对称加密算法有威胁，100多年了，早也应该暴雷了吧</p></li>
<li><p>即使RSA GAME OVER了，对于以椭圆曲线为基础的比特币等加密货币，没啥影响</p></li>
<li><p>估计娱乐媒体又要对中本聪一顿<code>先知</code>神吹了</p></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[自由交易创造财富?]]></title>
    <link href="https://happy123.me/blog/2018/09/12/zi-you-jiao-yi-chuang-zao-cai-fu/"/>
    <updated>2018-09-12T15:44:14+08:00</updated>
    <id>https://happy123.me/blog/2018/09/12/zi-you-jiao-yi-chuang-zao-cai-fu</id>
    <content type="html"><![CDATA[<p>有人调侃说，这世上有些事人人都觉得自己懂：音乐，政治，和经济。</p>

<!-- more -->


<p>看看股市里面各种股评家就知道了，感觉人人都是斯密再生，什么不可能三角，反身性，蓄水池，M0 M1 M2，做空美国，汇率战争&hellip;&hellip;纵论世界经济大势，舍我其谁。</p>

<p>作为一个财经盲，听到人家谈论这些话题的时候完全是一脸懵逼，智商失联；为了提高一点点可怜的交际能力，近期恶补一番《国富论》。</p>

<p>于是，我由文盲晋级到小白，Level+1。这里记录一下小白的瞎想：</p>

<h2>斯密全书反复强调的一个观点: 分工和自由交易可以创造巨大的财富</h2>

<h4>分工创造财富</h4>

<p>书中开篇就举了一个例子:</p>

<blockquote><p>以前一个工匠一天最多做几十枚铁钉。但是在一个现代化工厂中，一天则可以生产几万枚。之所以有如此大的提升，原因就是进行了细致的分工：</p>

<p>有的人负责把铁熔成铁水，有的人负责把铁水抽成铁丝，有的人负责把铁丝斩断，再有的人负责把铁丝磨尖，另外有人把头给打出来，这个流程每一个人都特别熟悉自己的哪一个非常小的环节。这种分工协作，让每个人都对自己的这一个环节特别熟悉，生产效率得到了上百倍的提高。</p></blockquote>

<p>斯密观察到了这种现象，专业分工可以极大的提高生产力、创造财富——这个结论在今天已经成为常常识，在中学的课本上我们就对其耳熟能详。</p>

<h4>自由交易创造财富</h4>

<p>交易创造财富呢？</p>

<p>这一听好像是非常违背常识的事情。我们的吃穿用度，都是劳动人民辛辛苦苦用汗水换来的，是生产活动创造了财富；</p>

<p>而交易，无非是投机倒把，更甚者，那些金融掮客们，不事生产，不辨菽麦，怎么能说他们创造财富呢？一批金融人士和股民集体中枪中&hellip;.</p>

<p>斯密先生是如何解释的呢？他在<code>分工创造财富</code>的基础上继续追问，是什么促成了专业分工这种生产方式？</p>

<blockquote><p>他进一步分析，得出结论：专业分工是基于庞大的、自由的市场交易。</p>

<p>一是市场得庞大，二是交易得自由：</p>

<p>如果在某一个闭塞的小地方建立一个工厂，每日生产几万颗铁钉，铁钉是卖不出去的，因为一个人一年只需要五六根——市场不够大。市场不够大，高密度的分工就不会出现。这就是资本主义国家总是想打开封闭国家的大门的原因。</p>

<p>市场够大了，但是如果交易不自由，被各种限制，也不行。当时的欧洲，还存在封建割据。商人要把一个东西从英国卖到德国去，中间要穿过几十个封建小国，过一个关，收一道税，“通关文牒”上密密麻麻盖满了章。而且有些产品还不让过，严重阻碍了交易自由。这样，高密度的分工也不会出现。</p>

<p>当时的欧洲，还流行封建行会制度：不能说你有技术，能做鞋，你就开店去做鞋了！得经过行会批准，否则就是非法经营，就砸你的店。而且工人也不能自由跳槽，你跟了一个师傅，就像拜师学艺，不能说这个师傅对你不好，你就另找一个师傅！那不行，那是违背“道德”的。</p>

<p>这种“道德”和封建制度的枷锁，对生产力的束缚是非常之大。</p>

<p>不只是普通商品需要自由交易，土地、资本、劳动力等生产要素，也都应该可以自由交易才行——交易自由是基本的人权。</p></blockquote>

<h4>&ldquo;交易&#8221;在大部分人的直觉中，只是转移、交换，财富是不会增加的。其中的秘密是什么呢？</h4>

<p>斯密提出了一个非常著名的悖论：</p>

<blockquote><p>空气和水对于我们非常重要，却几乎是免费的，黄金钻石属于非必需品，没有它也能照样生活，却贵得要死。</p></blockquote>

<p>衣服比较需要，价格比较便宜，汽车不一定需要，价格相当昂贵。你会发现越是你不需要的东西，价格越贵。</p>

<p>为什么会这样？</p>

<p>斯密想：是什么决定了物品的价值？</p>

<p>他开创性地提出了使用价值（用值）和交换价值（换值）的概念：用值高的东西，换值可能很低，用值低的东西，换值可能很高。</p>

<p>后来有了&#8221;边际&#8221;概念之后，后人发现，换值其实就是边际用值。</p>

<p>水的用值非常高，但在喝了5杯水之后，再多喝一杯的用值则非常低了，喝到你不想再多喝一口！其边际用值非常低。</p>

<ul>
<li><p>一只画笔，在放羊娃的手里一钱不值，但到了齐白石手中，丹青妙笔下的画卷价值万金；</p></li>
<li><p>一亩鱼塘，游牧民族不屑一顾，江南农民眼里可能就千金不换；</p></li>
</ul>


<p>而这些资源，天分是老天爷随机配比的，每个人都不可能生下来物尽其用、才尽其用、各得其所；更何况一个人的境遇、天然的环境是时时变化的，齐白石也可能拿不动笔，骑马的汉子也可能会娶江南的姑娘，他也需要一亩鱼塘来养家糊口；于是便产生了交易；</p>

<p>财富的本质，源于&#8221;资源的有效配置&#8221;，就是有效的交易；资源可以是自然资源、天分、知识、美貌等等一切有人看重的东西；</p>

<p>当交易无时无刻不在发生，那么价值就无时无刻不在创造。</p>

<p>交易创造财富！</p>

<p>这种自由交易的机制，不需要有人去刻意安排，也不需要刻意维持和鼓励。只要你不去人为地打压，它就会如野草般自己生长。</p>

<p>原因何在呢？斯密先生的解释是：</p>

<blockquote><p>很多时候，一个人会需要兄弟朋友的帮助，但假如他真的要依靠他们的仁慈之心，他将会失望。倘若在需求中他能引起对方的利己之心，从而证明帮助他人是对自己有益的事，那么这个人的成功机会较大。任何人向他人提出任何形式的交易建议，都是这样想：给我所需要的，我就会给你所需要的——这是每一个交易建议的含义；而我们从这种互利的办法中，所获的会比我们所需的更多。我们的晚餐可不是得自屠夫、酿酒商人，或面包师傅的仁慈之心，而是因为他们对自己的利益特别关注。我们认为他们给我们供应，并非行善，而是为了他们的自利。</p>

<p>所以，每个人都会尽其所能，运用自己的资本来争取最大的利益。一般而言，他不会意图为公众服务，也不自知对社会有什么贡献。他关心的仅是自己的安全、自己的利益。但如此一来，他就好像被一只无形之手引领，在不自觉中对社会的改进尽力而为。在一般的情形下，一个人为求私利而无心对社会作出贡献，其对社会的贡献远比有意图作出的更大。</p></blockquote>

<p>这样看来，一个有意思的推论就产生了：</p>

<h4>某些财富可能不过是一种幻觉！！</h4>

<p>我们所看重的东西，所谓的财富，不管是我们的衣食住行实实在在的实物，还是音乐文学绘画等等精神产品，建立的基础是人们的需求。而人们的需求并不是万古不变的:</p>

<p>比如美学产品，很难说几千年后毕加索的作品会有何种评价；或者科幻一点，将来有了可飞行的汽车，市中心的房子能有多大市场&hellip;&hellip;</p>

<p>说的更唯心一点，劳动人民不过是在一种精神层面需求的驱动下生产的，财富的第一创造驱动力来自于交易。</p>

<p>D(t) > 0；交易创造财富；</p>

<p>简明版本的解释就是：</p>

<ul>
<li><p>人们喜欢吃梨子和苹果，于是培育了果树</p></li>
<li><p>我喜欢吃梨，但是家里只有苹果树；你喜欢吃苹果，家里只有梨树</p></li>
<li><p>我拿苹果换梨子，需求满足++，创造了财富</p></li>
</ul>


<h4>为什么会有人限制苹果换梨子</h4>

<p>既然自由的市场是最好的，为什么政府还会有种种管制行为呢？为什么还会有贸易战呢？再进一步，为什么需要政府插手经济呢？</p>

<ul>
<li>自由市场是会崩溃的。</li>
</ul>


<blockquote><p>16世纪后期的荷兰，出现了发达的商业贸易。但也是商业贸易，促成了“郁金香泡沫”的爆发，这是有史记载的第一次金融泡沫。</p>

<p>从16世纪中期到17世纪初期，人们逐渐对郁金香产生了狂热。一些郁金香珍品被卖到了不同寻常的高价，富人们竞相在他们的花园中展示稀有的品种。1635年，一种叫Childer的郁金香品种单株卖到了1615弗罗林（florins，荷兰货币）。一株这玩意，就能换3头公牛。第二年，一株稀有品种的郁金香（当时荷兰全境只有两株）卖到了4600弗罗林的价格，除此之外，购买者还需要支付一辆崭新的马车、两匹灰马和一套完整的马具。</p>

<p>但是，所有的金融泡沫，正如它们在现实世界中的名字所喻示的那样脆弱。这个因为自由交易而导致的泡沫，最终崩溃了。</p></blockquote>

<p>正常交易创造了财富值100，人的贪婪本性注定了有人想要攫取财富值1000；于是有了欺诈和恐惧，于是有了管制；国家也是一样的，总有一些国家更加贪婪，或者说每个国家都会更加贪婪，它们之间也会有恐惧和欺诈，于是诞生了贸易战。</p>

<ul>
<li>自由交易的市场能创造出一切东西，唯独不能创造市场本身</li>
</ul>


<p>一个公平的环境需要信用，目前为止，人类历史更迭，尝试了无数种办法，能维系信用的唯有<code>暴力</code>；这促成了国家的诞生。国家一定要用暴力来维护市场。</p>

<p>人类财富的创造源泉，最终由<code>交易</code>推导到了<code>信用</code></p>

<h2>让我们谈谈区块链(blockchain)吧</h2>

<p>我是非常不愿对这个东西夸夸其谈的，因为卷入这个场子的人，在我看来，就像美国大淘金时代一样，小偷、骗子、强盗实在太多。</p>

<p>好吧，我也一样，自以为悟到了一些东西就来夸夸其谈，大家当成笑料听听就好，不用当真。</p>

<h4>区块链是人类历史上第一次找到了这样一种工具：它维系市场，超乎暴力之上</h4>

<p>区块链是信用的承载。让我们这样想象：</p>

<p>来源于名为<code>Bitcoin</code>的信用之水，得益于早期信徒的开采维护，汇集成了一条小溪汩汩向东流去；</p>

<p>一路上有更多的信徒创造更多的信用，合力汇集为一条名为<code>blockchain</code>的大河，滚滚东流；</p>

<p>这条大河是最终到达信用之海，创造出一个超出暴力之上的信用汇集而成的新市场；还是因为没有更多的信用注入，逐渐干涸为沼泽，沦为一个庞氏骗局，没有人能预言。</p>

<p>不过可以这样推想，信用是个很神奇的东西：它无法定量计算，但是社会上产生的信用多寡又是如此明显；人人都知道一个正直的人创造的信用值肯定大于一个骗子；同理，同样的人口，一个民风淳朴的国家创造的信用肯定大于索马里人民的信用值；</p>

<p>最神奇的，一个人可以创造的信用没有明显的上限；信用也可以由一代代的人无限创造；相对的，信用也可能不断损耗，最终趋近于0。</p>

<p>我们所景仰的奥马哈先知曾多次强调：比特币是老鼠药的平方。</p>

<p>当区块链上承载的信用量不再增加的时候，就是一朵郁金香。奥马哈的先知此时是对的。</p>

<p>当区块链上承载的信用无限增加的时候，就是永不终结的市场。当然这个概率有多少，没人能预测。</p>

<h4>回到未来</h4>

<p>让我们掏出水晶球，冒险预言一下blockchain的未来：</p>

<ul>
<li>初期</li>
</ul>


<p>就像早期大淘金时代一样，这个市场会充斥骗子、小偷、强盗、投机家，以及一些英雄人物；但还是摆脱不了<code>庞氏骗局</code>的帽子</p>

<p>正如我们前面所强调了，区块链是一条信用之链，而且目前维护这样一条链的代价及其昂贵；</p>

<p>既然是如此金贵的资源，那么最初利用它做什么呢？有什么东西是信息量无限小，价格无限大呢？</p>

<p>我们把能想到的领域排排坐：</p>

<p>1.铸币权</p>

<p>2.投机博彩传销</p>

<p>3.洗钱</p>

<p>4.黑市</p>

<p>5.国际汇款</p>

<p>6.券商承兑，金融产品</p>

<p>7.法律公证等等一切需要用到公章的地方</p>

<p>8.版权、数字营销、保险、电子证据、物联网、供应链、积分共享、征信、公益、游戏道具等等PPT概念产品</p>

<p>9.工业能源政务医疗衣食住行阿猫阿狗等等忽悠</p>

<p>&hellip;&hellip;</p>

<p>目前占大头的应用是什么呢？上面的诸家应用能在什么阶段落地呢？</p>

<p>是不是看出来有些东西永远不能落地，为什么呢？</p>

<p>大家自有分辨。</p>

<ul>
<li>早期</li>
</ul>


<p>一个国家金融业完善发达，一个国家还处于一穷二白，谁更需要所谓的数字货币，所谓的区块链呢？</p>

<p>与直觉相反，我认为将来比特币会在中东这种政治动荡之地，拉美这种经济动荡之地，非洲这种一穷二白之地发挥巨大作用；</p>

<p>对于其它经济体，肯定会抵制、再抵制，直到无可奈何，开一道小口子，让其在外贸领域有点活命的机会；或者说，比特币是永远不能登上主流舞台的，它只能跟投机、黑市、国家破产等等联系在一起。</p>

<p>那是不是说，这个技术就没有前途呢？就等着各国纷纷禁止，然后戳破泡沫，价格归零呢？</p>

<ul>
<li>中期</li>
</ul>


<p>不是的，它是一项非常非常危险的创造，潘多拉魔盒一旦打开，无法关闭。数字货币的生命力可能会超过许多国家的寿命，成为新时代的黄金，但是是一种不能为国家所容忍的黄金。</p>

<p>所以，这个泡沫会 破灭->复兴->破灭，不断的循环下去，投身于其中的人会越来越多；</p>

<p>这是一个泡沫，但是可能会持续几十年甚至超过国家的寿命，也可能一夜归零后，等待几年甚至几十年才能有下次复兴；</p>

<p>blockchain本质上是一项跟国家抢夺铸币权、抢夺信用定价权的技术，它从根本上动摇了国家的根基，所以可能会出现绝大多数国家联起手来，共同封杀这项技术的一天。</p>

<ul>
<li><p>后期</p>

<ul>
<li><p>究竟是人类的贪婪占据上风，信用之河就此干涸成为沼泽，最终作为最大的郁金香泡沫永载史册呢?</p></li>
<li><p>还是一小撮信徒自诩为摩西，或者卫星上天，或者公海游弋，或者开疆裂土，建立一个信用自由港呢？</p></li>
<li><p>还是开天辟地，超脱国家和暴力，成立一个新的信用市场呢？</p></li>
</ul>
</li>
</ul>


<h4>唯有时间能给出答案。</h4>

<hr />

<p>PS: 神遭遭瞎扯了这么多，其实我是被Bitcoin Core的闪电网络的代码搞烦了，我怎么也理解不了；</p>

<p>理解不了的东西让我对他的安全性产生重大怀疑，我能创造的的信用值直线下降；</p>

<p>市场动荡之际，我投入BCH阵营了；好吧，这一次我是个投机者了，Maybe将来很悲惨，所以回到未来记下这一惨痛投机教训。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[The History of X86]]></title>
    <link href="https://happy123.me/blog/2018/09/12/the-history-of-x86/"/>
    <updated>2018-09-12T10:22:01+08:00</updated>
    <id>https://happy123.me/blog/2018/09/12/the-history-of-x86</id>
    <content type="html"><![CDATA[<p>我们平时老看到<code>X86指令集</code>, <code>X86架构</code>等等词汇，很容易就猜到这个86来源于Intel那款名动天下的处理器&mdash;8086，那么8086的名字又是怎么来的呢？</p>

<!-- more -->


<p>这是一个遥远的传说，各种解释众说纷纭，挑两个有说服力的段子吧:</p>

<h4>说法1</h4>

<p>当intel发明第一颗4位的位处理器的时候，intel把他叫4004。在当时，intel也没有意识到这就是微处理器，（微处理器是后来人的说法），intel当时只是给做手持计算器的厂家来定制处理器。</p>

<p>因为4004的指令集很有限，所以又搞出来了一个升级版本4040。</p>

<p>8008是4004的8位版，8080是4040的8位版。</p>

<p>8085是8080的单5伏电压版。</p>

<p>8085升级到16位后，就叫8086了。</p>

<p>嗯，还是很有逻辑的。</p>

<h4>说法2</h4>

<p>微处理器是在70年代末发明的。 接近80年，所以，前两个数字就是这么来的;</p>

<p>当时微处理器是8位的，因此，第3个数字是8;</p>

<p>在8085和8086 cpu之前，8080处理器是需要+5-5和12v电压来工作。 随着技术的进步，只需要单一的5v供电了，因此，最后一个数字是5;</p>

<p>8085升级到16位后，就叫8086了;</p>

<p>好吧，也说得通。</p>

<h4>不管怎么说，反正Intel推出的8086在历史上的经典地位不容置疑；那我们来简单回顾一下Intel CPU发展的历史吧</h4>

<ul>
<li><p>20世纪70年代末，Intel生产了著名的16位8086处理器，之后又推出了80186与80286；</p></li>
<li><p>1985年，Intel继摩托罗拉之后，第二个研制出32位的微处理器80386；</p></li>
<li><p>8086、80286、80386等等，这一系列CPU就称作x86，正式一点称作IA-32（Intel Architecture 32-bit）。正是这个架构开启了Intel在个人PC CPU领域的无敌之路，后来的操作系统、编译器、应用软件无一不是把<code>适配X86指令</code>作为核心竞争力；</p></li>
<li><p>1989年，Intel推出80486处理器，具有浮点运算功能；</p></li>
<li><p>因为当初与Intel竞争微处理器的摩托罗拉公司是以86开头的，如68000，68010，68020，而且AMD也崭露头角，他们也搞出来AM386，AM486等等，令Intel不胜其烦；而当时的法律不允许将数字注册为商标，于是1993年，Intel推出奔腾(Pentium)处理器，不再以数字命名其产品；Pentium刚刚推出的时候，命名及其混乱，有人叫I586，有人叫P5，有人叫PI，还有人叫奔腾的芯，更别提什么梦幻神器，裸奔天下等等搞笑名词了~~不管怎么说，那时候伴随我们记忆的不只是Pentium这个名字，还有那个经典的&#8221;等等等你等&#8221;的广告音乐，Intel又凭借Pentium这个架构继续无敌并寂寞着</p></li>
<li><p>在Pentium时代，其实AMD也不是毫无作为，老一代DIY玩家们一定还对Athlon K7的传说记忆犹新，尤其是当时那些拉风的译名，什么&#8221;速龙&#8221;、&#8221;毒龙&#8221;、&#8221;钻龙&#8221;等等，我得说，这个时期的农企实在是很时髦，远远不像他们后来的市场部那么傻13</p></li>
<li><p>当然，当时最璀璨的舞者，我只献给活在DIYer心里那个最美好的名字&mdash;图拉丁赛扬；正是这款CPU成为了许多人的电脑时代的启蒙者</p></li>
<li><p>2001年开始，Intel将用于服务器以及工作站的Pentium 4 Xeon独立成全新的品牌“Xeon”（至强）)；正如这个名字所蕴含的霸气一样，这个品牌延续到了今天</p></li>
<li><p>2006年，Intel发布“Core”（酷睿）品牌，用作英特尔的旗舰级处理器系列的新品品牌； 然后，这个品牌经历了数代架构更迭，一直伴随我们到了今天</p></li>
<li><p>同样的，围绕指令集从32位跃迁到64位的过程中，AMD和Interl在这段时间还爆发了一场惊天缠斗；Intel作为CPU市场的领跑者，觉得自己理应主导32位到64位时代跃进的浪潮；早在Pentium时代，他们就制定了Intel 64计划；然而，由于一个大公司内部的种种政治斗争，市场斗争，人的本性里面悲剧的傲慢，这个过程种出现了种种败着昏棋，最终AMD64架构在IA-32上新增了64位寄存器，并兼容早期的16位和32位软件，可使现有以x86为对象的编译器容易转为AMD64版本，在2003年9月推出了AMD64；在64位时代由追随者变成领跑者</p></li>
<li><p>Intel此时如梦方醒，慌忙将AMD的指令集拿过来稍作加工推出自己的兼容产品；然后就是两个公司营销和市场人员、法律人员旷日持久的撕逼大战；中间诞生了许许多多匪夷所思的营销名词，比如A64, I64, IA32E，iAMD64，Intel64，X86-64等等等等；如果你是一个Linux爱好者，很容易看到各个软件包都会注明Amd64, X86_64等等，这是那场混乱大战的遗留物</p></li>
</ul>


<h4>总结一下现在的主流</h4>

<ul>
<li><p>32/64 位系统编译在32位系统上运行 => x86</p></li>
<li><p>32 系统上编译64位系统上运行 => x86_amd64</p></li>
<li><p>64 系统上编译在64位系统上运行 => amd64</p></li>
</ul>


<h4>看看MSDN的解释:</h4>

<blockquote><p>The following list describes the various versions of cl.exe (the Visual C++ compiler):</p>

<p>x86 on x86
Allows you to create output files for x86 machines. This version of cl.exe runs as a 32-bit process, native on an x86 machine and under WOW64 on a 64-bit Widows operating system.
Itanium on x86 (Itanium cross-compiler)
Allows you to create output files for Itanium. This version of cl.exe runs as a 32-bit process, native on an x86 machine and under WOW64 on a 64-bit Widows operating system.</p>

<p>x64 on x86 (x64 cross-compiler)
Allows you to create output files for x64. This version of cl.exe runs as a 32-bit process, native on an x86 machine and under WOW64 on a 64-bit Widows operating system.</p>

<p>Itanium on Itanium
Allows you to create output files for Itanium. This version of cl.exe runs as a native process on an Itanium machine.</p>

<p>x64 on x64
Allows you to create output files for x64. This version of cl.exe runs as a native process on an x64 machine.</p></blockquote>

<h4>总之CPU的历史生动说明了了计算机界的很多老梗是如何诞生的，比如很多人都疑惑为什么Windows的发布名称是Win95->W98->W98SE->Win2000(NT)&ndash;>WinXP->Vista->Win7->Win10，等等等等；这种现象是商业环境、市场营销、法律风险以及随意拍脑门的高管，放荡不羁的开发团队合力促成的~~~</h4>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[The Minimum Fee of Bitcoin Transaction]]></title>
    <link href="https://happy123.me/blog/2018/09/11/the-minimum-fee-of-bitcoin-transaction/"/>
    <updated>2018-09-11T15:13:35+08:00</updated>
    <id>https://happy123.me/blog/2018/09/11/the-minimum-fee-of-bitcoin-transaction</id>
    <content type="html"><![CDATA[<p>昨天看到地球人都知道的1号地址转了<a href="https://btc.com/b9a6f0b287646c30bdafa08cc997d7af93ca20eb7b2d09084ddf7a7a075394b2">0.00000555个币进来</a>，也不知道是谁在做测试，恶作剧心起，遂想要转掉这点娱乐币。</p>

<p>默认Bitcoin Core 0.15之后的客户端貌似都不能调节transaction fee大小了，老实说，自从Segwit升级完毕之后，我很少用core钱包了。这次没办法，为了构造一笔最小手续费用的交易，采取如下动作:</p>

<!-- more -->


<p>1.先看一下vout和txid:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bitcoin-cli listunspent 0 9999999 "[\"12AKRNHpFhDSBDD9rSn74VAzZSL3774PxQ\"]"</span></code></pre></td></tr></table></div></figure>


<p>输出里面找到 <code>12AKRNHpFhDSBDD9rSn74VAzZSL3774PxQ</code>的vout为0， txid是<code>b9a6f0b287646c30bdafa08cc997d7af93ca20eb7b2d09084ddf7a7a075394b2</code></p>

<p>2.创建转账交易</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bitcoin-cli createrawtransaction "[{\"txid\":\"b9a6f0b287646c30bdafa08cc997d7af93ca20eb7b2d09084ddf7a7a075394b2\",\"vout\":0}]" "{\"1HB1Efu8RkEpxzTHYd1E7NgdimL1ddDhkR\":0.0000055}"</span></code></pre></td></tr></table></div></figure>


<p>得到十六进制输出</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>0200000001b29453077a7adf4d08092d7beb20ca93afd797c98ca0afbd306c6487b2f0a6b90000000000ffffffff0126020000000000001976a914b1665e71006dbfbabb69cbcdc5717b11abdb89e888ac00000000</span></code></pre></td></tr></table></div></figure>


<p>3.签名之</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bitcoin-cli signrawtransaction  "0200000001b29453077a7adf4d08092d7beb20ca93afd797c98ca0afbd306c6487b2f0a6b90000000000ffffffff0126020000000000001976a914b1665e71006dbfbabb69cbcdc5717b11abdb89e888ac00000000"</span></code></pre></td></tr></table></div></figure>


<p>得到十六进制输出</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{
</span><span class='line'>  "hex": "0200000001b29453077a7adf4d08092d7beb20ca93afd797c98ca0afbd306c6487b2f0a6b9000000008a47304402202a51aa8eb0593a4b48880712c3ee70b7d6ca74ed313ef93e9c92489616587a2c022048c87fde75761e2a9cc9fef7dc8d0d9961ef1df89e22f88e5e3902567ec956f8014104fdf4907810a9f5d9462a1ae09feee5ab205d32798b0ffcc379442021f84c5bbfc891eb16b0faef4bef99ba6d522fb85470a20df730808e583778aa35c7af98f5ffffffff0126020000000000001976a914b1665e71006dbfbabb69cbcdc5717b11abdb89e888ac00000000",
</span><span class='line'>  "complete": true
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>4.激动人心的时刻来了，广播之:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bitcoin-cli sendrawtransaction  "0200000001b29453077a7adf4d08092d7beb20ca93afd797c98ca0afbd306c6487b2f0a6b9000000008a47304402202a51aa8eb0593a4b48880712c3ee70b7d6ca74ed313ef93e9c92489616587a2c022048c87fde75761e2a9cc9fef7dc8d0d9961ef1df89e22f88e5e3902567ec956f8014104fdf4907810a9f5d9462a1ae09feee5ab205d32798b0ffcc379442021f84c5bbfc891eb16b0faef4bef99ba6d522fb85470a20df730808e583778aa35c7af98f5ffffffff0126020000000000001976a914b1665e71006dbfbabb69cbcdc5717b11abdb89e888ac00000000"</span></code></pre></td></tr></table></div></figure>


<p>然后得到报错:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>error message:
</span><span class='line'>66: min relay fee not met</span></code></pre></td></tr></table></div></figure>


<p>喵喵喵，怎么回事，我记得2016年的时候还是允许0.00000001的手续费的，比如下面这笔交易:</p>

<p><a href="https://blockchain.info/tx/d36a18d1fa4c6ccc4b90ab8a13dd3e55b396ac07bf7fbbee281c1025da2b86fc">https://blockchain.info/tx/d36a18d1fa4c6ccc4b90ab8a13dd3e55b396ac07bf7fbbee281c1025da2b86fc</a></p>

<p>5.没办法，我只能在createrawtransaction的时候手工指定手续费为0.000001，心痛啊，手续费是转账金额的20%~</p>

<p>然后又得到了这个错:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mempool min fee not met</span></code></pre></td></tr></table></div></figure>


<p>怒了，又去翻了一下代码，还是由mempoolminfee 决定的啊，执行:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bitcoin-cli getmempoolinfo</span></code></pre></td></tr></table></div></figure>


<p>现在是够的啊，搞不明白了；不行，再等别人就转走了，得争分夺秒啊2333</p>

<p>6.只能去找几个大矿池在线广播了，我无奈的先后使用了:</p>

<p><a href="https://btc.com/tools/tx/publish">https://btc.com/tools/tx/publish</a></p>

<p><a href="https://www.blockchain.com/btc/pushtx">https://www.blockchain.com/btc/pushtx</a></p>

<p><a href="https://live.blockcypher.com/btc/pushtx/">https://live.blockcypher.com/btc/pushtx/</a></p>

<p>统统失败，悲剧了；还测试出blockcypher有个500，它的后台没处理好，直接就挂掉了；btc.com是个鬼精灵，把所有的异常一把抓，就不告诉你出了啥错；值得表扬的是blockchain.info，完美显示了bitcoin core抛出的错误，嗯嗯嗯，记住，以后可以用极小值的手续费广播来测试这几个网站的后台bitcoind 实现版本，不要干坏事哦~~</p>

<p>7.万般无奈之下我将手续费用继续提高为0.000002，然后得到下面的报错:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dust transaction</span></code></pre></td></tr></table></div></figure>


<p>一顿google之下发现0.15版本以后，bitcoin core的<a href="https://bitcoin.stackexchange.com/questions/10986/what-is-meant-by-bitcoin-dust">dust判定标准是546 satoshins</a>，这笔交易的金额正好处于这么一个微妙的位置。</p>

<p>8.一通操作之后，发现这笔钱是无论如何不能立即拿出来了；于是写个脚本暴力广播之，总有mempool size下来的时候吧，我幻想着，说不定能中奖呢23333</p>

<h4>结局</h4>

<p>昨晚有个土豪加上另外一个vout提走了，额，为了提0.00000555BTC，土豪动用了88BTC的vout作为陪练，并留下了0.00000400(高达90%) 的矿工费，交易记录在此:</p>

<p><a href="https://btc.com/d6d59802eb987fe96b9e827c07a1acff5e80ba5e9dae3f6f56f9ea427d98e585">https://btc.com/d6d59802eb987fe96b9e827c07a1acff5e80ba5e9dae3f6f56f9ea427d98e585</a></p>

<p>土豪，是在下输了。</p>

<p>这件事情挺有意思的，我相信还有很多自动机器人在hunter这几个大众抽奖地址，为了不到1分钱，真是<code>一通操作猛如虎，回头一看啥没有</code>。而且中间还有一笔流入，我放过了；作为傻逼的记录，我老老实实记一下。</p>

<p>现在minimum fee的行情是0.00001/KB，下次我得记好了，方便抽奖。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[云计算的诞生]]></title>
    <link href="https://happy123.me/blog/2018/09/10/yun-ji-suan-de-dan-sheng/"/>
    <updated>2018-09-10T13:39:29+08:00</updated>
    <id>https://happy123.me/blog/2018/09/10/yun-ji-suan-de-dan-sheng</id>
    <content type="html"><![CDATA[<p>有一个很经典的问题: java和javascript是什么关系？</p>

<p>然后小伙伴们是这样回答的:</p>

<!-- more -->


<ul>
<li><p>人民政府和为人民服务的关系</p></li>
<li><p>对象和对象的关系&hellip;</p></li>
<li><p>老婆和老婆饼的关系</p></li>
<li><p>苹果和苹果手机的关系</p></li>
<li><p>卡巴斯基和巴基斯坦的关系</p></li>
<li><p>印度和印度尼西亚的关系</p></li>
<li><p>黑客和博客的关系</p></li>
<li><p>北大和北大青鸟的关系</p></li>
<li><p>dog和hotdog的关系</p></li>
<li><p>人民和人民大会堂的关系</p></li>
<li><p>天真和天真热的关系</p></li>
<li><p>梁山和梁山伯的关系</p></li>
</ul>


<p>&hellip;&hellip;</p>

<p>怎么样，同志你是不是对他们的关系有了更深入的了解呢？</p>

<p>我只能说，在计算机工程领域，话语权没有掌握在傻写代码的码农手里，他们顶多就是个苦力外包民工；真正主导一门技术发展的，是天才的营销人员，尤其是：擅长起华丽的名字的那波人。</p>

<p>来来来，这只是一个引子，让我们来唠唠一个非常非常火爆的科技名词，只要这个词从你嘴里说出来，立马就能将你加成为<code>拳打比尔盖茨，脚踢苹果谷歌</code>的霸道总裁，引起台下众人的谜之膜拜。&mdash; 云计算(Cloud Computing)</p>

<p>不过，这个词是怎么来的呢？</p>

<h4>懵懂岁月</h4>

<p>云计算和Cloud Computing这个词原本在中文和英文中，都是不存在的。Cloud Computing作为一个单词，在2006年之前在英文中并不存在。2006年前后，CloudComputing这个单词开始偶尔出现。2007年末，Cloud Computing出现的频率迅速增加。2008年初，Cloud Computing在中文中开始被翻译为“云计算”。</p>

<p>有人将云计算的基本思想-共享资源，往前推到1955年。单词“人工智能”的发明者、计算机科学家John McCarthy提出了“time-sharing”理论，即不同的用户复用、分享一台计算机。那是大型主机的年代，不同用户可以通过终端使用同一台主机。到了七十年代，有了被称之为虚拟机（Virtual Machine）的东西，IBM做的。即每个VM在逻辑上拥有独立的内存、处理器，但共用同一台服务器硬件。</p>

<p>而云计算的基本思-公共信息基础设施，可以追溯到上世纪六十年代。当时，在较广泛的范围讨论过computing utility。</p>

<p>John McCarthy，还是上面这个科学家，说计算机应该形成一个公用基础设施-computer utility，就像电话网络那样。原话是这样：</p>

<blockquote><p>&ldquo;If computers of the kind I have advocatedbecome the computers of the future, then computing may someday be organized asa public utility just as the telephone system is a public utility&hellip; Thecomputer utility could become the basis of a new and important industry.&rdquo;</p></blockquote>

<p>1965年4月30日，美国电报公司Western Union发布了一篇战略计划文档，提出建立计算基础设施“computing utility“：一个全国性的信息基础设施，让订阅者便宜、高效、迅速地获取所需的信息流，以便创建商业业务和其他东西。</p>

<h4>初试啼声</h4>

<p>1995年，SUN公司提出了“Network Computer”，将当时的PC简化，以降低硬件成本，客户端的计算机具备很少的固化软件，其他的系统软件和应用软件从网络下载。Network Computer的软件不是机器代码，而是一种通用的中间代码(如Java bytecode)。</p>

<p>Technology Review的Fechar janela认为是George Favaloro和Sean O’Sullivan最早使用cloud computing这个单词。</p>

<p>1996年，那还是Netscape的年代，在康柏（Compaq Computer）的办公室里，一群技术管理者在讨论互联网业务的未来时，称之为“cloud computing”。这群人的战略颇有先见之明。他们认为，不仅所有的商业软件都会转移到网络上，而且“cloud computing”驱动的应用，比如用户文件存储在网上，也会普及。对于当时在房间里的康柏市场主管George Favaloro，和年轻的技术专家Sean O’Sullivan来说，云计算的主意将意味着与以前不同的收入。对康柏来说，这是一个每年20亿美元的生意，卖服务器给互联网服务商。</p>

<p>在1997年5月，美国公司NetCentric试图将“Cloud Computinig”申请为商标，但在1999年4月放弃了，专利号75291765。NetCentric当时准备用这个商标来进行教育服务，比如课程和研讨会。NetCentric当时正在与康柏进行一个商业计划，计划中大量使用cloud computing这个单词，并且对其的描述与后来有很多相似之处。</p>

<p>O’Sullivan的创业公司正在与康柏谈判一笔500万美元的投资，而Favaloro刚被康柏委任负责互联网服务商业务。在他们的计划书里面，有这样的业务构想：用户用18.5美元购买37分钟的视频会议，用4.95美元购买253MB网络存储，3.95美元看一场泰森的拳赛。</p>

<p>NetCentric准备做一套软件，能让ISP（互联网服务商）们实现和对数百甚至数千个这样的服务进行收费。他们称之为“‘cloud computing’-enabled applications”。当然，康柏将在方案里卖硬件。Favaloro 和 O’Sullivan谁最先说出cloud computing已经不可考了，因为两个当事人回忆不起来这个单词被说出来的准确时间。</p>

<p>他们两都同意cloud computing被创造出来，是作为一个市场营销词汇。那时，电信网络已经被用cloud来；在工程图里，一朵云就代表网络。他们需要找一个广告语，将快速发展的互联网机会与康柏的业务联系起来。Favaloro说“计算是康柏的基石，而那朵朵云正快速发展，我们需要把两者联系起来”。</p>

<p>他们的业务并不好，NetCentric也在失望中放弃了这个业务，转而推广互联网传真服务，但是最后关门了。O’Sullivan说“我们窥见了一个机会，但我们最终没有推出大量的云计算应用，这些让我难以忘怀”。</p>

<h4>浮华人世</h4>

<p>2001年，纽约时报的JohnMarkoff，写了一篇Dave Winer对微软新的.net服务平台Hailstorm的负面评价时，使用了“cloud’ of computers”一词。Hailstorm当年，被设计为整合各种设备、数据和服务，为用户提供简洁、实用的计算方案，但受制于当时的技术和应用环境，Hailstorm并没有取得成功。可以看成是Windows Azure的祖先了。</p>

<p>2006年8月9日的战略大会上，谷歌CEO施密特在与Danny Sullivan对话时，谈到广告和互联网时有一段原话：</p>

<blockquote><p>What&rsquo;s interesting [now] is that there is anemergent new model, and you all are here because you are part of that newmodel. I don&rsquo;t think people have really understood how big this opportunityreally is. It starts with the premise that the data services and architectureshould be on servers. We call it cloudcomputing – they should be in a &ldquo;cloud&rdquo; somewhere. And that ifyou have the right kind of browser or the right kind of access, it doesn&#8217;tmatter whether you have a PC or a Mac or a mobile phone or a BlackBerry or whathave you – or new devices still to be developed – you can get access to thecloud. There are a number of companies that have benefited from that.Obviously, Google, Yahoo!, eBay, Amazon come to mind. The computation and thedata and so forth are in the servers.</p></blockquote>

<p>施密特大概是第一个说出cloud computing的公众人物，并被大众媒体报道。但是，很可惜，它用这个词是为了解释互联网，用cloud computing来指代服务器-浏览器架构中的服务器。这是一种当时已经存在的技术和架构。特别的，施密说这个词时，特并不是在指一种新的技术、产品、服务、商业模式。</p>

<p>但真正让云计算落地的商业产品——亚马逊AWS EC2，即ElasticComputing Cloud，在施密特参加搜索引擎战略会议会议两周后，2006年8月24日上线，沿用了以前将Cloud指代服务器集群的含义和说法，在其新闻稿里也没有提到Cloud Computing，而是这样描述EC2和S3：Amazon Elastic Compute Cloud (Amazon EC2) is a web service thatprovides resizable compute capacity in the cloud. Just as Amazon Simple StorageService (Amazon S3) enables storage in the cloud, Amazon EC2 enables “compute”in the cloud.</p>

<p>彼时，亚马逊等还不认为Cloud Computing是一个单词，仍然用Cloud指代服务器集群。亚马逊虽然已经在2006年3月13日推出了简单存储服务S3，并在8月24日推出了被后来看作是云计算产品真正到了的EC2，但亚马逊和当时的业界并不认为Cloud Computing是一个单词。</p>

<p>到此时，亚马逊还没有使用Cloud Computinig这个单词。而且亚马逊用来命名和描述其EC2产品的用词Computing Cloud 或者“compute” in the cloud与当时在一定范围内存在的说法并没有不同。Computing Cloud也好，“compute”in the cloud也好，与施密特的Cloud Computing在技术上并没有本质不同。</p>

<p>EC2最大的不同是，它是第一个让“compute” in the cloud商业化的产品，是第一个把让公司外的用户能够“compute” in the 亚马逊的cloud。施密特的Cloud Computing停留在技术架构层面，而且指的是一个公司内部从浏览器到数据中心的“compute” in the cloud。</p>

<p>谷歌在营销上开启了cloud computing的序幕，亚马逊AWS EC2 在产品和商业模式上开启了cloud computing的序幕。</p>

<h4>一锤定音</h4>

<p>云计算的概念在2008年2009年经过无数先驱的创造、争论、整理，才形成了如今比较统一的概念和认识。</p>

<p>2011年9月，NIST（美国国家标准与技术研究所）发布了最终版的《 The NIST Definition of Cloud Computing》,标志着云计算定义的争论已经平息。这是一个兼容并包的、标准的云计算定义，总结了市面上所有云计算服务的通用特征。</p>

<h4>事后诸葛</h4>

<p>自从云计算诞生起，就不乏反对声音。比如Oracle的埃里森斥责云计算是胡言乱语，当然后来变成云的粉丝。百度CEO李彦宏称云计算为新瓶装旧酒，同时发明了框计算，当然，2015年亚马逊发布财报后，又决定搞一下云计算。</p>

<p>更多人，只是把云计算当成广告语，能贴到产品上去就好。云计算都没有拒绝，知道云计算被泛华为基于互联网的任何企业或个人服务。</p>

<p>这似乎回到了起点：云计算就是互联网，或互联网服务的服务器部分。</p>

<p>有人事后诸葛亮了：转了一圈，这云计算不还是互联网嘛，我当时就这么说的。</p>

<p>云计算在大部分时候，确实只是一个营销术语。但不幸的是，它不仅仅是一个广告词，它背后的本质、创新、技术、战略代表了一个新时代的开始。</p>

<h4>一声叹息</h4>

<p>有人创造了一个新单词新概念，却一无所获，有人无心插柳被人贴上标签，却赚的盆满钵满，怎么就这么不平等呢？</p>

<p>在笔者上学的时候，系里面有个教授数据库知识的专业老师。这位老师的特点非常明显，上课打开PPT文档，从设计原理到历史段子，滔滔不绝，绝对引人入胜。</p>

<p>在一个学期的最后一堂课上，我记得这位老师为了来一把实践，打开Win2000 SQL server，想要敲一个join的嵌套查询语句秀一下，悲剧的是电脑就是不给面子，折腾了半个小时总是报语法错，最后他只能尴尬的回到PPT讲学模式继续。</p>

<p>从此，我对哪些满口浮华词汇的人抱有深深的怀疑。</p>

<h3>广告和产品谁更重要</h3>

<p>在商业的世界里，真相并不重要，重要的是利益在哪里。</p>

<p>现在想来，这位老师早已深得<code>无招胜有招</code>的真谛。当你能通过PPT创造世界的时候，何苦亲自动手呢？有一批傻傻的码农们帮你干活呢！掌握利益才是关键！</p>

<p>这个词给我们启示就是，在某个情形下，创造出一个名词的力量，远远大于产品本身。营销也是产品的一部分&mdash;很多时候是最重要的那一部分。</p>

<h4>传说在蛮荒的魔法时代，创造一样新事物的办法就是为它想一个好名字，掌握这项技艺的人被尊称为巫术大师。</h4>

<p>少年，我想说，下次听到这样的宣传，先不要急着笑，要看看它的利益在哪里，那位大师的目的何在？</p>

<blockquote><p>朋友们，我们有一个划时代的产品，它的底层采用了人工智能技术，整合了整个股票市场100年来的大数据，并存储在区块链上，现在，我们有好几组顶尖专家看好的量化策略，正用强大的量子计算机做回归测试。更妙的是，整套系统采用光伏能源，并由石墨烯材料打造一个稳定的能量转换站，可以无限运行下去；现在，我们就等你们来投资数钱了，还等什么，马上拿起电话，拨打xxxxxx ~~~</p></blockquote>

<h4>引用:</h4>

<p><a href="http://www.infoq.com/cn/articles/romance-of-cloud-computing--part01">http://www.infoq.com/cn/articles/romance-of-cloud-computing&#8211;part01</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[为什么不用MAC地址来定位机器]]></title>
    <link href="https://happy123.me/blog/2018/09/09/wei-shi-yao-bu-yong-macdi-zhi-lai-ding-wei-ji-qi/"/>
    <updated>2018-09-09T15:09:42+08:00</updated>
    <id>https://happy123.me/blog/2018/09/09/wei-shi-yao-bu-yong-macdi-zhi-lai-ding-wei-ji-qi</id>
    <content type="html"><![CDATA[<p>在知乎看到了这个问题，MAC地址48Bit, IP地址32Bit，完全可以用MAC划分出一个段来作为IP的映射，或者干脆不用IP了，有啥不可以呢？</p>

<p>我觉得问题挺有意思的。我推测了一下。</p>

<p>这纯粹是一个历史演变：</p>

<p>10Base 以太网[Ethernet Version 2（EV2）] 是由施乐公司出去的人发明的，后来以太网被市场承认了就纳入IEEE802标准，这是20世纪80年代的事情，那个时候就已经定义MAC地址了。</p>

<p>TCP/IP虽然最初是在1983年提出的，但是发展还是在1990年之后；另外TCP/IP也不是一个协议，而是一组协议簇，像ARP之类的和MAC地址相关的协议，很明显的，是在已有的硬件基础上开发的。</p>

<p>所以结论很明显，在早期只有局域网的时代，诞生了MAC地址这种硬件地址规定；后来联网机器越来越多，TCP/IP 成为主流联网协议，但是它的年龄和MAC地址是差不多的，也不可能再重新搞，为了适配现有的局域网模式，开发了ARP等协议；</p>

<p>计算机很多问题都是工程问题、商业问题，并不是技术完美就通吃天下，很多东西都是历史积淀、为了兼容现有系统而发展出来的。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[真的存在独立随机事件吗]]></title>
    <link href="https://happy123.me/blog/2018/09/09/zhen-de-cun-zai-du-li-sui-ji-shi-jian-ma/"/>
    <updated>2018-09-09T10:29:21+08:00</updated>
    <id>https://happy123.me/blog/2018/09/09/zhen-de-cun-zai-du-li-sui-ji-shi-jian-ma</id>
    <content type="html"><![CDATA[<p>比特币的block hash value一般被认为是一个真随机值，也被各种dice机制用来做seed.</p>

<p>但是我老是在想：世界上存在真正的随机吗？或者再进一步，存在真正的<code>随机+独立</code>事件吗？</p>

<!-- more -->


<p>比如大刘的小说《镜子》就幻想了一种计算模型，从宇宙大爆炸那一刻开始，设定初始条件的组合再穷举，总能得到一个宇宙状态，这个宇宙就是我们现在所处的宇宙，你就能预测所有古往今来从诞生到毁灭的一切了；照这个道道来看，如果有一天能拥有无尽的算力，模拟预测亿万的宇宙都是可以的。</p>

<p>但是<code>无限</code>这个东西实在是个逻辑上的概念，物理世界里面存在<code>无限</code>吗？又是一个挠头的问题。</p>

<p>简而言之，因为物理世界种尚未发现这样一种东西，它的存在时间无限，计算能力无限，所以才会有<code>独立随机</code>这种概念。</p>

<p>所以我觉得概率这种东西是物理学上的东东，反而不能从数学上来认知。因为它的存在根本是无法证伪的。</p>

<p>正如相对论出世之前，牛顿三定律就能很好解释地球范围内的极大多数现象了；人们由于<code>时间+算力</code>的限制，只能从统计学上承认<code>独立随机事件</code>的存在，而无法在数学上去证明。</p>

<p>瞎扯这么多，主要是我想起来几年前做过的两件消遣事：</p>

<h4>抛硬币真的事一个随机事件吗？</h4>

<p>嗨嗨，我就是这么无聊。我确实拿着一个2005年的1元硬币抛了上万次，研究抛硬币这个东西是不是真的是个随机事件。说到这里我都佩服自己了:真的是傻逼到一定境界的人。</p>

<p>结论其实很无聊，其实抛个几百次就很容易看出来，至少在一个海拔水平面上，在一个刚性物体上面抛2005年铸造的1元硬币，不是随机事件，某一面向上的机率明显更大。而且与你抛硬币的方法有很大关系。</p>

<ul>
<li><p>2005年版的1元硬币如果立起来，重心并不是平均的，一面字、一面花，中心肯定会偏向比较重的那一面；这样的话，如果你把硬币立起来，用水平旋转的方法抛硬币，肯定会有一面的概率压倒性的大</p></li>
<li><p>如果是力量比较平均的人，抛个一万次并不会对身体造成太大负荷，结合硬币的重心不平均，这就造成了抛上去掉下来的抛法肯定也是有一面向上的概率大</p></li>
</ul>


<p>这个是经过实证的，至少我可以保证，在某地、我的某个状态下，抛某个硬币，我去赌博，是很容易下注的，我知道哪面向上的概率大。</p>

<p>所以一定要小心下次跟你赌抛硬币的人，他的硬币有可能做了手脚，或者他练习过手法，或者他知道这一版硬币的重心在何方。</p>

<p>当然，你也可以反对，说我抛硬币概率巴拉巴拉，或者说一万次样本太小巴拉巴拉，或者说你一个人抛样本太小巴拉巴拉~~，总之就是基于统计学的实验无法证伪。</p>

<p>再说说我的实验B</p>

<h4>存在完全随机的数字吗？</h4>

<p>大家普遍承认计算机产生的随机数是个伪随机数。为了解决这个问题，死宅们研究出了:</p>

<p><a href="https://www.random.org/">https://www.random.org/</a></p>

<p>这种接口，利用大气随机噪音来生成随机数；当然有很多人更相信量子态的随机，用量子发生器来产生随机数等等等等；</p>

<p>这些方法共同的问题还是无法证伪，谁能保证你是真随机呢？</p>

<p>幸好有 <a href="https://primedice.com/">https://primedice.com/</a> 这样的赌博网站，好吧，我羞耻的承认，我在它上面玩了上白万盘，当然是模拟盘。</p>

<p>因为这个网站是投入真金白银的BTC，并且基于各个用户的计算机产生随机数的，0.01的误差重复1000次也足以让你归零；从它成立至今还欣欣向荣的发展势头来看，它的随机数之随机，绝对要比一些嘴炮科学家来的靠谱；毕竟，你不随机，早就倒闭了。</p>

<p>让我作为一个赌了上白万盘的资深玩家告诉大家，用最简单的赌徒谬误方法：<code>赌大小，输了加倍赌</code>，这种办法取得的最好成绩是连续54胜(如果我没记错的话)，因为它提供的模拟盘最大资金量有限制，这就是极限了。我毫不怀疑如果投注的次数足够多，可以出现连续百胜千胜的机率也是有的。当然，你赢了也没有一点用，只要不收手，总会归零，赌徒谬误在绝对随机的情况下是百分百归零的，这个在数学上很容易证明。</p>

<p>同理可以推想，难道巴菲特不是特别幸运的，连赢1000次的那个人吗？</p>

<p>这个还是无法证伪。</p>

<p>赌徒谬误在primedice上面完全失败，恰恰说明相对于彩票的胜率，primedice的胜率明显更为公平。所以我毫不怀疑区块链技术将长期服务于投机赌博行业。在<code>是否存在完全的独立随机事件</code>这个问题无法证伪的前提下，区块链博彩纯粹是数学问题。</p>

<p>我对于primedice的感激，在于它真正提供了一个让你随机测试各种谬误策略的地方，当然所有的策略都是永动机，科学上都没啥依据，仅仅有娱乐价值。</p>

<h4>悲剧的是理性的赌徒从来很少</h4>

<p>如果一个人是完全理性的，那他永远都不会去赌。他会调查出门交通安全度，吃东西注重科学养生，然后不抽烟喝酒 ~~~，然而并没有什么卵用；</p>

<ul>
<li><p>我爷爷抽烟喝酒，天天管闲事，活了九十九</p></li>
<li><p>我注重养生、天天锻炼，从来不管闲事，被911飞机砸死了</p></li>
</ul>


<p>一个赌博的场子需要传奇，疯子，人们厌倦一潭死水；这就是随机、投资、婚姻、生活等等一切人生轨迹的现实投射。</p>

<p>统计学角度上来看，活着就是瞎折腾。</p>

<p>把一个人的一生按照时间切成一段一段，每一段的生活选择都是一种独立随机事件，人自以为是能掌控生活的，其实这么看来，命运是一种统计学上的东西。</p>

<p>我又想起来那个“阿基里斯悖论&#8221;。原来我觉得这个悖论有个很明显的解答，就是时间是有粒度的，不能无限分割，当阿基里斯距离乌龟达到时间的基本粒度时，就可以一步超越它了；换算成相对论的解释，就是空间也是有粒度的，当阿基里斯追赶乌龟，实际上是两个人的加速度不一样，尺缩效应强度不一，阿基里斯在空间上越来越接近乌龟，直到达到空间上的最小粒度，之后就超越它了。</p>

<p>其实还有一个统计学意义上的解释，就是阿基里斯追赶的每一小块时间，都充斥着独立随机事件，他不论赶上或赶不上乌龟，其实只是命运的摆弄罢了。</p>

<p>人生苦短，导致投机，真的很悲剧。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[读<价值平均策略>随想]]></title>
    <link href="https://happy123.me/blog/2018/09/08/du-jie-zhi-ping-jun-ce-lue-sui-xiang/"/>
    <updated>2018-09-08T17:26:51+08:00</updated>
    <id>https://happy123.me/blog/2018/09/08/du-jie-zhi-ping-jun-ce-lue-sui-xiang</id>
    <content type="html"><![CDATA[<p>周末读了<a href="https://book.douban.com/subject/2991567/">《价值平均策略》</a> 这本书，又生出一些无厘头的想法，记录一下。</p>

<p>这本书短小精悍，通篇探讨比较了三种定投策略，并用1926-1990年的美股市场数据进行了回测。</p>

<!-- more -->


<p>首先大多数人都已经承认了市场是难以战胜的，择时择股是一种超能力，可望不可及。散户唯一的机会就是定投指数基金。定投规避择时，指数规避择股。</p>

<p>然后现在市面上充斥着各种指数增强策略，国外也被称为聪明贝塔基金之类的；在作者看来，这些策略天花乱坠，却远不如他在九十年代就总结的三大套路。</p>

<p>这三大套路相信每一个有投资经验的人都会自己有意无意实践过，但是作者将其实证主义，并升华到理论，就十分难得了。</p>

<h4>等量份额策略</h4>

<p>每月购买一定量的股票份额，无论股票（或基金，或其他任何投资标的）是什么价格，持有品种的平均购买成本就是投资期间的市场平均价格。</p>

<h4>币值平均策略</h4>

<p>每月购买固定数量资金的投资标的，不管市场价格如何变化。</p>

<h4>价值平均策略</h4>

<p>一种更具弹性的公式化投资策略。价值平均策略关注的不是每月固定投入多少金额，而是每月投资标的的市值固定增加多少。</p>

<p>举个例子来看：目标不再是基金定投1000/月，而是基金市值固定增加1000/月。1月买入1000元基金；2月市场下跌，当月基金市值800元，再买入1200元，确保目标市值达到2000元；3月市场上涨，当月基金市值2750元，再买入250元即可；4月市场继续上涨，当月基金市值4363.63元，超过目标市值，赎回363.63元的基金</p>

<p>这种策略就是币值平均策略的加强版，其逻辑就是<code>跌的多就加仓，涨的多就少买</code></p>

<h2>对比</h2>

<p>首先三种策略都是保证了纪律性，这是定投的最大优点。</p>

<p>然后收益回测基于不同的时间点和时间段肯定会得出不同的结论，作者在做了非常精细、大量的比较后，从总体概率上得出结论</p>

<h4>短期(1-5年)</h4>

<p>完全无法预测，三种策略互有胜负。从胜率上来看，价值平均策略>币值平均策略>等量平均策略，因为相差实在不大，我认为这种统计上的结论缺乏可信度，可能只是一个随机游走而已。</p>

<h4>中长期(>50年)</h4>

<p>从胜率上来看，价值平均策略>等量平均策略>币值平均策略。为什么等量平均策略会胜于币值平均策略呢，是因为通胀的影响，越是后期，同样的价格买到的资产份额越来越少，这个时候等量平均策略的优势就显现出来了，它能够跟随通胀调整投入资金，就会跑赢币值平均策略。</p>

<p>通胀是一个非常重要的因素，等量平均策略在一个通胀的社会中显现优势，那么如何增强其它两种策略呢？答案是引入一个通胀因子，每年对投入的资金额或资产标的额做微调，这样其它两种策略就能稳稳胜过等量平均策略了。</p>

<p>通缩社会，道理也是一样的。</p>

<p>这么简单看来，等量平均策略因为每次需要的资金量不能准确的预估，在中长期投资方案中就有劣势了。</p>

<p>下面我们再来看看币值平均策略和价值平均策略。</p>

<p>首先说结论，作者的回测中，价值平均获胜的概率是优于币值平均的。想想道理也很简单，就是市场下跌的时候，价值平均买的更多，市场上涨的时候，价值平均策略买的少一点，这样整体成本会低一点。另外，除了像币值平均策略设定止盈点，价值平均策略还相当于是每次定投的时候也设立了一个弹性的止盈买入策略，所以表现好理所当然。</p>

<p>但是，价值平均策略有两个明显的缺点：</p>

<ol>
<li><p>定投后期，市场大幅下跌的时候，可能一次定投需要的资金是以往的几十倍计算，这样对资金流、人性考验非常大</p></li>
<li><p>如果是一个非常非常大的牛市，每次定投的止盈买入限制反而会拖累总体收益；比如像数字货币这样的标的，市场波动非常大，如果在后期扛不住，那就前功尽弃了。</p></li>
<li><p>总结下来，如果你是一个资金流非常充裕，精于计算，心理承受能力强的人，宜选择价值平均策略。</p></li>
<li><p>如果你是个稳健主义，投入的资金流已经算好了，并且对于市场波动承受能力差，宜选择币值平均策略</p></li>
<li><p>如果你认为自己的定力是万里挑一，投资的品种是茅台或者格力这样的万里无一的标的，可以在上涨的时候执行币值平均，下跌的时候执行价值平均，总之就是尽可能买买买。</p></li>
</ol>


<p>ToolTip: 在我看来，定投的最大优势就是用纪律来战胜人性，大部分人的定力并不像是自己想象的那么好，所以我认为币值平均策略是一个更大众稳妥的策略。</p>

<p>最后加上我们前面提到的通胀因子，可以每年提高一下定投金额，这样基本上就是一个稳健的投资策略了。</p>

<p>当然有更多的因子和手段可以加入，比如投资A股，在选定一个策略基础上，可以参照PE、PB、ROE等等等等去设置每次投资币值，每次投入设置一个上下限等等，这个因人而异，没有绝对真理。</p>

<h2>止盈</h2>

<p>不论哪种策略，止盈都是关键；盈利十倍没有止盈也是浮云；看看A股市场的历史过山车就知道了，现在可选的流派一般是且战且退：</p>

<ol>
<li><p>盈利>50%了，撤退50%资金</p></li>
<li><p>盈利又>80%了，再撤退20%资金</p></li>
<li><p>盈利翻倍了，跑路</p></li>
</ol>


<p>等等等等~~~</p>

<p>当然以上都是比较成熟的市场里面的回测表现，我把这些理论套用在比特币这样的历史数据回测中，发现哪个策略都影响不大，关键就是止盈。</p>

<p>因为这种市场的波动太巨大了，一波突如其来的泡沫会让人手足无措。用币值定投，期望收益50%，从2013-01-01开始，最长的达成实践大概在430天，最短只有1.5天；如果2013年8月份泡沫期起定投了4年，一直到2017年3月份，收益>400%了，问题是根据研究，能一直承受100%的波动，并等到400%收益的人，万中无一。更可怕的是，如果你拿到2017-12，收益超过2000%；</p>

<p>所以不用抱怨，在A股市场上，涨跌十倍的个股比比皆是；不用被哪些号称十倍百倍的收益的人蒙蔽了，大多数人就是在赌博而已，而且是很随意的赌博。</p>

<h2>模拟策略</h2>

<p>假设作为一个稳健的赌博选手，如果要去赌数字币，我们总结了种种策略之后，可以设计如下方案：</p>

<h3>方案1</h3>

<h4>总纲</h4>

<ul>
<li><p>总投资额永远不要多于总现金流的25%</p></li>
<li><p>耐心是美德</p></li>
<li><p>坚持纪律是保障</p></li>
<li><p>只要买的足够便宜，最终一定能回本，但是注意不要买到毒气弹</p></li>
<li><p>分批次操作，不要一把梭</p></li>
</ul>


<h4>入场</h4>

<ul>
<li><p>要早，或者已经走完一个完整的周期，至少可以看清楚现在是在历史的哪个位置。如果现在看不清在周期的哪个地方，要耐心</p></li>
<li><p>分成100次来投，每次1%，坚持币值平均策略</p></li>
<li><p>不要怕波动，只要认清价值，一定会在25次之内有收获</p></li>
<li><p>投资周期至少要覆盖这个市场历史波动的一个完整周期</p></li>
</ul>


<h4>止盈</h4>

<ul>
<li><p>要在风险可控的情况下实现盈利</p></li>
<li><p>分成六次来止盈， 每次盈利 10%, 20%, 40%，80%, 160%, 320%的时候出清</p></li>
<li><p>分成六次来止盈， 抛售的时间要覆盖半个周期，中间有波动的时候，比如以一次抛售盈利10%，但周期内没有到20%，不要恋战，10%已然很高</p></li>
</ul>


<h4>撤退(万不得已的时候)</h4>

<ul>
<li><p>首先不要怕波动，只要认清价值，一定会有收获</p></li>
<li><p>不要一次撤退，要边打边撤</p></li>
<li><p>分成五次来撤， 每次损失 10%, 20%, 30%，40%, 50%的时候撤退</p></li>
</ul>


<p>用上面的策略做一下历史回测，发现结果是这样的:</p>

<p>基于以下历史数据(2013-02-11&mdash;2017&mdash;11-02)回测制定定投策略</p>

<p>每日定投$100，达到4%的点止盈回撤，平均定投周期为29.89天，最长盈利周期为487天，其中76.941%的概率会在30天内止盈。</p>

<p>定投最差的入市点是2014年中国政府打压市场时期，此时有几项注意</p>

<ul>
<li><p>第一次大跌是不要怕，一般会有离场的机会，但要快</p></li>
<li><p>一旦离场，不要恋战，静候下次入场时机</p></li>
<li><p>入场时间和出场时间是关键，这个数据要及时准确分析</p></li>
<li><p>一次币灾2个月后，市场横盘，这个时候入场最安全</p></li>
<li><p>最完美的定投时机永远是在市场下跌的时候</p></li>
</ul>


<p>所以假设你是一个超级稳健派，在方案1的基础上我们再对细节进行修正，得到方案2增补条例</p>

<h3>方案2增补</h3>

<ul>
<li><p>经过统计，每次4%定投止盈是个合适的数字，另外我们的资金池来自于货基，也有一部分收益，IRR来计算，理想情况下，年收益会达到40%</p></li>
<li><p>具体的交易时间需要进一步量化，采取早晚两段时间交易</p></li>
<li><p>周期最长为500天，可动用资金为30w元，每日可定投600元，保守起见，第一轮定投先保证在500元/天，计算收益为<code>5000 * 300 * 0.4 = 60000</code>，验证此策略稳定后，资金可翻倍</p></li>
<li><p>40天内4%止盈，在70天内5%止盈，在100天内8%止盈，250天内10%止盈,超过250天，根据历史经验看，我们中彩了，此时一般需要400天才能取得10%的盈利，所以推荐死扛至40%止盈;</p></li>
<li><p>市场行情变动巨大时(测算定投回本周期越来越短)，此时一般是币价接盘之时，当定投周期缩小至3天之内时是个绝对危险的信号，此时不论持仓如何，绝对不可开始新周期，如果此时无亏损，宜空仓</p></li>
</ul>


<h4>风险</h4>

<ul>
<li><p>投入资金量的占比过大，会使判断力下降，以上计划最大投入资金为总资金流的30%，超过警戒线，但是从定投平均周期来看，并不多</p></li>
<li><p>跑路风险，每5000元资产计提一次来规避</p></li>
<li><p>归零风险，比如毁灭性BUG，币值归零</p></li>
</ul>


<p>这个策略在尽可能规避风险的基础上追求30%~40%的年收益，并且我们认为时间控制在400天内。(当然真正的赌徒会说，你是在逗我？像这种郁金香市场，风险巨大，你才要个40%？！ 我要百倍千倍，我全都要！)</p>

<p>少年，你写了很多量化回测程序，画了很多Excel曲线，得到了完美的回测数据，最后信心满满的上了这个策略，然后开始做梦，以上是不是看起来很美好呢。</p>

<h1>以上全错，所有的策略都是投机，你只是在赌博而已</h1>

<p>让我们再复习一下奥马哈先知的训诫:</p>

<ol>
<li><p>如果能从历史推测未来，那么最富有的人都是图书管理员 (你在看着后视镜开车)</p></li>
<li><p>加密货币最后的结果是会很糟的，因为他们没有产生任何跟这个资产相关的价值。这没什么不对的。如果你想赌一把，明天就会有人来并愿意付更多的钱，这就是赌博的一种。这不是投资。它是老鼠药的平方。(你选了一个郁金香资产标的)</p></li>
</ol>


<p>以上的方案有两个非常明显的特征说明你在赌博：</p>

<ol>
<li><p>不管是哪个国家的股市，长久来看，年回报率总是趋近于ROE，也就是12%;这世上大部分的生意，ROE超过12%的少之又少；所以芒格才一直强调12%是个可以慢慢赚的钱；所以看到诸如400天、40%这样的字眼，毫无疑问就是赌博，连投机都算不上</p></li>
<li><p>所有用历史数据做回测的量化策略都是赌博；如果巴菲特是靠回测赚钱的，你也无法确认他是不是一个特别特别的幸运儿</p></li>
</ol>


<p>只要是赌博，不论你赢了多少次，只要不离场，总会有黑天鹅来给你清零。</p>

<h3>哈，我知道你肯定会反驳，理由嘛，可以写一本书哦。我有无聊的琢磨了一下，赌徒投机，人性使然；</h3>

<p>当然也可以这么想，其实人活着这件事本身就是在不停的赌，科学的讲，我们活着的状态其实是一堆随机独立事件的集合；扩展开来，什么人类社会啊，国家政治啊，民族风俗啊，乃至地球的存在，宇宙的诞生，都是一堆随机独立事件的集合而已哈</p>

<h4>投机和投资如何区分，投机抑或是投资是如何诞生的？</h4>

<p>我一直对投机和投资如何区分抱有非常大的疑问。</p>

<p>比如巴菲特，大家都承认他是古往今来伟大的投资家。也有不少人觉得你就是持有资本，什么生产性的活动也不干，就是买卖公司和资产，然后投机成为巨富，大家对这种人总抱有敌视的态度，当然股民亦如是。</p>

<p>社会财富的积累其实取决于交易，而不是生产；这个看似违反直觉的结论已经被奥派经济学阐述了无数遍了，在此不赘言。</p>

<p>我关心的是，谁能保证巴菲特不是那个一直赢的幸运赌徒呢？他不过是特别特别幸运而已，毕竟，从概率上讲，整个人类社会，出现几个赌运特别好，一直赢到死的人也不是不可能。</p>

<p>关于这个问题，我想又可以写一篇洋洋洒洒的无聊论文，不过先打住，我们看看巴菲特是如何看待自己的交易策略的：</p>

<p>巴菲特本人作为靠资本获利的人，其实非常非常看空黄金等贵金属，还有他对大多数金融衍生品嗤之以鼻，看看他的说法：</p>

<blockquote><p>第二类投资包括的资产是指那些实际不产生任何收益，但买家在认为其他人未来会为此支付更高的价格的期望下所购买的资产，这些买家也清楚这些资产永远不具有生产性。17世纪的郁金香就是此类买家的最爱</p>

<p>这类投资要求有足够容量的买家市场，而这些买家受到诱惑是因为他们相信这一购买市场将持续扩大。持有者并非被这些资产的生产力所激励，这些资产永远不会生产，而是坚信他们在未来会对其更渴望。这一类别最主要的资产就是黄金，后者是对其他所有资产（尤其是货币）恐惧的投资者的最爱。然而黄金有两个显著的缺点，用途不广且不具有生产性。确实，黄金有一些工业和装饰的用途，但此类用途的需求优先，且不足以吸收新的产量。同时，如果你一直持有一盎司黄金，到最后你将仍然只拥有一盎司</p>

<p>今天，全球黄金储量约17万公吨。假如把它们熔铸成一个每面约68英尺的立方体。（设想它可以轻轻松松地放在一个棒球内场。）如果每盎司黄金价格1750美元，也就是我写下这些内容时的金价，这个立方体的价值大约9.6万亿美元。我们称它立方体A。</p>

<p>然后来创造一个和立方体A价格相同的立方体B。为此，我们要买下美国所有的耕地（4亿英亩，年产值2000亿美元），以及16家埃克森美孚公司（全球利润最高的公司，年利润超过400亿美元）。买下这些以后，我们还有1万亿美元可以用来零花。你能想象到，一个9.6万亿美元在手的投资者会选立方体A还是立方体B？</p>

<p>我自己最青睐的——你知道，就要讲到了——是我们的第三类资产：投资于有生产力的资产，无论是企业、农场，还是房地产。在理想的情况下，这些资产应该能在通胀时期让产出保持自身的购买力价值，同时只需要尽可能最少的新增资本投入。农场、房地产和可口可乐、IBM这样的很多企业，以及我们自己的See&rsquo;s  Candy（译注：逾90年历史的美国老牌糖果与巧克力食品公司）都能满足这双重考验。其他特定的公司——比如我们那些受管制的公共事业公司——都不能通过上述考验，因为它们在通胀的环境下需要大量资本。为了增加收益，它们的所有者必须增加投资。即便如此，第三类投资也仍会超越毫无生产力和以货币为基础的资产</p></blockquote>

<p>这段话毫无疑问的说明了，巴菲特将黄金、钻石或者诸如此类的数字货币都看成是郁金香的一种而已</p>

<p>其实挺好玩的，一个靠交易积累财富的人，最看重的是生产。</p>

<h4>思维锻炼一下，考虑一下交易的起源。</h4>

<p>农耕时代，消费和投资肯定是一件简单的事情。</p>

<p>你有一个梨子，我有一个苹果，各取所需，交换即可。</p>

<p>你有一片土地，我想要共同耕种，一筐苹果+牛羊若干，入伙即可。</p>

<p>后来，两两交换已经不能满足需求，于是有了集市，有了分工，有了商业。</p>

<p>参与这一切的人多了，世界就复杂了起来。</p>

<p>慢慢的，欺诈出现了，法律出现了，警察出现了，集镇出现了，交易所出现了，货币出现了，银行出现了，证券市场出现了，然后更大的欺诈，更多的警察，更完善的法律</p>

<h3>更复杂的世界。</h3>

<p>发展到今天，所有的制度、市场终究是解决“你有一个梨子，我有一个苹果”资源合理配置的问题。</p>

<p>税收、法律、中间人、券商等等等等不过是损耗，简单问题复杂化后的损耗。</p>

<p>问题是，参与的人越多，原本简单的问题就会越复杂。</p>

<p>最成功的投资，是自己有苹果，没有任何成本损耗的情况下换取了那个梨子。</p>

<p>有几个办法可以降低损耗：</p>

<ol>
<li><p>你有耐心，耐心的等待那个有梨子的人到你家门口。像火车上找座位一样，只要你有耐心，无限的等下去，总会找到位子。</p></li>
<li><p>你找到一个市场，这个市场还停留在农耕时代，还有人拿着梨子等苹果。这个市场必须足够简单，而且发展的时间很短，所以参与的人少。</p></li>
<li><p>你有很多苹果，满世界瞎换，可能换到樱桃，可能换到香蕉，但是概率总会让你拿到梨子的。</p></li>
</ol>


<p>1是价值投资，2是天使投资，3是风险投资</p>

<p>人最容易做到的是价值投资，但是人的生命太短，很可能你一生等不到那个梨子。所以敢于拿一生去下注的人很少。巴菲特是那个特别有耐心，运气特别好，用一生去下注并拿到了好几个梨子的人。</p>

<p>人最常做的是风险投资，满世界寻找机会，瞎操作，然后手持一堆的樱桃香蕉就是等不到梨子，然后还是怀着乐观的心态继续瞎操作，总体上来看，这不过是把生命切成一段一段，然后分配到了风险更大的赌博当中。</p>

<p>最后就是你找到了一个足够简单的市场，初期看起来是骗人的，怎么可能在工业时代还有这么傻的市场，他们还刀耕火种，集市上大吆喝来两两交换。你疑惑，你学习，你尝试，最后相信了：这确实是个萌芽市场。 数字货币就是这样的例子。</p>

<p>最后，时刻记住，人的生命中99%的时间是不用去投机的，你只需要做一件事情：</p>

<p>找到那个足够简单的市场，交换，然后不动，耐心，即可。</p>

<h4>所谓投资，其实就是和时间的博弈。当你拿出的筹码小于这段时间的价值之时，就是投机。</h4>

<p>在你生命中的99%，你总是会面临很多很多的诱惑，诱惑你去投机。</p>

<p>我很悲哀的告诉你，年轻人，最后你总是会输的很惨。</p>

<p>但是人就是这样的傻瓜，明知道前面是深坑，总是想去跳进去，试错。“我是不一样的”。</p>

<p>嗯，投机越年轻越好，因为那时你还输得起。</p>

<p>如果你要投机，年轻人，记住下面几件事情：</p>

<ol>
<li><p>你最后肯定会输的，不过是输的很惨和输的非常非常惨两个结果。可是，谁又能说得清呢？也许人只要活着，面对命运就是注定的输家。</p></li>
<li><p>市场深度要足够，一定要保证流动性</p></li>
<li><p>永远不要与&lt;100单的对手交易</p></li>
<li><p>单笔交易金额一定要设置上限</p></li>
<li><p>要专注，永远不要同时操作>2笔交易</p></li>
<li><p>每次大额交易之前，要用小笔资金做回归测试</p></li>
<li><p>一个公司股权质押的方式融资，杠杆率就会加大，这支股票的风险就会成倍增长</p></li>
<li><p>总投入资金量的占比过大，会使判断力下降；如果你的投入超过总资产的25%，人就会变傻，傻子就会犯错；永远永远不要让自己犯傻</p></li>
<li><p>记住，你很笨，你的优势就是知道你是个笨蛋，知道自己是个笨蛋会让你小心</p></li>
<li><p>想要投机的时候，看看1</p></li>
</ol>


<h4>最后，读完了整本书，瞻仰了各种策略之后，仔细一看，整本书不过还是那么一句话:&ldquo;不要投机&rdquo;</h4>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[从WebAssembly说开去]]></title>
    <link href="https://happy123.me/blog/2018/08/25/cong-webassemblyshuo-kai-qu/"/>
    <updated>2018-08-25T11:14:39+08:00</updated>
    <id>https://happy123.me/blog/2018/08/25/cong-webassemblyshuo-kai-qu</id>
    <content type="html"><![CDATA[<p>科技界历史循环，轨迹无法量化预测。</p>

<p>前几天看到bellard都在浏览器里面用WebAssembly跑虚拟机了，点进去试试，竟然模拟Win2000都有模有样了。</p>

<p><a href="https://bellard.org/jslinux/index.html">https://bellard.org/jslinux/index.html</a></p>

<p>不由得感叹人折腾的能力真是无比强大。</p>

<!-- more -->


<p>有人说WebAssembly又实现了一个Flash，又实现了一个SliverLight，又造了一个JavaApplet，我都想到很久很久之前的ActiveX了，想到COM组件了~~~</p>

<p>肯定又会有人跳出来说，这回不一样了:</p>

<ol>
<li><p>谷歌、苹果、微软等公司一起来干了</p></li>
<li><p>前端拯救世界，前端用Nodejs打入后端，后端用WebAssembly征服前端~~</p></li>
<li><p>就连技术媒体都开始用吸睛标题：&lt;WebAssembly:解决 JavaScript 痼疾的一颗银色子弹？></p></li>
</ol>


<p>我得说，技术路线的发展完全是随机的，无迹可寻。</p>

<ul>
<li><p>比如当初Flash就被乔帮主活活说死了，说你不行行也不行。</p></li>
<li><p>比如Plan9搞了一堆创新之后死翘翘了，根本就没几个人去在意</p></li>
<li><p>比如苦大仇深的GUI方案，MS推出了一系列库，从MFC、WTL到所谓的WPF，从各类公司的私有解决方案，到现在还在服役的大名鼎鼎的Duilib;最后就不提历史风尘中的各类商业皮肤库了；</p>

<p>   还有开源界的各路GNome、wxWidgets、QT、TCL，到现在跨平台GUI方案的战火都烧到浏览器上了，VS Code用啥实现的，竟然是Electron；虽然效果拔群，但是总觉得哪里不对路啊；</p></li>
<li><p>从移动手机刚刚兴起的年代，就有无数种解决方案发誓要做到&#8221;一次编写，到处运行&#8221;，兼容各大主流移动平台；如今看看，口号依旧，分裂依旧，半死不活依旧</p></li>
<li><p>为什么历史选择TCP/IP而把ISO模型扫进教科书</p></li>
<li><p>为什么IE打败Netscape</p></li>
<li><p>为什么KVM逐渐压倒Xen</p></li>
</ul>


<p>历史只是偶然，成败听凭运气，没有什么道理好讲的。</p>

<p>我只能根据有限的经验来预言：任何一种号称&#8221;大一统方案&#8221;的方案最后总是失败。</p>

<p>让我们再大声诵读伟大的Fred Brooks先知的预言：没有银弹，没有银弹，没有银弹~~~</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[非烫即屯]]></title>
    <link href="https://happy123.me/blog/2018/08/25/fei-tang-ji-tun/"/>
    <updated>2018-08-25T09:34:43+08:00</updated>
    <id>https://happy123.me/blog/2018/08/25/fei-tang-ji-tun</id>
    <content type="html"><![CDATA[<p>好久没有打开过VC++了，今天为了修改一个远古控件打开了久违的VC++，DEBUG模式下又看到了久违的&#8221;烫烫烫烫烫&#8221;~~~~</p>

<!-- more -->


<p>VC runtime debug version会把stack初始化成0xcc，unicode中0xcccc(双字节)就是中文的烫。如果你开了个char[]，然后最后一个字符忘了设置成0x00，然后去printf这个字符，那么整个stack从这个局部字符数组开始都输出到console，就变成了“烫烫烫烫烫”。</p>

<p>为啥把stack初始化成0xcc而不是0x00呢？是因为0xcc在intel x86芯片指令集中代表int 3，也就是debug中断，该指令会自动把程序停在单步调试状态，然后去寻找系统中注册的调试器，如果找不到调试器，那么就会终止程序。这一开始是为了调试栈缓冲溢出错误的。如果出现溢出，并且代码尝试执行缓冲中的指令，就会进入单步调试状态。</p>

<p>这是debug version, 那么release verion呢？发布版会把栈初始化成0xcd，这个就是imm8，就是立即中断退出的意思。这时候因为运行在用户机器上，没有调试器，也不希望用户来调试你的程序。0xcdcd就是中文的“屯”字。你会看见一些写的超烂的程序经常会出现“屯屯屯屯屯屯”。的确挺屯的，</p>

<p>在今天这个芯片DEP，操作系统NX锁定双保险的时代，这种初始化已经没有啥必要了，这个烫屯还存在纯粹是历史原因。</p>

<p>所以在那个电脑还比较古早的年代，说人品不好，那叫非奸即盗。说程序写的烂，那叫非烫即屯。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[史上最可怕的赌局FOMO3D(4)]]></title>
    <link href="https://happy123.me/blog/2018/08/22/shi-shang-zui-ke-pa-de-du-ju-fomo3d-4/"/>
    <updated>2018-08-22T20:07:49+08:00</updated>
    <id>https://happy123.me/blog/2018/08/22/shi-shang-zui-ke-pa-de-du-ju-fomo3d-4</id>
    <content type="html"><![CDATA[<p>呵呵，FOMO3D 第一轮今天结束了，奖金10469ETH。</p>

<p>惊奇的是最后的<a href="https://etherscan.io/tx/0xe08a519c03cb0aed0e04b33104112d65fa1d3a48cd3aeab65f047b2abce9d508">幸运儿</a>并没有买断最近的块或是依赖DDOS获胜，他纯粹是涓滴投注的策略流获胜。</p>

<p>但是打包这笔交易的区块非常可疑，这个区块中貌似只有一笔交易是发送给FOMO 3D long的，也不能排除是矿工玩这个游戏只打包自己的投注的可能性。</p>

<p>这个块是鱼池打包的，鱼池一直是以太坊的算力霸主。</p>

<p>如果真的是鱼池获胜的话，也说明即使是以太坊，大矿池在没有监管，垄断算力的情况下，做任何事情都有巨大的优势。虽然我一直觉得POW优于POS，但是现在我认为V神的顾虑有道理，我也希望能尽快看到以太坊切换到DPOS之后的运行状况。</p>

<p>总之，最后并没有出现全部算力涌出竞争最后几个块的局面，没有黑天鹅的黑天鹅。</p>

<p>这证明了P3D 以及衍生的FOMO3D的玩家其实还不多，即使已经吸纳了近100,000个ETH，还只是一个小众游戏。</p>

<p>很快FOMO3D就会沦为一个平庸的庞氏骗局Game Over。但是P3D最终会怎样呢？</p>

<p>我认为会有一个沉寂期，然后在一个意想不到的时机又吸引一波赌徒入场。</p>

<p>PS:加一个技术流分析:<a href="https://paper.seebug.org/681/">智能合约游戏之殇——类 Fomo3D 攻击分析</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[巴菲特致股东的信 1957-2018 中英文整理]]></title>
    <link href="https://happy123.me/blog/2018/08/14/ba-fei-te-zhi-gu-dong-de-xin-1957-2018-zhong-ying-wen-zheng-li/"/>
    <updated>2018-08-14T14:19:43+08:00</updated>
    <id>https://happy123.me/blog/2018/08/14/ba-fei-te-zhi-gu-dong-de-xin-1957-2018-zhong-ying-wen-zheng-li</id>
    <content type="html"><![CDATA[<p>我非常奇怪网上并没有找到一本比较完整的伯克希尔.哈撒韦每年致股东公开信的整理集。</p>

<p>伯克希尔.哈撒韦的官网上只有1977-2018年的的PDF整理，至于中文没有比较权威的翻译，大多是零零碎碎的整理。</p>

<p>巴菲特先生的信徒如此之多，衍生出来的网红书籍数不胜数，为什么没有一部研究伯克希尔.哈撒韦每年致股东公开信的专著呢？期待有人能整理出来。</p>

<p>我花时间整理了网上公开的翻译合集供大家下载：</p>

<p><a href="https://pan.baidu.com/s/1MLVlbasNe7ADHqSOKKtOlg">https://pan.baidu.com/s/1MLVlbasNe7ADHqSOKKtOlg</a></p>

<!-- more -->


<p>压缩包中共有:</p>

<ol>
<li>巴菲特致股东的信_1957_2018_zh (中文版)</li>
</ol>


<p>收集了1957-2018年伯克希尔哈维撒每年致股东公开信。</p>

<p>1977年之前的文档残缺不全，有部分直接为英文版没有翻译，1977年之后全翻译，但是资料来源不一，质量良莠不齐</p>

<ol>
<li>巴菲特致股东的信_1957_2018_en (英文版)</li>
</ol>


<p>收集了1957-2018年伯克希尔哈维撒每年致股东公开信英文原版。</p>

<p>其中伯克希尔・哈撒韦的官网上只有1977-2018年的的PDF整理，之前的资料我google而得，不能保证权威和准确性；</p>

<ol>
<li>zh 文件夹</li>
</ol>


<p>中文版翻译每年一个pdf文件</p>

<ol>
<li>en 文件夹</li>
</ol>


<p>英文版整理:</p>

<p>1977-2018 每年一个pdf文件，此为伯克希尔・哈撒韦的官网版本；</p>

<p>1970-1976 每年一个pdf文件，此为google资料所得，不保证权威性</p>

<p>1957-1970 一个合集pdf文件，是国外经管资料整理所得，不保证权威性</p>

<h3>参考资料：</h3>

<ul>
<li>伯克希尔.哈撒韦的官网:</li>
</ul>


<p><a href="http://www.berkshirehathaway.com/letters/letters.html">http://www.berkshirehathaway.com/letters/letters.html</a></p>

<ul>
<li>伯克希尔.哈撒韦推荐的整理资料图书</li>
</ul>


<p><a href="https://www.amazon.com/Berkshire-Hathaway-Letters-Shareholders-Buffett/dp/0615975070/ref=sr_1_fkmr0_1?s=books&amp;ie=UTF8&amp;qid=1511796222&amp;sr=1-1-fkmr0&amp;keywords=berkshire+hathaway+letters+to+shareholders%2C+2014">Berkshire Hathaway Letters to Shareholders</a></p>

<h2>巴菲特老先生的名言警句(有些实在是太逗了，读起来真像是听相声一样，即使已经了然于心还能把你逗得乐不可支)，纯享受:</h2>

<ul>
<li><p>一个公开的民意测验无法代替思考。</p>

<ul>
<li>A public-opinion poll is no substitute for thought.</li>
</ul>
</li>
<li><p>你必须独立思考。我常常惊讶于：一些智商极高的人在市场上无意识的跟随大众。我从没通过和别人谈话得到过好的主意。</p>

<ul>
<li>You have to think for yourself. It always amazes me how high-IQ people mindlessly imitate. I never get good ideas talking to other people.</li>
</ul>
</li>
<li><p>我相信，坦诚的公司的管理层会使投资人受益。那些在公开场所误导别人的CEO最终会在私下里误导自己。</p>

<ul>
<li>We also believe candor benefits us as managers. The CEO who misleads others in public may eventually mislead himself in private.</li>
</ul>
</li>
<li><p>在你雇用人之前，你需要确认他的三项素质：正直诚实，聪明能干，精力充沛。但是最重要的是正直诚实，因为如果他不正直诚实而又具备了聪明能干和精力充沛，你的好日子也就到头了。</p>

<ul>
<li>In looking for someone to hire, you look for three qualities: integrity, intelligence, and energy. But the most important is integrity because if they don&rsquo;t have that, the other two qualities, intelligence and energy, are going to kill you.</li>
</ul>
</li>
<li><p>与其杀死毒龙，不如避开毒龙。</p>

<ul>
<li>It&rsquo;s easier to stay out of trouble than it is to get out of trouble.</li>
</ul>
</li>
<li><p>如果你在小事上无原则，那么大事上一样没有原则。</p>

<ul>
<li>If you let yourself be undisciplined on the small things, you will probably be undisciplined on the large things as well.</li>
</ul>
</li>
<li><p>和一个道德品质败坏的人，无法完成一桩好交易。</p>

<ul>
<li>You can&rsquo;t make a good deal with a bad person.</li>
</ul>
</li>
<li><p>对于企业而言，糟糕的运作加上混乱的管理，结果常常是一笔糊涂帐。</p>

<ul>
<li>The reaction of weak management to weak operations is often weak accounting.</li>
</ul>
</li>
<li><p>人性的弱点总是充满贪婪、恐惧或者是愚蠢，这是完全可以预测的，但是我们无法预测这种人性弱点的发生顺序。</p>

<ul>
<li>The fact that people are full of greed, fear, or folly is predictable. The sequence is not predictable.</li>
</ul>
</li>
<li><p>我在历史中学到的唯一东西就是：大众从未从历史中汲取教训。（11月17日名言）</p>

<ul>
<li>What we learn from history is that people don&rsquo;t learn from history.</li>
</ul>
</li>
<li><p>永远不要问理发师你是否需要理发。</p>

<ul>
<li>Never ask a barber if you need a haircut.</li>
</ul>
</li>
<li><p>交易市场就像上帝一样，帮助那些自助者。但是和上帝不同的是，交易市场不会原谅那些不知道自己在做什么的人。</p>

<ul>
<li>The market, like the Lord, helps those who help themselves. But unlike the Lord, the market does not forgive those who know not what they do.</li>
</ul>
</li>
<li><p>当市场下跌时，你轻易的将好东西打折变卖，但是一旦市场向上，再想买回来，难之又难。</p>

<ul>
<li>You can always juice sales by going down-market, but it&rsquo;s hard to go back upmarket.</li>
</ul>
</li>
<li><p>投资人必须谨记，你的投资成绩并非像奥运跳水比赛的方式评分，难度高低并不重要，你正确地投资一家简单易懂而竞争力持续的公司所得到的回报，与你辛苦地分析一家变量不断、复杂难懂的公司可以说是不相上下。</p></li>
<li><p>我和查理还没学会如何解决公司的难题，但是我们学会了如何避开难题，我们的成功在于我们集中力量于我们能跨越的一尺栅栏上，而不是发现了跨越七尺栅栏的方法。　</p></li>
<li><p>近年来，我的投资重点已经转移。我们不想以最便宜的价格买最糟糕的家具，我们要的是按合理的价格买最好的家具。</p></li>
<li><p>几乎在任何领域，专业人员取得的成就明显地高于门外汉。但在金钱的管理上往往并非如此。</p></li>
<li><p>不能承受股价下跌50％的人就不应该投资。</p></li>
<li><p>在经历25年企业管理与经营各种不同事业的岁月之后，查理跟我还是没能学会如何去解决难题，不过我们倒学会如何去避免他们，在这点我们倒做的相当成功，我们专挑那种一呎的低栏，而避免碰到七呎的跳高。</p></li>
<li><p>投资并非一个智商为160的人就一定能击败智商为130的人的游戏。</p></li>
<li><p>从不购买价格并不明显低于公司价值的股票。</p></li>
<li><p>1986年我的最大的成就就是没有做任何蠢事。诀窍是当没有合适的事情可做时，就什么也不做。(这一条可以想象一个老先生正襟危坐，底下一波信徒洗耳恭听先知的预言，然后老先生朱唇轻启，子曰：&#8221;不动。&#8221;)</p></li>
<li><p>我宁要模糊的正确，也不要精确的错误。</p></li>
<li><p>价格是你所付出的，价值是你所得到的。(一天念三遍啊念三遍)</p></li>
<li><p>于每一笔投资，你都应当有勇气和信心将你净资产的10％以上投入。</p></li>
<li><p>在错误的道路上，奔跑也没有用。</p></li>
<li><p>如果你一生中找到三个杰出的企业,你就会变得非常富裕。</p></li>
<li><p>控制风险的最好办法是深入思考，而不是投资组合。</p>

<ul>
<li>巴菲特在2004年伯克夏股东大会上说</li>
</ul>
</li>
<li><p>我们只是对于估计一小部分股票的内在价值还有点自信，但也只限于一个价值区间，而绝非那些貌似精确实为谬误的数字。价值评估既是艺术，又是科学。</p></li>
<li><p>对大多数投资者来说，重要的不是他们知道多少，而是他们能在多大程度上认识到自己不懂什么。</p></li>
</ul>


<p>*（有人质疑巴菲特的投资策略只是运气好而已，他讲了一个有关机率的故事回答它们）一群猪共有128000只，分别来自全世界各农场举行丢铜板比赛，投出正面的晋级，投出反面的淘汰，经过九回合后，只剩下250只猪晋级，有人认为那250只猪只是运气好而已。如果你发现晋级的250只猪有200只全是某农场来的，那你就必须问：那个农场喂猪的饲料有没有特别之处？</p>

<ul>
<li><p>我对总体经济一窍不通，汇率与利率根本无法预测，好在我在作分析与选择投资标的时根本不去理会它。</p></li>
<li><p>利率就像是投资上的地心引力一样。</p></li>
<li><p>若有人跟你谈诸如Beta等市场效率理论的东西时，赶快闪人。</p></li>
<li><p>投资的密诀在于，看到别人贪心时要感到害怕，看到别人害怕时要变得贪心。</p></li>
<li><p>垃圾债券总有一天会变成名符其实的垃圾。</p></li>
<li><p>在投资时，我们把自己看成是企业分析师——而不是市场分析师，也不是宏观经济分析师，甚至不是证券分析师。</p></li>
<li><p>多样化是无知的保护伞。</p></li>
<li><p>如果你对投资略知一二并能了解企业的经营情况，那么选5ー10家价格合理且具长期竞争优势的公司。传统意义上的多元化投资（广义上的活跃证券投资）对你就毫无意义了。</p></li>
<li><p>我从事投资时，主要观察一家公司的全貌，而大多数投资人只盯着它的股价。</p></li>
<li><p>恐惧和贪婪这两种传染性极强的灾难的偶然爆发会永远在投资界出现。这些流行病的发作时间难以预料，由它们引起的市场精神错乱无论是持续时间还是传染程度同样难以预料。因此我们永远无法预测任何一种灾难的降临或离开，我们的目标应该是适当的：我们只是要在别人贪婪时恐惧,而是别人恐惧时贪婪。</p></li>
<li><p>会计报表只是评估企业价值的起点，而非最终的结果。</p></li>
<li><p>所谓“市场效率学说”之类的投资教条，不过是为了增加投资的神秘性，好让投资顾问得以从中牟利罢了。</p></li>
<li><p>“不要把所有鸡蛋放在同一个篮子里”的谬论是错误的，投资应该像马克・吐温建议的“把所有鸡蛋放在同一个篮子里，然后小心地看好它”。</p></li>
<li><p>企业主须了解其利益，乃来自于企业内在价值（Intrinsic Value）的成长，而不是其持有股票之短期波动。</p></li>
<li><p>以GEICO这个case，乃至于我们所有的投资，我们看的是公司本质的表现而非其股价的表现，如果我们对公司的看法正确，市场终将还它一个公道。</p></li>
<li><p>巴菲特说在他四十多年的投资生衙中，只有靠十二个投资决策，造就他今日与众不同的地位。</p></li>
<li><p>许多人盲目投资，从某方面来说等于是通宵玩牌，但却从未曾看清楚自己手中的牌。</p></li>
<li><p>因为我把自己当成是企业的经营者，所以我成为更优秀的投资人；而因为我把自己当成是投资人，所以我成为更优秀的企业经营者。</p></li>
<li><p>没有公式能判定股票的真正价值，唯一方法是彻底了解这家公司。</p></li>
<li><p>风险是来自于你不知道你在做什么。</p></li>
<li><p>只有退潮时，你才知道谁是在光着身子游泳。唯有当潮水退去，才知道谁在裸泳。</p></li>
<li><p>我想我不会投资黄金，因为我看不出将这种金属从南非的地底挖出，再把它放到福克斯堡的金库中有何意义。</p></li>
<li><p>价值投资不能保证我们盈利，但是价值投资给我们提供了走向真正成功的唯一机会。</p></li>
<li><p>我承认，我和别人一样有种渴望。渴望干点什么，特别是在无事可干的时候。（巴菲特批评自己在航空业投资的错误时说）</p></li>
<li><p>如果你是投资者，你所关注的就是资产——在我们这里是指公司——未来的发展变化。如果你是投机者，你主要预测独立于公司的价格变化。</p></li>
<li><p>投资成功与否并非取决于你了解的东西，而在于你能否老老实实地承认你所不知道的东西。投资人并不需要做对很多事情，重要的是不要犯重大的错误。成功的关键是投资者如何把一些平凡的事，做得极不平凡。</p></li>
<li><p>用亏损概率乘以可能亏损的数量，再用收益概率乘以可能收益的数量，最后用后者减去前者。这就是我们一直试图做的方法。这个算法并不完美，但事情就这么简单。</p></li>
<li><p>如果你给我一把枪，弹膛里一千个甚至一百万个位置，然后你告诉我，里面只有一发子弹，你问我，要花多少钱，才能让我（对准自已）拉动扳机。我是不会去做的。你可以下任何注，即使我赢了，那些钱对我来说也不值一提。如果我输了，那后果是显而易见的。我对这样的游戏没有一点兴趣。可是因为头脑不清楚，总有人犯这样的错……用对你重要的东西去冒险赢得对你并不重要的东西，简直无可理喻，即使你成功的概率是100比1，或1000比1。</p></li>
</ul>


<h4>价值投资</h4>

<ul>
<li><p>成功的秘诀有三条：第一，尽量避免风险，保住本金；第二，尽量避免风险，保住本金；第三，坚决牢记第一、第二条。</p></li>
<li><p>当我和查尔斯买下一种股票时，我们头脑中既没有考虑到出手的时间也没有考虑过出手的价位。</p></li>
<li><p>可口可乐在1890年时整个公司大约值2000美元今天它的市值为500亿美元。如某个人在1890年时买该公司股票时，有人可能会对他说：“我们将会有两次世界大战，会有1907年的大崩盘。是不是最好等一等？”我们不能犯这个错误。</p></li>
</ul>


<p>*你要做的事情是按低于企业内在价值的价格购买一家企业的股票，如该企业管理层诚实可靠、有能力，那么你就永远持有这些股票。</p>

<ul>
<li><p>不要做低回报率的生意。时间是好生意的朋友，却是坏生意的敌人。如果你陷在糟糕的生意里太久的话，你的结果也一定会糟糕，即使你的买入价很便宜。如果你在一桩好生意里，即使你开始多付了一点额外的成本，如果你做的足够久的话，你的回报一定是可观的。</p></li>
<li><p>人们买股票，根据第二天早上股票价格的涨跌，决定他们的投资是否正确，这简直是扯淡。</p></li>
<li><p>想要在股市从事波段操作是神做的事，不是人做的事。</p></li>
<li><p>人们习惯把每天短线进出股市的投机客称之为投资人，就好像大家把不断发生一夜情的爱情骗子当成浪漫情人一样。</p></li>
<li><p>如果能从历史推测未来，那么最富有的人都是图书管理员。</p></li>
<li><p>短期股市的预测是毒药，应该把它摆在最安全的地方，远离儿童以及那些在股市中的行为像小孩般幼稚的投资人。</p></li>
<li><p>我们偏爱的持股期限是永远。</p></li>
<li><p>你不会每年都更换房子、孩子和老婆。为什么要卖出公司（股票）呢？</p></li>
<li><p>短线投机等于就即将发生的事情进行赌博。如果你运用大量的资金进行短线投机，有可能血本无归。</p></li>
<li><p>希望你不要认为自己拥有的股票仅仅是一纸价格每天都在变动的凭证，而且一旦某种经济事件或政治事件使你紧张不安就会成为你抛售的候选对象。相反，我希望你将自己想象成为公司的所有者之一，对这家企业你愿意无限期的投资,就像你与家庭中的其他成员合伙拥有的一个农场或一套公寓。</p></li>
<li><p>如果我们有坚定的长期投资期望,那么短期的价格波动对我们来说就毫无意义,除非它们能够让我们有机会以更便宜的价格增加股份。</p></li>
<li><p>必须要忍受偏离你的指导方针的诱惑：如果你不愿意拥有一家公司十年,那就不要考虑拥有它十分钟。</p></li>
</ul>


<h4>行业与公司</h4>

<ul>
<li><p>你应该选择投资一些连笨蛋都会经营的企业，因为总有一天这些企业会落入笨蛋的手中。</p></li>
<li><p>当一个经历辉煌的经营阶层遇到一个逐渐没落的夕阳工业，往往是后者占了上风。</p></li>
<li><p>所谓有“转机”的公司，最后很少有成功的案例，与其把时间和精力花在购买价廉的烂公司上，还不如以公道的价格投资一些物美的企业。</p></li>
<li><p>经验显示，能够创造盈余新高的企业，现在做生意的方式通常与其五年前甚至十年前没有多大的差异。</p></li>
<li><p>我们判断一家公司经营的好坏，取决于其净资产收益率（排除不当的财务杠杆或会计做帐），而非每股收益的成长与否，因为即使把钱固定存在银行不动，也能达到象后者一样的目的。</p></li>
</ul>


<p>*（巴菲特反对股票分割配股，他甚至半开玩笑地在朋友的生日贺卡上写到）祝你活到伯克希尔分割股票之时。</p>

<p>*（在购并国际乳品公司时巴菲特说到）我们把钱摆在吃得到的地方。</p>

<p>*（巴菲特在1985年结束伯克希尔纺织部门营运时，解释道）一只能数到十的马是只了不起的马，却不是了不起的数学家，同样的一家能够合理运用资金的纺织公司是一家了不起的纺织公司，但却不是什么了不起的企业。</p>

<ul>
<li><p>如果我们雇用一堆比我们矮小的人，那么我们会变成一堆侏儒，但相反地若我们雇用一堆比我们高大的人，那么我们终将变成一群巨人。</p></li>
<li><p>寻找超级明星——给我们提供了走向成功的唯一机会。</p></li>
<li><p>一个二流的企业最有可能仍旧是二流的企业，而投资人的结果也可能是二流的。</p></li>
<li><p>我们的投资方式只是与我们的个性及我们想要的生活方式相适应,为了这个原因,我们宁愿与我们非常喜欢与敬重的人联手获得回报X，也不愿意通过那些令人乏味或讨厌的人改变这些关系而实现110％的X。</p></li>
<li><p>我们的目标是使我们持股合伙人的利润来自于公司，而不是其他共有者的愚蠢行为。</p></li>
<li><p>对于购并的对象，我们偏爱那些会“产生现金”而非“消化现金”的公司。</p></li>
<li><p>与这群“乐在其中”并以像老板一样心态经营公司的专业经理人在一起工作真是一种享受。</p></li>
<li><p>依我们过去的经验显示，要“找到”一家好的保险公司并不容易，但要“创立”一家更难。</p></li>
<li><p>如何去维护股东最大的权益，不仅是监督一家企业最重要的项目，也是一个理想的管理团队首要之考量。</p></li>
<li><p>喜斯糖果会让吉列公司旗下的欧乐B牙刷销路更好。</p></li>
<li><p>创造营业收益所需的时间，通常不大可能与行星绕太阳一周的时间相吻合。</p></li>
<li><p>一份强势报纸的经济实力是无与伦比的，也是世上最强势的经济力量之一。</p></li>
<li><p>一家典型的报社可将旗下发行报纸售价调高一倍，而仍保有百分之九十的读者。</p></li>
<li><p>所谓的消费者特许权是指大家偏爱而愿意付额外的代价购买某个牌子的产品。</p></li>
<li><p>如果你给我一千亿美金要我把可口可乐打倒，即使我的心可能会很痛，我还是会将钱原封不动的退还。</p></li>
<li><p>可口可乐与吉列刮胡刀是世界上最好的两家公司。</p></li>
<li><p>评估一个人时，你必须看准其三项特质:正直、智力与活力，若缺乏第一项，后面两项可能会把你害惨。</p></li>
</ul>


<p>*（对于联邦住宅抵押贷款公司Freddie Mac的看法）双独占仅次于垄断。</p>

<ul>
<li><p>你能对一条鱼解释在陆上行走的滋味吗?在陆地上生活一天的真实感觉，胜过以言语解释它一千年，而实地亲身去经营企业也是如此。</p></li>
<li><p>所谓拥有特许权的事业，是指那些可以轻易提高价格，且只需额外多投入一些资金，便可增加销售量与市场占有率的企业。</p></li>
<li><p>香烟是一个相当理想的行业，制造成本只要一分钱，但售价却高达一块钱，消费者会上瘾，而且忠诚度非常的高。</p></li>
<li><p>有的企业有高耸的护城河，里头还有凶猛的鳄鱼、海盗与鲨鱼守护着，这才是你应该投资的公司。</p></li>
</ul>


<p>*（对于员工认股选择权的滥用，巴菲特相当不能认同，他说：）如果选择权不是对员工的一种报酬，那它算是什么? 如果报酬不算是一种费用，那它又是什么? 如果费用不列入损益表中，那它又应该摆在那里?
不投资科技股绝对不是迷信不迷信的问题。</p>

<ul>
<li><p>我们充分了解科技为整个社会所带来的便利与改变，只是没有人能预测往后十年这些科技公司会变怎样，我常跟比尔盖兹及安迪葛洛夫在一起，他们也不敢保证。</p></li>
<li><p>经验表明，经营盈利能力最好的企业，经常是那些现在的经营方式与5年前甚至10年前几乎完全相同的企业。而一家公司如果经常发生重大变化，就是可能会因此经常遭受重大失误。推而广之，在一块总是动荡不安的经济土地之上，是不太可能建造一座固若金汤的城堡似的经济特许权，而这样的经济特许权正是企业持续取得超额利润的关键所在。</p></li>
<li><p>良好的管理记录与其说是你很有效率，倒不如说是因为你上了哪条船。当有着辉煌名声的管理人员要去对付前程黯淡、管理混乱、声名狼藉的公司时，不变的只会是公司的名声。如果你发现自己在一艘长期漏水的船上，那么造一艘新船要比补漏洞有效得多。优秀的骑士会在好马，而不是衰弱的老马上充分发挥。我对此事的观点从未改变。</p></li>
</ul>


<h4>安全边际</h4>

<ul>
<li><p>架设桥梁时，你坚持载重量为3万磅，但你只准许1万磅的卡车穿梭其间。相同的原则也适用于投资领域。——格雷厄姆-多德都市的超级投资者们－巴菲特1984哥伦比亚大学的演讲</p></li>
<li><p>投资成功的关键是在一家好公司的市场价格相对于它的内在商业价值大打折扣时买入其股份。内在价值是一个非常重要的概念,它为评估投资和企业的相对吸引力提供了唯一的逻辑手段。内在价值的定义很简单：它是一家企业在其余下的寿命史中可以产生的现金的折现值。</p></li>
<li><p>我认为投资专业的学生只需要两门教授得当的课堂：如何评估一家公司,以及如何考虑市场价格。</p></li>
</ul>


<h4>市场</h4>

<ul>
<li><p>在市场贪婪时恐惧，在市场恐惧时贪婪</p></li>
<li><p>每一个泡沫都有一根针在等着。当两者最终相遇，新一波的投资者会学到华尔街一条古老的教训：当投机看起来轻而易举的时候最危险。</p></li>
<li><p>（对于完全市场效率学说巴菲特完全不能认同，他反而感谢那些相信这种鬼话的机构投资人，让他能够占尽便宜，他说）我们实在欠提出这种理论的学者太多了，就好比当我们在参加桥牌、西洋棋或是选股等斗智的竞赛中，对手却被教练告知思考是白费力气的一件事。</p></li>
<li><p>市场先生是你的仆人，而不是你的向导。</p></li>
<li><p>如果任何一个人准备去做任何一件蠢事的时候，股市在那里，仅仅是作一个参考值而存在。当我们投资于股票的时候，我们也是投资于商业。</p></li>
<li><p>对我来说，股市是根本不存在的。要说其存在，那也只是一个让某些人出丑的地方。</p></li>
<li><p>如果你不能确定你远比“市场先生”更加了解你的公司并能够正确估价，那么你就不能参加游戏。就像他们在纸牌游戏中说的那样，“如果你不能玩上30分钟，而且不知道谁是替死鬼，那么你就是替死鬼。”</p></li>
<li><p>我从未指望在股市中赚钱。我会设想股市在隔天关闭而在5年后开市。</p></li>
<li><p>相信有效市场投资就好比在打桥牌时认为不需看牌一样……如果市场总是有效率的，我将会流落街头，沿街乞讨。</p></li>
<li><p>我们一直觉得股市预测的惟一价值在于让算命先生过得体面一点。</p></li>
<li><p>我们欢迎市场下跌，因为它使我们能以新的、令人感到恐慌的便宜价格拣到更多的股票。</p></li>
<li><p>投资者应考虑企业的长期发展,而不是股票市场的短期前景。价格最终将取决于未来的收益.在投资过程中如同棒球运动中那样,要想让记分牌不断翻滚,你就必须盯着球场而不是记分牌。</p></li>
<li><p>我不认为包含我自己本身在内能够“成功”地预测股市短期间的波动。</p></li>
<li><p>被网络公司引诱的投资人就好像参加舞会的灰姑娘一样，没有在午夜的期限之前赶紧离开，结果漂亮的马车又变回南瓜。不过最大的问题在于，这场舞会上的时钟并没有指针。</p></li>
<li><p>依我们过去的经验显示，从公开市场所买进部份股权的价格远比整笔购并所谈的价格要低的许多。</p></li>
<li><p>我们从未想到要预估股市未来的走势。</p></li>
</ul>


<p>*（当1988年波克夏股票在纽约证券交易所挂牌上市时，巴菲特半开玩笑地对经纪商说）假如你从今天起在两年内能成交一笔伯克希尔的股票，你就算是成功了。</p>

<ul>
<li><p>买股票时，应该假设明天开始股市要休市3ー5年。</p></li>
<li><p>当一些大企业暂时出现危机或股市下跌，出现有利可图的交易价格时，应该毫不犹豫买进它们的股票。</p></li>
</ul>


<h4>伯克希尔</h4>

<ul>
<li><p>我非常热爱我的工作，每天早上去上班时，都会觉得自己好像是要到西斯汀教堂作壁画一样。（注：米开朗基罗名画“最后的审判”完成处）</p></li>
<li><p>我们的集团总部占地仅1,500平方呎，（约合42坪左右）总共只有十二人，刚好可以组一只篮球队。（波克夏目前有16.8个人，一个兼职会计每周工作四天）</p></li>
<li><p>伯克希尔有两种低成本且无风险的资金来源：应付所得税与保险浮存金。</p></li>
<li><p>尽管我们的组织登记为公司，但我们是以合伙的心态来经营。</p></li>
<li><p>一般共同基金的管理费用是百分之一点二五，我们则只有万分之五。</p></li>
<li><p>四十五年前我看到机会却没什么钱，四十五年后我有钱却找不到机会。</p></li>
<li><p>我们自给自足。</p></li>
<li><p>（巴菲特在1985年结束波克夏纺织部门营运时，曾解释道）我们不会因为想要将企业的获利数字增加一个百分点，便结束比较不赚钱的事业，但同时我们也觉得只因公司非常赚钱便无条件去支持一项完全不具前景的投资的作法不太妥当，亚当史密斯一定不赞同我第一项的看法，而卡尔马克斯却又会反对我第二项见解，而采行中庸之道是惟一能让我感到安心的作法。</p></li>
<li><p>在伯克希尔我们不用去告诉一个打击率四成的选手如何挥棒。</p></li>
<li><p>（对于购并所需资金，伯克希尔随时作好万全准备，巴菲特说）如果你想要打中罕见且移动迅速的大象，那么你应该随时把枪带在身上。</p></li>
<li><p>伯克希尔就像是商业界的大都会美术馆，我们偏爱收集当代最伟大的企业。</p></li>
</ul>


<h4>其他</h4>

<ul>
<li><p>信誉可能需要花一辈子的时间才能建立，但只要五分钟便足以摧毁之。</p></li>
<li><p>桥牌是最好的脑力运动，你每十分钟就会看到新局面，在股市同样是运用理性来作决定，桥牌就是一种权衡盈亏比率的游戏。</p></li>
<li><p>裹着神秘面纱的投资技巧显然对投资建议提供者有利。毕竟，庸医仅凭建议你“吃两片阿斯匹林”就攫取了多少名声和财富。</p></li>
<li><p>从预言中你可以得知许多预言家的信息，但对未来却一无所获。（11月21日名言）</p></li>
<li><p>华尔街是惟一的坐劳斯·莱斯的人向那些乘坐地铁的人征询意见的地方。</p></li>
<li><p>（虽然许多人包括华尔街人士，都密切注意巴菲特的一举一动，但他自己却谦逊地说）我曾刻意地注意自己的”一举一动”，不过实在是不怎么样。</p></li>
<li><p>（有人问巴菲特预计什么时后要退休，他回答）大约在我死后五到十年左右。</p></li>
<li><p>（有人问巴菲特死后，其所投资的公司会有什么影响，他回答）可口可乐短期间的销售量可能会爆增，因为我打算在陪葬的飞机里塞满可口可乐。</p></li>
<li><p>（对于伯克希尔惟一的奢侈品ー个人专机无议号，巴菲特说）只要我一死，伯克希尔的账面盈余立刻可增加一百万，因为查理无视于我希望与之同葬的心愿，隔天一定马上把飞机处理掉。</p></li>
<li><p>有生之年我都会继续经营伯克希尔，之后我可能会透过降神会工作。</p></li>
<li><p>（在购并General RE公司后，卖掉其所持有获利不菲价值四十六亿美金的美国零息公债后，债券仍持续大涨时，巴菲特淡淡地表示）我们投入的早，不过卖得更早了一点。</p></li>
<li><p>（有一回巴菲特在地上看到一毛钱，他弯下腰拾起这枚硬币，当时所有在场的人都惊讶不已，只见他说）这是另一个十亿美元的开始。</p></li>
<li><p>（一位哥伦比亚大学的学生问到巴菲特关于投资美国航空的原因，他说）对啊!我的心理医生也问我相同的问题。</p></li>
<li><p>（在成功撮合首都公司与ABC合并后，巴菲特说）我担心恩师葛拉汉会从棺材里爬出来为我这一投资计划喝采。</p></li>
<li><p>（1950年代巴菲特花了一百五十元去上卡内基课程，他说这么做）不是为了让我在演讲时膝盖不会发抖，而是要学会如何在膝盖发抖时，还能继续演讲。</p></li>
<li><p>人，聪明才智其实差不多，重要的是，你能不能把你要做的目标，化身成你每天做它的习惯。</p></li>
<li><p>不要用信用卡。要对自己投资。</p></li>
<li><p>不是钱造人，而是人造钱。</p></li>
<li><p>过自己的生活，越简单越好。</p></li>
<li><p>别追求名牌，只穿让自己感觉舒服的衣服。</p></li>
<li><p>别把钱浪费在不必要的事物上，要花在真正需要的地方。</p></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[史上最可怕的赌局FOMO3D(3)]]></title>
    <link href="https://happy123.me/blog/2018/08/06/shi-shang-zui-ke-pa-de-du-ju-fomo3d-3/"/>
    <updated>2018-08-06T09:29:46+08:00</updated>
    <id>https://happy123.me/blog/2018/08/06/shi-shang-zui-ke-pa-de-du-ju-fomo3d-3</id>
    <content type="html"><![CDATA[<p>目前FOMO 3D的赌局剩余时间已经有多次下降到3小时以下了。</p>

<p>官方非常贴心的为我们指出了最后关头可能会发生的事情:</p>

<!-- more -->


<ol>
<li><p>出块时间可能会增加到90s以上。</p></li>
<li><p>可能会包括并不限于拒绝出块，跳过，或者提交空单。</p></li>
<li><p>交易被拒绝。</p></li>
<li><p>整个ETH网络的gas费用将会飙升</p></li>
<li><p>大户可能可以购买完整的20-100个块以及其中全部的GAS</p></li>
<li><p>网站可能被DDOS攻击</p></li>
<li><p>infura节点可能会被ddos攻击。</p></li>
<li><p>ETH网络可能会崩溃（再次）</p></li>
<li><p>有人使用机器人尝试狙击最后的key。</p></li>
<li><p>玩家可以简单的通过购买大量的key，来摧毁这一切攻击意图（以及浪费掉他们的eth）</p></li>
</ol>


<p>我认为1,2,3,4,6,7,8,9必然会发生，至于大户是否会购买最后100个块，要看全球所有矿池的看法，如果有人出5倍于矿池挖矿正常收益的价格的话，为什么不做这笔交易呢？</p>

<p>至于小散，也想要搏一把的话：</p>

<p>只需要确保的自己名字在顶部1:30点的附近。因为我觉得任何人，要是没有狂跳如飞的计时器，都不可能协调好。但原则是，大家彼此竞赛，目的是让计时器定格在1:30，因为玩家中的每一个人,想要获胜，都会按照这种方法。</p>

<p>你不需要在30秒的时候花费大量的GAS狙击，你也不需要支付1000美元赶在竞赛结束前获得最后一个区块。那全是大户和机器人的领地。你可以轻松地将一个ETH长久放置于1:30标志处，并在rogue long block timer中获得100+次尝试的机会。这可能会耗费一段时间，但最后的辉煌成果就是对你的奖励。</p>

<p>出块时间可以长达120秒，有些罕见情况下时间会更长。你想操纵那个计时器的时间越长（2:00, 2:30），你就会消耗更多的eth来让计时器保持在那里，但你胜算的几率也更大。一旦有120-150秒出块时间的堵塞来袭，你就赢了。</p>

<p>这是利用可能的出块时间来发掘你自己的价值。赢得那个人也可能就是你，对吗？</p>

<p>哈哈，我想小散的力量这个时候会让大户恐惧，因为大户下了血本，也未必能赢过小矿工的运气。</p>

<p>最后，我认为这将是一场耐心的较量。因为各方博弈之下，最后5分钟，游戏时间瞬间回血到24小时也很有可能，到时候下大注的人们可能就会一脸懵逼了。</p>

<p>这真的是史上第一个公开透明博大奖而且取得如此影响力的博彩游戏，比什么现场抽奖，摇彩球要公正好玩的多。</p>

<p>目前20000+ ETH的彩池，奖金超过$1000w，拭目以待。</p>
]]></content>
  </entry>
  
</feed>
